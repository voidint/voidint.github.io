<!DOCTYPE html>
<html lang="zh-cn" itemscope itemtype="http://schema.org/WebPage">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>基于Multipass和Cloud-init打造可移植开发环境 - voidint - 个人博客</title>
  

<meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=yes"/>

<meta name="MobileOptimized" content="width"/>
<meta name="HandheldFriendly" content="true"/>


<meta name="applicable-device" content="pc,mobile">

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">

<meta name="mobile-web-app-capable" content="yes">

<meta name="author" content="voidint" />
  <meta name="description" content="作为程序员，对趁手开发工具和软件的追求是永无止尽的。但是当你买了一台新电脑，或者处于别的原因，需要临时切换到一个全新的机器环境，你肯定和我有" />

  <meta name="keywords" content="voidint, hugo, jane" />






<meta name="generator" content="Hugo 0.100.0" />


<link rel="canonical" href="http://voidint.github.io/post/efficient/multipass/" />





<link rel="icon" href="/favicon.ico" />











<link rel="stylesheet" href="/sass/jane.min.fa4b2b9f31b5c6d0b683db81157a9226e17b06e61911791ab547242a4a0556f2.css" integrity="sha256-&#43;ksrnzG1xtC2g9uBFXqSJuF7BuYZEXkatUckKkoFVvI=" media="screen" crossorigin="anonymous">





<meta property="og:title" content="基于Multipass和Cloud-init打造可移植开发环境" />
<meta property="og:description" content="作为程序员，对趁手开发工具和软件的追求是永无止尽的。但是当你买了一台新电脑，或者处于别的原因，需要临时切换到一个全新的机器环境，你肯定和我有" />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://voidint.github.io/post/efficient/multipass/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2022-11-19T11:17:25+08:00" />
<meta property="article:modified_time" content="2022-11-19T11:17:25+08:00" />

<meta itemprop="name" content="基于Multipass和Cloud-init打造可移植开发环境">
<meta itemprop="description" content="作为程序员，对趁手开发工具和软件的追求是永无止尽的。但是当你买了一台新电脑，或者处于别的原因，需要临时切换到一个全新的机器环境，你肯定和我有"><meta itemprop="datePublished" content="2022-11-19T11:17:25+08:00" />
<meta itemprop="dateModified" content="2022-11-19T11:17:25+08:00" />
<meta itemprop="wordCount" content="3268">
<meta itemprop="keywords" content="multipass,cloud-init,可移植开发环境," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="基于Multipass和Cloud-init打造可移植开发环境"/>
<meta name="twitter:description" content="作为程序员，对趁手开发工具和软件的追求是永无止尽的。但是当你买了一台新电脑，或者处于别的原因，需要临时切换到一个全新的机器环境，你肯定和我有"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->




</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">voidint</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="http://voidint.github.io/">首页</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="http://voidint.github.io/post/">归档</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="http://voidint.github.io/tags/">标签</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="http://voidint.github.io/categories/">分类</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://github.com/voidint" rel="noopener" target="_blank">
              关于
              
              <i class="iconfont">
                <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="18" height="18">
  <path d="M623.36 272.96 473.216 423.04C467.2 429.056 467.072 438.656 472.896 444.416c0 0-6.72-6.656 1.6 1.6C496.064 467.648 528.64 500.224 528.64 500.224 534.464 506.048 544 505.856 550.016 499.904l150.08-150.144 67.328 66.432c9.024 8.96 27.456 4.544 30.4-8.96 19.968-92.608 46.656-227.52 46.656-227.52 6.848-34.496-16.192-56.704-49.92-49.92 0 0-134.656 26.816-227.328 46.784C560.32 178.048 556.352 182.272 554.752 187.136c-3.2 6.208-3.008 14.208 3.776 20.992L623.36 272.96z"></path>
  <path d="M841.152 457.152c-30.528 0-54.784 24.512-54.784 54.656l0 274.752L237.696 786.56 237.696 237.696l206.016 0c6.656 0 10.752 0 13.248 0C487.68 237.696 512 213.184 512 182.848 512 152.32 487.36 128 456.96 128L183.04 128C153.216 128 128 152.576 128 182.848c0 3.136 0.256 6.272 0.768 9.28C128.256 195.136 128 198.272 128 201.408l0 639.488c0 0.064 0 0.192 0 0.256 0 0.128 0 0.192 0 0.32 0 30.528 24.512 54.784 54.784 54.784l646.976 0c6.592 0 9.728 0 11.712 0 28.736 0 52.928-22.976 54.464-51.968C896 843.264 896 842.304 896 841.344l0-20.352L896 561.408 896 512.128C896 481.792 871.424 457.152 841.152 457.152z"></path>
</svg>

              </i>
            </a>
          
        
      </li>
    

    
  </ul>
</nav>


  
    






  <link rel="stylesheet" href="/lib/photoswipe/photoswipe.min.css" />
  <link rel="stylesheet" href="/lib/photoswipe/default-skin/default-skin.min.css" />




<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

<div class="pswp__bg"></div>

<div class="pswp__scroll-wrap">
    
    <div class="pswp__container">
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
    </div>
    
    <div class="pswp__ui pswp__ui--hidden">
    <div class="pswp__top-bar">
      
      <div class="pswp__counter"></div>
      <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
      <button class="pswp__button pswp__button--share" title="Share"></button>
      <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
      <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
      
      
      <div class="pswp__preloader">
        <div class="pswp__preloader__icn">
          <div class="pswp__preloader__cut">
            <div class="pswp__preloader__donut"></div>
          </div>
        </div>
      </div>
    </div>
    <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
      <div class="pswp__share-tooltip"></div>
    </div>
    <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
    </button>
    <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
    </button>
    <div class="pswp__caption">
      <div class="pswp__caption__center"></div>
    </div>
    </div>
    </div>
</div>

  

  

  

  <header id="header" class="header container">
    <div class="logo-wrapper">
  <a href="/" class="logo">
    
      voidint
    
  </a>
</div>

<nav class="site-navbar">
  <ul id="menu" class="menu">
    
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="http://voidint.github.io/">首页</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="http://voidint.github.io/post/">归档</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="http://voidint.github.io/tags/">标签</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="http://voidint.github.io/categories/">分类</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://github.com/voidint" rel="noopener" target="_blank">
              关于
              
              <i class="iconfont">
                <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="18" height="18">
  <path d="M623.36 272.96 473.216 423.04C467.2 429.056 467.072 438.656 472.896 444.416c0 0-6.72-6.656 1.6 1.6C496.064 467.648 528.64 500.224 528.64 500.224 534.464 506.048 544 505.856 550.016 499.904l150.08-150.144 67.328 66.432c9.024 8.96 27.456 4.544 30.4-8.96 19.968-92.608 46.656-227.52 46.656-227.52 6.848-34.496-16.192-56.704-49.92-49.92 0 0-134.656 26.816-227.328 46.784C560.32 178.048 556.352 182.272 554.752 187.136c-3.2 6.208-3.008 14.208 3.776 20.992L623.36 272.96z"></path>
  <path d="M841.152 457.152c-30.528 0-54.784 24.512-54.784 54.656l0 274.752L237.696 786.56 237.696 237.696l206.016 0c6.656 0 10.752 0 13.248 0C487.68 237.696 512 213.184 512 182.848 512 152.32 487.36 128 456.96 128L183.04 128C153.216 128 128 152.576 128 182.848c0 3.136 0.256 6.272 0.768 9.28C128.256 195.136 128 198.272 128 201.408l0 639.488c0 0.064 0 0.192 0 0.256 0 0.128 0 0.192 0 0.32 0 30.528 24.512 54.784 54.784 54.784l646.976 0c6.592 0 9.728 0 11.712 0 28.736 0 52.928-22.976 54.464-51.968C896 843.264 896 842.304 896 841.344l0-20.352L896 561.408 896 512.128C896 481.792 871.424 457.152 841.152 457.152z"></path>
</svg>

              </i>
            </a>
          

        

      </li>
    

    
    

    
  </ul>
</nav>

  </header>

  <div id="mobile-panel">
    <main id="main" class="main bg-llight">
      <div class="content-wrapper">
        <div id="content" class="content container">
          <article class="post bg-white">
    
    <header class="post-header">
      <h1 class="post-title">基于Multipass和Cloud-init打造可移植开发环境</h1>
      
      <div class="post-meta">
        <time datetime="2022-11-19" class="post-time">
          2022/11/19
        </time>
        <div class="post-category">
            <a href="http://voidint.github.io/categories/%E6%95%88%E8%83%BD/"> 效能 </a>
            
          </div>
        <span class="more-meta"> 约 3268 字 </span>
          <span class="more-meta"> 预计阅读 7 分钟 </span>

        
        

        
        
      </div>
    </header>

    
    

    
    <div class="post-content">
      <p><img src="https://voidint.github.io/efficient/cloud-init.png" alt="题图"></p>
<p>作为程序员，对趁手开发工具和软件的追求是永无止尽的。但是当你买了一台新电脑，或者处于别的原因，需要临时切换到一个全新的机器环境，你肯定和我有同样的想法：能不能把我之前的工作环境快速地移植到眼前这台新电脑上。</p>
<h1 id="一可移植开发环境方案">一、可移植开发环境方案</h1>
<h4 id="1timemachine--icloud">1、TimeMachine + iCloud</h4>
<p>作为 Mac 用户，苹果公司为我们提供了现成的 TimeMachine 工具，它提供了为计算机环境创建快照的功能，你只需要将快照保存到外部存储，当有新的 Mac 需要启用，通过这份快照可以快速恢复到你熟悉的软件环境。或者你购买了苹果的 iCloud 大容量存储服务，那么也不用定时去创建快照了，可以将应用和其他数据直接同步至 iCloud 即可，方便快捷。</p>
<p>但<code>TimeMachine+iCloud</code>的方案对于非 Mac 电脑就无能为力了，移植性不够全面。而对于临时使用一台新 Mac 的场景，多少有点伤筋动骨：想象下，你的朋友借你 MacBook Pro 使用一天，而你却把这台机器的软件环境整个换了一遍，想象下你朋友接过这台 Mac 时将作何感想。还有一点，这个方案还费钱，毕竟 iCloud 存储空间不是免费的，外置存储也得花真金白银购买不是吗？！</p>
<h4 id="2docker--ide远程开发插件">2、Docker + IDE远程开发插件</h4>
<p>Docker 自2013年推出以来，就有不少人想以此打造一个个人的可移植开发环境。只要通过一个 Dockerfile ，将所需安装的软件在其中描述清楚，随时随地都能在支持 docker 的环境中构建出相同环境的镜像，基于此镜像运行的实例环境就是你所熟悉的开发环境。再配合宿主机上编辑器或者IDE提供的远程开发功能（如在 vscode 上安装<code>Remote-SSH</code>等插件），就能实现一个接近于开箱即用的可移植开发环境。</p>
<p>基于 Docker 做可移植开发环境虽然还不错，但也并非完美无缺。因为 Docker 依赖于 Linux 内核提供的 Namspace、Cgroup 等能力，在非 Linux 的桌面环境中得安装一个 Linux 虚拟机，在这些环境下的 Docker 就显得不那么轻量了。比如在 Mac 上运行 Docker Desktop ，光虚拟机自身的内存消耗就十分巨大，再加上浏览器和 IDE ，16G内存都不宽裕。Windows 下使用 Docker Desktop 应该也类似（我没试过），或者在 WSL 内安装 Docker。总之，对于我这种追求软件小而美的有洁癖的程序员，这都不够完美。</p>
<h4 id="3multipass--cloud-init">3、Multipass + Cloud-init</h4>
<p>有其他更轻量的方案吗？不久之前，我因为想要安装 k3s，机缘巧合下了解到了<a href="https://multipass.run/">Multipass</a>这款软件。它是由著名的 Linux 发行版 Ubuntu 的厂商 Canonical 公司开发的一款跨平台（Linux/macOS/Windows）轻量级虚拟机软件。它不仅安装和操作简单，创建销毁虚拟机实例飞快，关键创建的虚拟机真的非常轻量，消耗的硬件资源也非常少。再配合上<a href="https://cloudinit.readthedocs.io/en/latest/">Cloud-int</a>完成虚拟机实例的无人值守自动化安装，通过一个简单的文本配置文件就能在任意环境下重建你熟悉的开发环境，是我目前已知的较为完美的方案。</p>
<h1 id="二multipass基本操作">二、Multipass基本操作</h1>
<p>由于我平常使用最多的是 MacBook Pro ，下面我将以 macOS 系统为例介绍下它的基本操作。</p>
<h4 id="1安装">1、安装</h4>
<p>在 macOS 系统下，使用 Homebrew 包管理工具安装 Multipass 十分容易。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">$ brew install --cask multipass
</span></span><span class="line"><span class="cl">$ multipass --version
</span></span><span class="line"><span class="cl">multipass   1.10.1+mac
</span></span><span class="line"><span class="cl">multipassd  1.10.1+mac
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="2查找可供使用的镜像">2、查找可供使用的镜像</h4>
<p>创建虚拟机实例的前提是指定一个镜像，通过以下命令可以查看 Multipass 目前所支持的镜像列表。由于 Multipass 和 Ubuntu 是同一个商业公司开发的产品，对于 Ubuntu 的天然支持也是可以理解的。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">$ multipass find
</span></span><span class="line"><span class="cl">Image                       Aliases           Version          Description
</span></span><span class="line"><span class="cl">18.04                       bionic            <span class="m">20221117</span>         Ubuntu 18.04 LTS
</span></span><span class="line"><span class="cl">20.04                       focal             20221115.1       Ubuntu 20.04 LTS
</span></span><span class="line"><span class="cl">22.04                       jammy,lts         <span class="m">20221117</span>         Ubuntu 22.04 LTS
</span></span><span class="line"><span class="cl">anbox-cloud-appliance                         latest           Anbox Cloud Appliance
</span></span><span class="line"><span class="cl">charm-dev                                     latest           A development and testing environment <span class="k">for</span> charmers
</span></span><span class="line"><span class="cl">docker                                        latest           A Docker environment with Portainer and related tools
</span></span><span class="line"><span class="cl">jellyfin                                      latest           Jellyfin is a Free Software Media System that puts you in control of managing and streaming your media.
</span></span><span class="line"><span class="cl">minikube                                      latest           minikube is <span class="nb">local</span> Kubernetes
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="3创建虚拟机实例">3、创建虚拟机实例</h4>
<p>实例创建命令提供的参数还算丰富，能覆盖到基本需求，最常用的就是一些硬件资源配额相关的参数。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">$ multipass launch --name vm1 --cpus <span class="m">1</span> --mem 1G --disk 10G
</span></span></code></pre></td></tr></table>
</div>
</div><p>这样一条简单的命令，默认会使用最新版的 Ubuntu LTS 版本创建一个实例，并在在我这台2021年14英寸 MacBook Pro 上仅花了22秒就创建完成了，速度飞起。</p>
<h4 id="4查看已创建虚拟机实例列表">4、查看已创建虚拟机实例列表</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">$ multipass list
</span></span><span class="line"><span class="cl">Name                    State             IPv4             Image
</span></span><span class="line"><span class="cl">vm1                     Running           192.168.64.26    Ubuntu 22.04 LTS
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="5查看虚拟机实例详情">5、查看虚拟机实例详情</h4>
<p>可以看到之前创建的虚拟机的资源消耗是非常低的。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">$ multipass info vm1
</span></span><span class="line"><span class="cl">Name:           vm1
</span></span><span class="line"><span class="cl">State:          Running
</span></span><span class="line"><span class="cl">IPv4:           192.168.64.26
</span></span><span class="line"><span class="cl">Release:        Ubuntu 22.04.1 LTS
</span></span><span class="line"><span class="cl">Image hash:     61b29e585d5b <span class="o">(</span>Ubuntu 22.04 LTS<span class="o">)</span>
</span></span><span class="line"><span class="cl">Load:           0.02 0.03 0.00
</span></span><span class="line"><span class="cl">Disk usage:     1.4G out of 9.5G
</span></span><span class="line"><span class="cl">Memory usage:   145.6M out of 961.9M
</span></span><span class="line"><span class="cl">Mounts:         --
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="6进入虚拟机">6、进入虚拟机</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">$ multipass shell vm1
</span></span><span class="line"><span class="cl">Welcome to Ubuntu 22.04.1 LTS <span class="o">(</span>GNU/Linux 5.15.0-53-generic aarch64<span class="o">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> * Documentation:  https://help.ubuntu.com
</span></span><span class="line"><span class="cl"> * Management:     https://landscape.canonical.com
</span></span><span class="line"><span class="cl"> * Support:        https://ubuntu.com/advantage
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  System information as of Sat Nov <span class="m">19</span> 15:10:48 CST <span class="m">2022</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  System load:             0.0
</span></span><span class="line"><span class="cl">  Usage of /:              14.6% of 9.52GB
</span></span><span class="line"><span class="cl">  Memory usage:            17%
</span></span><span class="line"><span class="cl">  Swap usage:              0%
</span></span><span class="line"><span class="cl">  Processes:               <span class="m">86</span>
</span></span><span class="line"><span class="cl">  Users logged in:         <span class="m">0</span>
</span></span><span class="line"><span class="cl">  IPv4 address <span class="k">for</span> enp0s1: 192.168.64.26
</span></span><span class="line"><span class="cl">  IPv6 address <span class="k">for</span> enp0s1: fdf5:f17d:85c7:2a54:5054:ff:fe7f:c21f
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="m">0</span> updates can be applied immediately.
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">To run a <span class="nb">command</span> as administrator <span class="o">(</span>user <span class="s2">&#34;root&#34;</span><span class="o">)</span>, use <span class="s2">&#34;sudo &lt;command&gt;&#34;</span>.
</span></span><span class="line"><span class="cl">See <span class="s2">&#34;man sudo_root&#34;</span> <span class="k">for</span> details.
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">ubuntu@vm1:~$
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="7从宿主机拷贝文件到虚拟机">7、从宿主机拷贝文件到虚拟机</h4>
<p>在宿主机和虚拟机之间拷贝文件是一个高频场景，Multipass 提供了除 scp 外的另一种选择。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">$ multipass transfer ~/.bashrc vm1:/home/ubuntu/.bashrc_bak
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="8挂载卸载宿主机目录">8、挂载/卸载宿主机目录</h4>
<p>对于少量文件，我们可以通过<code>multipass transfer</code>解决。对于需要在宿主机和虚拟机之间共享大量文件的场景，挂载一个宿主机的文件目录到虚拟机中是个更好的选择。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="c1"># 挂载目录</span>
</span></span><span class="line"><span class="cl">$ multipass mount /Users/voidint/workspace/voidint/blog vm1:/root/workspace/blog
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 卸载实例下指定目录</span>
</span></span><span class="line"><span class="cl">$ multipass umount vm1:/home/ubuntu/workspace/blog
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="9关闭启动重启虚拟机实例">9、关闭、启动、重启虚拟机实例</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">$ multipass stop vm1
</span></span><span class="line"><span class="cl">$ multipass start vm1
</span></span><span class="line"><span class="cl">$ multipass restart vm1
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="10删除虚拟机实例">10、删除虚拟机实例</h4>
<p>所谓<code>来也匆匆去也匆匆</code>，multipass 创建虚拟机快得飞起，删除虚拟机也是同样。要是加上<code>--purge</code>选项，则可以彻底虚拟机所占用的磁盘空间，做到不留一丝痕迹。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">$ multipass delete --purge vm1
</span></span></code></pre></td></tr></table>
</div>
</div><h1 id="三cloud-init定制化操作系统">三、Cloud-init定制化操作系统</h1>
<p>如果说 Multipass 是屠龙刀，那么 Cloud-init 就是倚天剑，少了谁都不完美。</p>
<p>有了 Multipass 就可以随时随地在一个全新的环境中创建和销毁一个轻量级的 Linux 虚拟机，这也就为我们<code>可移植开发环境</code>提供了物理基础。但这离我们<code>可移植</code>的目标还有距离，因为每次创建的虚拟机实例都是一个空白的环境，需要一步步手工去安装和配置你所需要的软件，实在繁琐。我们需要借助 Cloud-init 在创建虚拟机实例的同时，以无人值守的方式自动化安装你所需要的软件，最终产出一个满足你需求的定制化操作系统。这才是我们需要的<code>可移植开发环境</code>。</p>
<h4 id="1基本使用">1、基本使用</h4>
<p>Multipass 的<code>launch</code>子命令提供了<code>--cloud-init</code>选项，Multipass 可以从本地文件、URL或者标准输入读取一个 YAML 格式的配置文件，从而实现无人值守安装。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">$ multipass launch -vvvv --name vm1 --cpus <span class="m">1</span> --disk 10G --mem 1G --cloud-init ./cloud-init.yml --timeout <span class="m">999999</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Cloud-init 的全部内容可能无法短时间内掌握，但这并不妨碍基本使用，参考下这些<a href="https://cloudinit.readthedocs.io/en/latest/topics/examples.html">examples</a>，我们也基本能定制我们自己的操作系统了。下面是我自己的一个配置：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="c">#cloud-config</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c"># Update apt database on first boot (run &#39;apt-get update&#39;).</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c"># Note, if packages are given, or package_upgrade is true, then</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c"># update will be done independent of this setting.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c"># Default: false</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">package_update</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c">#cloud-config</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c"># Upgrade the instance on first boot</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c"># Default: false</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">package_upgrade</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c"># Install additional packages on first boot</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c"># Default: none</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c"># if packages are specified, then package_update will be set to true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c"># packages may be supplied as a single package name or as a list</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c"># with the format [&lt;package&gt;, &lt;version&gt;] wherein the specific</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c"># package version will be installed.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">packages</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"> </span>- <span class="l">build-essential</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"> </span>- <span class="l">libprotobuf-dev </span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"> </span>- <span class="l">protobuf-compiler</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"> </span>- <span class="l">zsh</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"> </span>- <span class="l">tree</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"> </span>- <span class="l">jq</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"> </span>- <span class="l">upx-ucl</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c"># run commands</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c"># default: none</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c"># runcmd contains a list of either lists or a string</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c"># each item will be executed in order at rc.local like level with</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c"># output to the console</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c"># - runcmd only runs during the first boot</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c"># - if the item is a list, the items will be properly executed as if</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c">#   passed to execve(3) (with the first arg as the command).</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c"># - if the item is a string, it will be simply written to the file and</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c">#   will be interpreted by &#39;sh&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c"># Note, that the list has to be proper yaml, so you have to quote</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c"># any characters yaml would eat (&#39;:&#39; can be problematic)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">runcmd</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="c"># 日志路径：/var/log/cloud-init-output.log</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="c"># 设置家目录</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"> </span>- <span class="l">export HOME=/root</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="c"># 配置zsh</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"> </span>- <span class="l">chsh -s /bin/zsh</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"> </span>- <span class="l">sh -c &#34;$(curl -fsSL https://raw.github.com/ohmyzsh/ohmyzsh/master/tools/install.sh)&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="c"># 生成ssh key</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"> </span>- <span class="l">ssh-keygen -f $HOME/.ssh/id_rsa -t rsa -b 4096 -C &#34;voidint@126.com&#34; -N &#39;&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="c"># 配置git</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"> </span>- <span class="l">git config --global user.name voidint</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"> </span>- <span class="l">git config --global user.email voidint@126.com</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="c"># 安装docker</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"> </span>- <span class="l">curl -sSL https://get.docker.com | sh -</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"> </span>- <span class="l">echo &#39;{&#34;registry-mirrors&#34;:[&#34;https://mirror.baidubce.com&#34;,&#34;https://docker.mirrors.ustc.edu.cn&#34;,&#34;https://dockerhub.azk8s.cn&#34;],&#34;hosts&#34;:[&#34;fd://&#34;,&#34;tcp://0.0.0.0:2375&#34;]}&#39; &gt; /etc/docker/daemon.json</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"> </span>- <span class="l">sed -i &#39;s/ExecStart=\/usr\/bin\/dockerd -H fd:\/\/ --containerd=\/run\/containerd\/containerd.sock/ExecStart=\/usr\/bin\/dockerd/&#39; /lib/systemd/system/docker.service</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"> </span>- <span class="l">systemctl daemon-reload &amp; systemctl restart docker</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"> </span>- <span class="l">docker run --rm --privileged tonistiigi/binfmt:latest --install all</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="c"># 安装k3s</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"> </span>- <span class="l">curl -sfL https://rancher-mirror.oss-cn-beijing.aliyuncs.com/k3s/k3s-install.sh | INSTALL_K3S_MIRROR=cn sh -</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="c"># 安装g和go</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"> </span>- <span class="l">curl -sSL https://raw.githubusercontent.com/voidint/g/master/install.sh | bash</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"> </span>- <span class="l">$HOME/bin/g install 1.19.3</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"> </span>- <span class="l">$HOME/.g/go/bin/go env -w GOPROXY=&#34;https://goproxy.cn,direct&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"> </span>- <span class="l">$HOME/.g/go/bin/go install google.golang.org/protobuf/cmd/protoc-gen-go@latest</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"> </span>- <span class="l">$HOME/.g/go/bin/go install google.golang.org/grpc/cmd/protoc-gen-go-grpc@latest</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"> </span>- <span class="l">$HOME/.g/go/bin/go install github.com/go-delve/delve/cmd/dlv@latest</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"> </span>- <span class="l">$HOME/.g/go/bin/go install github.com/mgechev/revive@latest</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"> </span>- <span class="l">$HOME/.g/go/bin/go install github.com/securego/gosec/v2/cmd/gosec@latest</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="c"># 安装rust（不支持交互式安装方式）</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="c"># - curl --proto &#39;=https&#39; --tlsv1.2 -sSf https://sh.rustup.rs | sh</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="2使用心得">2、使用心得</h4>
<ul>
<li>第一条：自定义安装的软件是使用<code>root</code>用户运行，不要假设它会使用类似 ubuntu 这样的普通用户身份运行。</li>
<li>第二条：默认情况下，<code>HOME</code>环境变量值为空，由于很多软件安装过程中会读取这个变量，因此强烈建议在开始的地方为该环境变量赋初值。</li>
<li>第三条：不要使用非绝对路径，比如使用<code>~</code>指代家目录，绝对路径能让你少走很多弯路。</li>
<li>第四条：杜绝交互方式安装或者配置软件，比如<code>curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh</code>安装 rust 就会失败。</li>
<li>第五条：安装结果不符合预期，一定要去查看<code>/var/log/cloud-init-output.log</code>日志，它能告诉你原因。</li>
<li>第六条：多尝试，毕竟试错成本很低很低。</li>
</ul>
<h1 id="参考">参考</h1>
<ul>
<li><a href="https://multipass.run/">Multipass</a></li>
<li><a href="https://cloudinit.readthedocs.io/en/latest/">Cloud-int</a></li>
</ul>

    </div>

    
    
<div class="post-copyright">
  <p class="copyright-item">
    <span class="item-title">文章作者</span>
    <span class="item-content">voidint</span>
  </p>
  <p class="copyright-item">
    <span class="item-title">上次更新</span>
    <span class="item-content">
      2022/11/19
      
    </span>
  </p>
  
  <p class="copyright-item">
    <span class="item-title">许可协议</span>
    <span class="item-content"><a rel="license noopener" href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank">CC BY-NC-ND 4.0</a></span>
  </p>
</div>


    
    

    <footer class="post-footer">
      <div class="post-tags">
          <a href="http://voidint.github.io/tags/multipass/">multipass</a>
          <a href="http://voidint.github.io/tags/cloud-init/">cloud-init</a>
          <a href="http://voidint.github.io/tags/%E5%8F%AF%E7%A7%BB%E6%A4%8D%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83/">可移植开发环境</a>
          
        </div>

      
      <nav class="post-nav">
        
          <a class="prev" href="/post/tool/apt/">
            
            <i class="iconfont">
              <svg  class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="18" height="18">
  <path d="M691.908486 949.511495l75.369571-89.491197c10.963703-12.998035 10.285251-32.864502-1.499144-44.378743L479.499795 515.267417 757.434875 204.940602c11.338233-12.190647 11.035334-32.285311-0.638543-44.850487l-80.46666-86.564541c-11.680017-12.583596-30.356378-12.893658-41.662889-0.716314L257.233596 494.235404c-11.332093 12.183484-11.041474 32.266891 0.657986 44.844348l80.46666 86.564541c1.772366 1.910513 3.706415 3.533476 5.750981 4.877077l306.620399 321.703933C662.505829 963.726242 680.945807 962.528973 691.908486 949.511495z"></path>
</svg>

            </i>
            <span class="prev-text nav-default">APT软件包管理</span>
            <span class="prev-text nav-mobile">上一篇</span>
          </a>
        
          <a class="next" href="/post/tool/nm/">
            <span class="next-text nav-default">nm 简明教程</span>
            <span class="prev-text nav-mobile">下一篇</span>
            
            <i class="iconfont">
              <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="18" height="18">
  <path d="M332.091514 74.487481l-75.369571 89.491197c-10.963703 12.998035-10.285251 32.864502 1.499144 44.378743l286.278095 300.375162L266.565125 819.058374c-11.338233 12.190647-11.035334 32.285311 0.638543 44.850487l80.46666 86.564541c11.680017 12.583596 30.356378 12.893658 41.662889 0.716314l377.434212-421.426145c11.332093-12.183484 11.041474-32.266891-0.657986-44.844348l-80.46666-86.564541c-1.772366-1.910513-3.706415-3.533476-5.750981-4.877077L373.270379 71.774697C361.493148 60.273758 343.054193 61.470003 332.091514 74.487481z"></path>
</svg>

            </i>
          </a>
      </nav>
    </footer>
  </article>

  
  
  
  

  
  

  

  
  
    <div class="post bg-white">
      <script src="https://utteranc.es/client.js"
            repo= "voidint/comments-for-blog"
            issue-term="pathname"
            theme="github-light"
            crossorigin="anonymous"
            async>
      </script>
    </div>
  

  

  

  <div class="disqus-comment">
  <div class="disqus-button" id="load_disqus" onclick="load_disqus()">
    显示 Disqus 评论
  </div>
  <div id="disqus_thread"></div>
  <script type="text/javascript">
    var disqus_config = function () {
      this.page.url = "http://voidint.github.io/post/efficient/multipass/";
    };
    function load_disqus() {
      
      
      if (window.location.hostname === 'localhost') return;

      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      var disqus_shortname = 'voidint';
      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);

      $('#load_disqus').remove();
    };
  </script>
  <noscript>Please enable JavaScript to view the
    <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a>
  </noscript>
  
  </div>

    

  

        </div>
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="icon-links">
  
  
    <a href="mailto:voidint@126.com" rel="me noopener" class="iconfont"
      title="email" >
      <svg class="icon" viewBox="0 0 1451 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="36" height="36">
  <path d="M664.781909 681.472759 0 97.881301C0 3.997201 71.046997 0 71.046997 0L474.477909 0 961.649408 0 1361.641813 0C1361.641813 0 1432.688811 3.997201 1432.688811 97.881301L771.345323 681.472759C771.345323 681.472759 764.482731 685.154773 753.594283 688.65053L753.594283 688.664858C741.602731 693.493018 729.424896 695.068979 718.077952 694.839748 706.731093 695.068979 694.553173 693.493018 682.561621 688.664858L682.561621 688.65053C671.644501 685.140446 664.781909 681.472759 664.781909 681.472759L664.781909 681.472759ZM718.063616 811.603883C693.779541 811.016482 658.879232 802.205449 619.10784 767.734955 542.989056 701.759633 0 212.052267 0 212.052267L0 942.809523C0 942.809523 0 1024 83.726336 1024L682.532949 1024 753.579947 1024 1348.948139 1024C1432.688811 1024 1432.688811 942.809523 1432.688811 942.809523L1432.688811 212.052267C1432.688811 212.052267 893.138176 701.759633 817.019477 767.734955 777.248 802.205449 742.347691 811.03081 718.063616 811.603883L718.063616 811.603883Z"></path>
</svg>

    </a>
  
    <a href="https://githut.com/voidint" rel="me noopener" class="iconfont"
      title="github"  target="_blank"
      >
      <svg class="icon" style="" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="36" height="36">
  <path d="M512 12.672c-282.88 0-512 229.248-512 512 0 226.261333 146.688 418.133333 350.08 485.76 25.6 4.821333 34.986667-11.008 34.986667-24.618667 0-12.16-0.426667-44.373333-0.64-87.04-142.421333 30.890667-172.458667-68.693333-172.458667-68.693333C188.672 770.986667 155.008 755.2 155.008 755.2c-46.378667-31.744 3.584-31.104 3.584-31.104 51.413333 3.584 78.421333 52.736 78.421333 52.736 45.653333 78.293333 119.850667 55.68 149.12 42.581333 4.608-33.109333 17.792-55.68 32.426667-68.48-113.706667-12.8-233.216-56.832-233.216-253.013333 0-55.893333 19.84-101.546667 52.693333-137.386667-5.76-12.928-23.04-64.981333 4.48-135.509333 0 0 42.88-13.738667 140.8 52.48 40.96-11.392 84.48-17.024 128-17.28 43.52 0.256 87.04 5.888 128 17.28 97.28-66.218667 140.16-52.48 140.16-52.48 27.52 70.528 10.24 122.581333 5.12 135.509333 32.64 35.84 52.48 81.493333 52.48 137.386667 0 196.693333-119.68 240-233.6 252.586667 17.92 15.36 34.56 46.762667 34.56 94.72 0 68.522667-0.64 123.562667-0.64 140.202666 0 13.44 8.96 29.44 35.2 24.32C877.44 942.592 1024 750.592 1024 524.672c0-282.752-229.248-512-512-512"></path>
</svg>

    </a>
  
    <a href="https://weibo.com/voidinteger/home" rel="me noopener" class="iconfont"
      title="weibo"  target="_blank"
      >
      <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="36" height="36">
  <path d="M385.714286 733.714286q12-19.428571 6.285714-39.428571t-25.714286-28.571429q-19.428571-8-41.714286-0.571429t-34.285714 26.285714q-12.571429 19.428571-7.428571 39.142857t24.571429 28.857143 42.571429 1.428571 35.714286-27.142857zm53.714286-69.142857q4.571429-7.428571 2-15.142857t-10-10.571429q-8-2.857143-16.285714 2.857143t-12.285714 10.571429q-9.714286 17.714286 7.428571 25.714286 8 2.857143 16.571429 2.857143t12.571429-10.571429zm99.428571 61.142857q-25.714286 58.285714-90.285714 85.714286t-128 6.857143q-61.142857-19.428571-84.285714-72.285714t3.714286-107.142857q26.857143-53.142857 86.571429-79.428571t120.285714-10.857143q63.428571 16.571429 90.571429 68.285714t1.428571 108.857143zm178.285714-91.428571q-5.142857-54.857143-50.857143-97.142857t-119.142857-62.285714-156.857143-12q-127.428571 13.142857-211.142857 80.857143t-75.714286 151.142857q5.142857 54.857143 50.857143 97.142857t119.142857 62.285714 156.857143 12q127.428571-13.142857 211.142857-80.857143t75.714286-151.142857zm176 2.285714q0 38.857143-21.142857 79.714286t-62.285714 78.285714-96.285714 67.142857-129.142857 47.428571-154.571429 17.714286-157.142857-19.142857-137.428571-53.142857-98-86.285714-37.142857-114q0-65.714286 39.714286-140t112.857143-147.428571q96.571429-96.571429 195.142857-134.857143t140.857143 4q37.142857 36.571429 11.428571 119.428571-2.285714 8-0.571429 11.428571t5.714286 4 8.285714 2.857143 7.714286-2l3.428571-1.142857q79.428571-33.714286 140.571429-33.714286t87.428571 34.857143q25.714286 36 0 101.714286-1.142857 7.428571-2.571429 11.428571t2.571429 7.142857 6.857143 4.285714 9.714286 3.428571q32.571429 10.285714 58.857143 26.857143t45.714286 46.571429 19.428571 66.571429zm-42.285714-356.571429q24 26.857143 31.142857 62t-3.714286 67.142857q-4.571429 13.142857-16.857143 19.428571t-25.428571 2.285714q-13.142857-4.571429-19.428571-16.857143t-2.285714-25.428571q11.428571-36-13.714286-63.428571t-61.142857-20q-13.714286 2.857143-25.714286-4.571429t-14.285714-21.142857q-2.857143-13.714286 4.571429-25.428571t21.142857-14.571429q34.285714-7.428571 68 3.142857t57.714286 37.428571zm103.428571-93.142857q49.714286 54.857143 64.285714 127.142857t-7.714286 138q-5.142857 15.428571-19.428571 22.857143t-29.714286 2.285714-22.857143-19.428571-2.857143-29.714286q16-46.857143 5.714286-98.285714t-45.714286-90.285714q-35.428571-39.428571-84.571429-54.571429t-98.857143-4.857143q-16 3.428571-29.714286-5.428571t-17.142857-24.857143 5.428571-29.428571 24.857143-16.857143q70.285714-14.857143 139.428571 6.571429t118.857143 76.857143z"></path>
</svg>

    </a>
  
    <a href="https://www.zhihu.com/people/voidint/posts" rel="me noopener" class="iconfont"
      title="zhihu"  target="_blank"
      >
      <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="36" height="36">
  <path d="M351.791182 562.469462l192.945407 0c0-45.367257-21.3871-71.939449-21.3871-71.939449L355.897709 490.530013c3.977591-82.182744 7.541767-187.659007 8.816806-226.835262l159.282726 0c0 0-0.86367-67.402109-18.578124-67.402109s-279.979646 0-279.979646 0 16.850783-88.141456 39.318494-127.053698c0 0-83.60514-4.510734-112.121614 106.962104S81.344656 355.077018 76.80834 367.390461c-4.536316 12.313443 24.62791 5.832845 36.941354 0 12.313443-5.832845 68.050885-25.924439 84.252893-103.69571l86.570681 0c1.165546 49.28652 4.596691 200.335724 3.515057 226.835262L109.86113 490.530013c-25.275663 18.147312-33.701566 71.939449-33.701566 71.939449L279.868105 562.469462c-8.497535 56.255235-23.417339 128.763642-44.275389 167.210279-33.05279 60.921511-50.55235 116.65793-169.802314 212.576513 0 0-19.442818 14.257725 40.829917 9.073656 60.273758-5.185093 117.305683-20.739347 156.840094-99.807147 20.553105-41.107233 41.805128-93.250824 58.386782-146.138358l-0.055259 0.185218 167.855986 193.263655c0 0 22.035876-51.847855 5.832845-108.880803L371.045711 650.610918l-42.1244 31.157627-0.045025 0.151449c11.69946-41.020252 20.11206-81.5749 22.726607-116.858498C351.665315 564.212152 351.72876 563.345412 351.791182 562.469462z"></path>
  <path d="M584.918753 182.033893l0 668.840094 70.318532 0 28.807093 80.512708 121.875768-80.512708 153.600307 0L959.520453 182.033893 584.918753 182.033893zM887.150192 778.934538l-79.837326 0-99.578949 65.782216-23.537066-65.782216-24.855084 0L659.341766 256.673847l227.807403 0L887.149169 778.934538z"></path>
</svg>

    </a>


<a href="http://voidint.github.io/index.xml" rel="noopener alternate" type="application/rss&#43;xml"
    class="iconfont" title="rss" target="_blank">
    <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="30" height="30">
  <path d="M819.157333 1024C819.157333 574.592 449.408 204.8 0 204.8V0c561.706667 0 1024 462.293333 1024 1024h-204.842667zM140.416 743.04a140.8 140.8 0 0 1 140.501333 140.586667A140.928 140.928 0 0 1 140.074667 1024C62.72 1024 0 961.109333 0 883.626667s62.933333-140.544 140.416-140.586667zM678.784 1024h-199.04c0-263.210667-216.533333-479.786667-479.744-479.786667V345.173333c372.352 0 678.784 306.517333 678.784 678.826667z"></path>
</svg>

  </a>
   
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - <a class="theme-link" href="https://github.com/xianmin/hugo-theme-jane">Jane</a>
  </span>

  <span class="copyright-year">
    &copy;
    
      2020 -
    2024
    <span class="heart">
      
      <i class="iconfont">
        <svg class="icon" viewBox="0 0 1025 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="14" height="14">
  <path d="M1000.1 247.9c-15.5-37.3-37.6-70.6-65.7-98.9-54.4-54.8-125.8-85-201-85-85.7 0-166 39-221.4 107.4C456.6 103 376.3 64 290.6 64c-75.1 0-146.5 30.4-201.1 85.6-28.2 28.5-50.4 61.9-65.8 99.3-16 38.8-24 79.9-23.6 122.2 0.7 91.7 40.1 177.2 108.1 234.8 3.1 2.6 6 5.1 8.9 7.8 14.9 13.4 58 52.8 112.6 102.7 93.5 85.5 209.9 191.9 257.5 234.2 7 6.1 15.8 9.5 24.9 9.5 9.2 0 18.1-3.4 24.9-9.5 34.5-30.7 105.8-95.9 181.4-165 74.2-67.8 150.9-138 195.8-178.2 69.5-57.9 109.6-144.4 109.9-237.3 0.1-42.5-8-83.6-24-122.2z"
   fill="#8a8a8a"></path>
</svg>

      </i>
    </span><span class="author">
        voidint
        
      </span></span>

  
  

  
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont">
        
        <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="35" height="35">
  <path d="M510.866688 227.694839 95.449397 629.218702l235.761562 0-2.057869 328.796468 362.40389 0L691.55698 628.188232l241.942331-3.089361L510.866688 227.694839zM63.840492 63.962777l894.052392 0 0 131.813095L63.840492 195.775872 63.840492 63.962777 63.840492 63.962777zM63.840492 63.962777"></path>
</svg>

      </i>
    </div>
  </div>
  
<script type="text/javascript" src="/lib/jquery/jquery-3.2.1.min.js"></script>
  <script type="text/javascript" src="/lib/slideout/slideout-1.0.1.min.js"></script>




<script type="text/javascript" src="/js/main.638251f4230630f0335d8c6748e53a96f94b72670920b60c09a56fdc8bece214.js" integrity="sha256-Y4JR9CMGMPAzXYxnSOU6lvlLcmcJILYMCaVv3Ivs4hQ=" crossorigin="anonymous"></script>












  
    <script type="text/javascript" src="/js/load-photoswipe.js"></script>
    <script type="text/javascript" src="/lib/photoswipe/photoswipe.min.js"></script>
    <script type="text/javascript" src="/lib/photoswipe/photoswipe-ui-default.min.js"></script>
  















</body>
</html>
