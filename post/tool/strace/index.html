<!DOCTYPE html>
<html lang="zh-cn" itemscope itemtype="http://schema.org/WebPage">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>strace 简明教程 - voidint - 个人博客</title>
  

<meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=yes"/>

<meta name="MobileOptimized" content="width"/>
<meta name="HandheldFriendly" content="true"/>


<meta name="applicable-device" content="pc,mobile">

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">

<meta name="mobile-web-app-capable" content="yes">

<meta name="author" content="voidint" />
  <meta name="description" content="strace 是什么？维基百科给出的定义如下： strace 是 Linux 系统下的一个用于诊断、调试和指导用户空间的实用程序。它用于监视和篡改进程与 Linux 内核之间的交互，包括系统" />

  <meta name="keywords" content="voidint, hugo, jane" />






<meta name="generator" content="Hugo 0.91.2" />


<link rel="canonical" href="http://voidint.github.io/post/tool/strace/" />





<link rel="icon" href="/favicon.ico" />











<link rel="stylesheet" href="/sass/jane.min.fa4b2b9f31b5c6d0b683db81157a9226e17b06e61911791ab547242a4a0556f2.css" integrity="sha256-&#43;ksrnzG1xtC2g9uBFXqSJuF7BuYZEXkatUckKkoFVvI=" media="screen" crossorigin="anonymous">





<meta property="og:title" content="strace 简明教程" />
<meta property="og:description" content="strace 是什么？维基百科给出的定义如下： strace 是 Linux 系统下的一个用于诊断、调试和指导用户空间的实用程序。它用于监视和篡改进程与 Linux 内核之间的交互，包括系统" />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://voidint.github.io/post/tool/strace/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2021-10-17T14:01:42+08:00" />
<meta property="article:modified_time" content="2021-10-17T14:01:42+08:00" />

<meta itemprop="name" content="strace 简明教程">
<meta itemprop="description" content="strace 是什么？维基百科给出的定义如下： strace 是 Linux 系统下的一个用于诊断、调试和指导用户空间的实用程序。它用于监视和篡改进程与 Linux 内核之间的交互，包括系统"><meta itemprop="datePublished" content="2021-10-17T14:01:42+08:00" />
<meta itemprop="dateModified" content="2021-10-17T14:01:42+08:00" />
<meta itemprop="wordCount" content="6568">
<meta itemprop="keywords" content="strace," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="strace 简明教程"/>
<meta name="twitter:description" content="strace 是什么？维基百科给出的定义如下： strace 是 Linux 系统下的一个用于诊断、调试和指导用户空间的实用程序。它用于监视和篡改进程与 Linux 内核之间的交互，包括系统"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->




</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">voidint</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="http://voidint.github.io/">首页</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="http://voidint.github.io/post/">归档</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="http://voidint.github.io/tags/">标签</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="http://voidint.github.io/categories/">分类</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://github.com/voidint" rel="noopener" target="_blank">
              关于
              
              <i class="iconfont">
                <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="18" height="18">
  <path d="M623.36 272.96 473.216 423.04C467.2 429.056 467.072 438.656 472.896 444.416c0 0-6.72-6.656 1.6 1.6C496.064 467.648 528.64 500.224 528.64 500.224 534.464 506.048 544 505.856 550.016 499.904l150.08-150.144 67.328 66.432c9.024 8.96 27.456 4.544 30.4-8.96 19.968-92.608 46.656-227.52 46.656-227.52 6.848-34.496-16.192-56.704-49.92-49.92 0 0-134.656 26.816-227.328 46.784C560.32 178.048 556.352 182.272 554.752 187.136c-3.2 6.208-3.008 14.208 3.776 20.992L623.36 272.96z"></path>
  <path d="M841.152 457.152c-30.528 0-54.784 24.512-54.784 54.656l0 274.752L237.696 786.56 237.696 237.696l206.016 0c6.656 0 10.752 0 13.248 0C487.68 237.696 512 213.184 512 182.848 512 152.32 487.36 128 456.96 128L183.04 128C153.216 128 128 152.576 128 182.848c0 3.136 0.256 6.272 0.768 9.28C128.256 195.136 128 198.272 128 201.408l0 639.488c0 0.064 0 0.192 0 0.256 0 0.128 0 0.192 0 0.32 0 30.528 24.512 54.784 54.784 54.784l646.976 0c6.592 0 9.728 0 11.712 0 28.736 0 52.928-22.976 54.464-51.968C896 843.264 896 842.304 896 841.344l0-20.352L896 561.408 896 512.128C896 481.792 871.424 457.152 841.152 457.152z"></path>
</svg>

              </i>
            </a>
          
        
      </li>
    

    
  </ul>
</nav>


  
    






  <link rel="stylesheet" href="/lib/photoswipe/photoswipe.min.css" />
  <link rel="stylesheet" href="/lib/photoswipe/default-skin/default-skin.min.css" />




<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

<div class="pswp__bg"></div>

<div class="pswp__scroll-wrap">
    
    <div class="pswp__container">
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
    </div>
    
    <div class="pswp__ui pswp__ui--hidden">
    <div class="pswp__top-bar">
      
      <div class="pswp__counter"></div>
      <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
      <button class="pswp__button pswp__button--share" title="Share"></button>
      <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
      <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
      
      
      <div class="pswp__preloader">
        <div class="pswp__preloader__icn">
          <div class="pswp__preloader__cut">
            <div class="pswp__preloader__donut"></div>
          </div>
        </div>
      </div>
    </div>
    <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
      <div class="pswp__share-tooltip"></div>
    </div>
    <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
    </button>
    <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
    </button>
    <div class="pswp__caption">
      <div class="pswp__caption__center"></div>
    </div>
    </div>
    </div>
</div>

  

  

  

  <header id="header" class="header container">
    <div class="logo-wrapper">
  <a href="/" class="logo">
    
      voidint
    
  </a>
</div>

<nav class="site-navbar">
  <ul id="menu" class="menu">
    
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="http://voidint.github.io/">首页</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="http://voidint.github.io/post/">归档</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="http://voidint.github.io/tags/">标签</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="http://voidint.github.io/categories/">分类</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://github.com/voidint" rel="noopener" target="_blank">
              关于
              
              <i class="iconfont">
                <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="18" height="18">
  <path d="M623.36 272.96 473.216 423.04C467.2 429.056 467.072 438.656 472.896 444.416c0 0-6.72-6.656 1.6 1.6C496.064 467.648 528.64 500.224 528.64 500.224 534.464 506.048 544 505.856 550.016 499.904l150.08-150.144 67.328 66.432c9.024 8.96 27.456 4.544 30.4-8.96 19.968-92.608 46.656-227.52 46.656-227.52 6.848-34.496-16.192-56.704-49.92-49.92 0 0-134.656 26.816-227.328 46.784C560.32 178.048 556.352 182.272 554.752 187.136c-3.2 6.208-3.008 14.208 3.776 20.992L623.36 272.96z"></path>
  <path d="M841.152 457.152c-30.528 0-54.784 24.512-54.784 54.656l0 274.752L237.696 786.56 237.696 237.696l206.016 0c6.656 0 10.752 0 13.248 0C487.68 237.696 512 213.184 512 182.848 512 152.32 487.36 128 456.96 128L183.04 128C153.216 128 128 152.576 128 182.848c0 3.136 0.256 6.272 0.768 9.28C128.256 195.136 128 198.272 128 201.408l0 639.488c0 0.064 0 0.192 0 0.256 0 0.128 0 0.192 0 0.32 0 30.528 24.512 54.784 54.784 54.784l646.976 0c6.592 0 9.728 0 11.712 0 28.736 0 52.928-22.976 54.464-51.968C896 843.264 896 842.304 896 841.344l0-20.352L896 561.408 896 512.128C896 481.792 871.424 457.152 841.152 457.152z"></path>
</svg>

              </i>
            </a>
          

        

      </li>
    

    
    

    
  </ul>
</nav>

  </header>

  <div id="mobile-panel">
    <main id="main" class="main bg-llight">
      <div class="content-wrapper">
        <div id="content" class="content container">
          <article class="post bg-white">
    
    <header class="post-header">
      <h1 class="post-title">strace 简明教程</h1>
      
      <div class="post-meta">
        <time datetime="2021-10-17" class="post-time">
          2021/10/17
        </time>
        <div class="post-category">
            <a href="http://voidint.github.io/categories/%E5%B7%A5%E5%85%B7%E7%AE%B1/"> 工具箱 </a>
            
          </div>
        <span class="more-meta"> 约 6568 字 </span>
          <span class="more-meta"> 预计阅读 14 分钟 </span>

        
        

        
        
      </div>
    </header>

    
    

    
    <div class="post-content">
      <p><img src="https://voidint.github.io/tool/strace.png" alt="题图"></p>
<p><strong>strace</strong> 是什么？维基百科给出的定义如下：</p>
<blockquote>
<p>strace 是 Linux 系统下的一个用于诊断、调试和指导用户空间的实用程序。它用于监视和篡改进程与 Linux 内核之间的交互，包括系统调用、信号传递和进程状态的更改。</p>
</blockquote>
<p>不管什么编程语言写的程序，只要跑在 Linux 系统下，就必然需要与内核交互。某些高级编程语言，在语言或者标准库层面上或许并没有提供直接与内核交互的接口，但那也仅仅是虚拟机或者解释器之类的运行时屏蔽了这部分内容而已。作为运行在操作系统上的一个进程，与内核交互（也就是系统调用）是不可避免的。既然不可避免，当系统调用返回错误或者阻塞时，如何才能定位其中的原因？编程语言层面返回的错误固然能提供一部分信息，但这也属于是<strong>二手信息</strong>罢了。那怎么获取<strong>一手信息</strong>并快速定位问题的原因呢？答案就是 strace 。</p>
<p>不同的 strace 版本功能上存在不少差异，为了避免鸡同鸭讲的情况发生，我把我所使用的 strace 版本放这：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="c1"># strace -V</span>
strace -- version 5.1
Copyright <span class="o">(</span>c<span class="o">)</span> 1991-2019 The strace developers &lt;https://strace.io&gt;.
This is free software<span class="p">;</span> see the <span class="nb">source</span> <span class="k">for</span> copying conditions.  There is NO
warranty<span class="p">;</span> not even <span class="k">for</span> MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.

Optional features enabled: stack-trace<span class="o">=</span>libdw stack-demangle m32-mpers mx32-mpers
</code></pre></td></tr></table>
</div>
</div><h1 id="strace-选项">strace 选项</h1>
<table>
<thead>
<tr>
<th>类别</th>
<th>选项</th>
<th>选项值</th>
<th>描述</th>
<th>示例</th>
</tr>
</thead>
<tbody>
<tr>
<td>Output format</td>
<td>-o</td>
<td>目标文件</td>
<td>将系统调用跟踪信息输出到文件而非 stderr</td>
<td>strace -o trace.log ls /</td>
</tr>
<tr>
<td></td>
<td>-A</td>
<td>无</td>
<td>与<code>-o</code>选项一起使用，会将输出以追加的方式写入文件。</td>
<td>strace -o trace.log -A ls /</td>
</tr>
<tr>
<td></td>
<td>-i</td>
<td>无</td>
<td>打印系统调用时的指令指针</td>
<td>strace -i  ls /</td>
</tr>
<tr>
<td></td>
<td>-t</td>
<td>无</td>
<td>打印系统调用时的时间（时、分、秒）</td>
<td>strace -t ls /</td>
</tr>
<tr>
<td></td>
<td>-tt</td>
<td>无</td>
<td>打印系统调用时的时间（时、分、秒、微秒）</td>
<td>strace -tt ls /</td>
</tr>
<tr>
<td></td>
<td>-ttt</td>
<td>无</td>
<td>打印系统调用时的时间（Unix时间戳、微秒）</td>
<td>strace -ttt ls /</td>
</tr>
<tr>
<td></td>
<td>-T</td>
<td>无</td>
<td>打印每个系统调用的耗时</td>
<td>strace -T ls /</td>
</tr>
<tr>
<td></td>
<td>-y</td>
<td>无</td>
<td>打印文件描述符所对应的文件名</td>
<td>strace -y ls /</td>
</tr>
<tr>
<td></td>
<td>-yy</td>
<td>无</td>
<td>打印与套接字文件描述符相关的协议特定信息，以及与设备文件描述符相关的块/字符设备号。</td>
<td>strace -yy -e trace=connect,write ping -c 1 <a href="http://www.baidu.com">www.baidu.com</a></td>
</tr>
<tr>
<td>Statistics</td>
<td>-c</td>
<td>无</td>
<td>统计每个系统调动的耗时、调用次数、失败数</td>
<td>strace -c ls /</td>
</tr>
<tr>
<td>Filtering</td>
<td>-e</td>
<td>trace=set</td>
<td>跟踪<strong>指定集合中</strong>的系统调用</td>
<td>strace -e trace=read,write ./a.out</td>
</tr>
<tr>
<td></td>
<td></td>
<td>trace=/regex</td>
<td>跟踪<strong>名称与正则表达式匹配</strong>的系统调用</td>
<td>strace -e trace=/epoll_ ./a.out</td>
</tr>
<tr>
<td></td>
<td></td>
<td>trace=%file</td>
<td>跟踪<strong>含有文件名参数</strong>的系统调用</td>
<td>strace -e trace=%file ls /</td>
</tr>
<tr>
<td></td>
<td></td>
<td>trace=%process</td>
<td>跟踪所有<strong>进程管理相关</strong>的系统调用</td>
<td>strace -e trace=%process bash</td>
</tr>
<tr>
<td></td>
<td></td>
<td>trace=%network</td>
<td>跟踪所有<strong>网络相关</strong>的系统调用</td>
<td>strace -e trace=%network ping -c 1 github.com</td>
</tr>
<tr>
<td></td>
<td></td>
<td>trace=%signal</td>
<td>跟踪所有<strong>信号相关</strong>的系统调用</td>
<td>strace -e trace=%signal bash</td>
</tr>
<tr>
<td></td>
<td></td>
<td>trace=%ipc</td>
<td>跟踪所有<strong>进程间通信相关</strong>系统调用</td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td>trace=%desc</td>
<td>跟踪所有<strong>文件描述符相关</strong>的系统调用</td>
<td>strace -e trace=%desc ls /</td>
</tr>
<tr>
<td></td>
<td></td>
<td>trace=%memory</td>
<td>跟踪所有<strong>内存相关</strong>的系统调用</td>
<td>strace -e trace=%memory ls /</td>
</tr>
<tr>
<td></td>
<td></td>
<td>signal=set</td>
<td>跟踪<strong>指定信号集合中</strong>的系统调用</td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td>read=set</td>
<td>转储从文件描述符集合中读取的内容（<strong>不会过滤并仅保留 read 系统调用</strong>）</td>
<td>strace -e read=3,4,5 -e trace=read ls /</td>
</tr>
<tr>
<td></td>
<td></td>
<td>write=set</td>
<td>转储往文件描述符集合中写入的内容（<strong>不会过滤并仅保留 write 系统调用</strong>）</td>
<td>strace -e write=1,3,5 -e trace=write echo &ldquo;hello world&rdquo;</td>
</tr>
<tr>
<td></td>
<td></td>
<td>raw=set</td>
<td>不解码<strong>以原生（十六进制）形式显示</strong>系统调用参数值</td>
<td>strace -e raw=read -e trace=read,write ls -l /</td>
</tr>
<tr>
<td></td>
<td>-P</td>
<td>文件路径</td>
<td>跟踪<strong>访问指定路径的系统调用</strong>（可指定多个文件路径）</td>
<td>strace -P /dev/stdout -P /dev/fd/1 -y ls /</td>
</tr>
<tr>
<td></td>
<td>-v</td>
<td>无</td>
<td>打印详细信息</td>
<td>strace -v ls /</td>
</tr>
<tr>
<td>Tracing</td>
<td>-f</td>
<td>无</td>
<td>跟踪<strong>由 fork 、vfork、 clone 等系统调用创建的子进程</strong></td>
<td>strace -f -e trace=fork,vfork,clone ./a.out</td>
</tr>
<tr>
<td></td>
<td>-ff</td>
<td>无</td>
<td>与<code>-o</code>选项一起使用，会将输出写入名为<code>filename.pid</code>的文件中（不能与<code>-c</code>一同使用）。</td>
<td>strace -o trace.log -ff -f -e trace=clone ./a.out</td>
</tr>
<tr>
<td>Startup</td>
<td>-E</td>
<td>环境变量名=值</td>
<td>启动进程时为进程提供额外的<strong>环境变量列表</strong></td>
<td>strace -E NAME=voidint -E AGE=24 -e trace=write sh -c &lsquo;echo $NAME;echo $AGE&rsquo;</td>
</tr>
<tr>
<td></td>
<td>-p</td>
<td>进程ID</td>
<td>待跟踪的<strong>目标进程ID</strong>（若要跟踪多个进程，可多次指定<code>-p</code>选项）</td>
<td>strace -p 1234 -p 5678</td>
</tr>
<tr>
<td>Miscellaneous</td>
<td>-V</td>
<td>无</td>
<td>打印 strace 版本信息</td>
<td>strace -V</td>
</tr>
</tbody>
</table>
<h1 id="示例">示例</h1>
<h3 id="1跟踪程序运行过程中发起的所有的系统调用">1、跟踪程序运行过程中发起的所有的系统调用</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="c1"># strace ls</span>
execve<span class="o">(</span><span class="s2">&#34;/usr/bin/ls&#34;</span>, <span class="o">[</span><span class="s2">&#34;ls&#34;</span><span class="o">]</span>, 0x7ffc202c4e10 /* <span class="m">29</span> vars */<span class="o">)</span> <span class="o">=</span> <span class="m">0</span>
brk<span class="o">(</span>NULL<span class="o">)</span>                               <span class="o">=</span> 0x55c6f9104000
arch_prctl<span class="o">(</span>0x3001 /* ARCH_??? */, 0x7ffc285a5640<span class="o">)</span> <span class="o">=</span> -1 EINVAL <span class="o">(</span>Invalid argument<span class="o">)</span>
access<span class="o">(</span><span class="s2">&#34;/etc/ld.so.preload&#34;</span>, R_OK<span class="o">)</span>      <span class="o">=</span> -1 ENOENT <span class="o">(</span>No such file or directory<span class="o">)</span>
openat<span class="o">(</span>AT_FDCWD, <span class="s2">&#34;/etc/ld.so.cache&#34;</span>, O_RDONLY<span class="p">|</span>O_CLOEXEC<span class="o">)</span> <span class="o">=</span> <span class="m">3</span>
fstat<span class="o">(</span>3, <span class="o">{</span><span class="nv">st_mode</span><span class="o">=</span>S_IFREG<span class="p">|</span>0644, <span class="nv">st_size</span><span class="o">=</span>39762, ...<span class="o">})</span> <span class="o">=</span> <span class="m">0</span>
mmap<span class="o">(</span>NULL, 39762, PROT_READ, MAP_PRIVATE, 3, 0<span class="o">)</span> <span class="o">=</span> 0x7f72740d5000
close<span class="o">(</span>3<span class="o">)</span>                                <span class="o">=</span> <span class="m">0</span>
openat<span class="o">(</span>AT_FDCWD, <span class="s2">&#34;/lib64/libselinux.so.1&#34;</span>, O_RDONLY<span class="p">|</span>O_CLOEXEC<span class="o">)</span> <span class="o">=</span> <span class="m">3</span>
read<span class="o">(</span>3, <span class="s2">&#34;\177ELF\2\1\1\0\0\0\0\0\0\0\0\0\3\0&gt;\0\1\0\0\0\200z\0\0\0\0\0\0&#34;</span>..., 832<span class="o">)</span> <span class="o">=</span> <span class="m">832</span>
lseek<span class="o">(</span>3, 157040, SEEK_SET<span class="o">)</span>              <span class="o">=</span> <span class="m">157040</span>
......
......
......
openat<span class="o">(</span>AT_FDCWD, <span class="s2">&#34;/lib64/libpthread.so.0&#34;</span>, O_RDONLY<span class="p">|</span>O_CLOEXEC<span class="o">)</span> <span class="o">=</span> <span class="m">3</span>
read<span class="o">(</span>3, <span class="s2">&#34;\177ELF\2\1\1\0\0\0\0\0\0\0\0\0\3\0&gt;\0\1\0\0\0pn\0\0\0\0\0\0&#34;</span>..., 832<span class="o">)</span> <span class="o">=</span> <span class="m">832</span>
fstat<span class="o">(</span>3, <span class="o">{</span><span class="nv">st_mode</span><span class="o">=</span>S_IFREG<span class="p">|</span>0755, <span class="nv">st_size</span><span class="o">=</span>320504, ...<span class="o">})</span> <span class="o">=</span> <span class="m">0</span>
mmap<span class="o">(</span>NULL, 2225344, PROT_READ<span class="p">|</span>PROT_EXEC, MAP_PRIVATE<span class="p">|</span>MAP_DENYWRITE, 3, 0<span class="o">)</span> <span class="o">=</span> 0x7f727301c000
mprotect<span class="o">(</span>0x7f7273037000, 2093056, PROT_NONE<span class="o">)</span> <span class="o">=</span> <span class="m">0</span>
mmap<span class="o">(</span>0x7f7273236000, 8192, PROT_READ<span class="p">|</span>PROT_WRITE, MAP_PRIVATE<span class="p">|</span>MAP_FIXED<span class="p">|</span>MAP_DENYWRITE, 3, 0x1a000<span class="o">)</span> <span class="o">=</span> 0x7f7273236000
mmap<span class="o">(</span>0x7f7273238000, 13504, PROT_READ<span class="p">|</span>PROT_WRITE, MAP_PRIVATE<span class="p">|</span>MAP_FIXED<span class="p">|</span>MAP_ANONYMOUS, -1, 0<span class="o">)</span> <span class="o">=</span> 0x7f7273238000
close<span class="o">(</span>3<span class="o">)</span>                                <span class="o">=</span> <span class="m">0</span>
mmap<span class="o">(</span>NULL, 8192, PROT_READ<span class="p">|</span>PROT_WRITE, MAP_PRIVATE<span class="p">|</span>MAP_ANONYMOUS, -1, 0<span class="o">)</span> <span class="o">=</span> 0x7f72740d1000
mmap<span class="o">(</span>NULL, 8192, PROT_READ<span class="p">|</span>PROT_WRITE, MAP_PRIVATE<span class="p">|</span>MAP_ANONYMOUS, -1, 0<span class="o">)</span> <span class="o">=</span> 0x7f72740cf000
arch_prctl<span class="o">(</span>ARCH_SET_FS, 0x7f72740d2640<span class="o">)</span> <span class="o">=</span> <span class="m">0</span>
mprotect<span class="o">(</span>0x7f7273a7d000, 16384, PROT_READ<span class="o">)</span> <span class="o">=</span> <span class="m">0</span>
mprotect<span class="o">(</span>0x7f7273236000, 4096, PROT_READ<span class="o">)</span> <span class="o">=</span> <span class="m">0</span>
mprotect<span class="o">(</span>0x7f727343e000, 4096, PROT_READ<span class="o">)</span> <span class="o">=</span> <span class="m">0</span>
mprotect<span class="o">(</span>0x7f72736c2000, 4096, PROT_READ<span class="o">)</span> <span class="o">=</span> <span class="m">0</span>
mprotect<span class="o">(</span>0x7f7273c8b000, 4096, PROT_READ<span class="o">)</span> <span class="o">=</span> <span class="m">0</span>
mprotect<span class="o">(</span>0x7f7273eb3000, 4096, PROT_READ<span class="o">)</span> <span class="o">=</span> <span class="m">0</span>
mprotect<span class="o">(</span>0x55c6f7c2f000, 8192, PROT_READ<span class="o">)</span> <span class="o">=</span> <span class="m">0</span>
mprotect<span class="o">(</span>0x7f72740df000, 4096, PROT_READ<span class="o">)</span> <span class="o">=</span> <span class="m">0</span>
munmap<span class="o">(</span>0x7f72740d5000, 39762<span class="o">)</span>           <span class="o">=</span> <span class="m">0</span>
set_tid_address<span class="o">(</span>0x7f72740d2910<span class="o">)</span>         <span class="o">=</span> <span class="m">2351897</span>
set_robust_list<span class="o">(</span>0x7f72740d2920, 24<span class="o">)</span>     <span class="o">=</span> <span class="m">0</span>
rt_sigaction<span class="o">(</span>SIGRTMIN, <span class="o">{</span><span class="nv">sa_handler</span><span class="o">=</span>0x7f72730228f0, <span class="nv">sa_mask</span><span class="o">=[]</span>, <span class="nv">sa_flags</span><span class="o">=</span>SA_RESTORER<span class="p">|</span>SA_SIGINFO, <span class="nv">sa_restorer</span><span class="o">=</span>0x7f727302eb20<span class="o">}</span>, NULL, 8<span class="o">)</span> <span class="o">=</span> <span class="m">0</span>
rt_sigaction<span class="o">(</span>SIGRT_1, <span class="o">{</span><span class="nv">sa_handler</span><span class="o">=</span>0x7f7273022980, <span class="nv">sa_mask</span><span class="o">=[]</span>, <span class="nv">sa_flags</span><span class="o">=</span>SA_RESTORER<span class="p">|</span>SA_RESTART<span class="p">|</span>SA_SIGINFO, <span class="nv">sa_restorer</span><span class="o">=</span>0x7f727302eb20<span class="o">}</span>, NULL, 8<span class="o">)</span> <span class="o">=</span> <span class="m">0</span>
rt_sigprocmask<span class="o">(</span>SIG_UNBLOCK, <span class="o">[</span>RTMIN RT_1<span class="o">]</span>, NULL, 8<span class="o">)</span> <span class="o">=</span> <span class="m">0</span>
prlimit64<span class="o">(</span>0, RLIMIT_STACK, NULL, <span class="o">{</span><span class="nv">rlim_cur</span><span class="o">=</span>8192*1024, <span class="nv">rlim_max</span><span class="o">=</span>RLIM64_INFINITY<span class="o">})</span> <span class="o">=</span> <span class="m">0</span>
statfs<span class="o">(</span><span class="s2">&#34;/sys/fs/selinux&#34;</span>, 0x7ffc285a5590<span class="o">)</span> <span class="o">=</span> -1 ENOENT <span class="o">(</span>No such file or directory<span class="o">)</span>
statfs<span class="o">(</span><span class="s2">&#34;/selinux&#34;</span>, 0x7ffc285a5590<span class="o">)</span>      <span class="o">=</span> -1 ENOENT <span class="o">(</span>No such file or directory<span class="o">)</span>
brk<span class="o">(</span>NULL<span class="o">)</span>                               <span class="o">=</span> 0x55c6f9104000
brk<span class="o">(</span>0x55c6f9125000<span class="o">)</span>                     <span class="o">=</span> 0x55c6f9125000
openat<span class="o">(</span>AT_FDCWD, <span class="s2">&#34;/proc/filesystems&#34;</span>, O_RDONLY<span class="p">|</span>O_CLOEXEC<span class="o">)</span> <span class="o">=</span> <span class="m">3</span>
fstat<span class="o">(</span>3, <span class="o">{</span><span class="nv">st_mode</span><span class="o">=</span>S_IFREG<span class="p">|</span>0444, <span class="nv">st_size</span><span class="o">=</span>0, ...<span class="o">})</span> <span class="o">=</span> <span class="m">0</span>
read<span class="o">(</span>3, <span class="s2">&#34;nodev\tsysfs\nnodev\trootfs\nnodev\tr&#34;</span>..., 1024<span class="o">)</span> <span class="o">=</span> <span class="m">327</span>
read<span class="o">(</span>3, <span class="s2">&#34;&#34;</span>, 1024<span class="o">)</span>                       <span class="o">=</span> <span class="m">0</span>
close<span class="o">(</span>3<span class="o">)</span>                                <span class="o">=</span> <span class="m">0</span>
access<span class="o">(</span><span class="s2">&#34;/etc/selinux/config&#34;</span>, F_OK<span class="o">)</span>     <span class="o">=</span> <span class="m">0</span>
openat<span class="o">(</span>AT_FDCWD, <span class="s2">&#34;/usr/lib/locale/locale-archive&#34;</span>, O_RDONLY<span class="p">|</span>O_CLOEXEC<span class="o">)</span> <span class="o">=</span> -1 ENOENT <span class="o">(</span>No such file or directory<span class="o">)</span>
openat<span class="o">(</span>AT_FDCWD, <span class="s2">&#34;/usr/share/locale/locale.alias&#34;</span>, O_RDONLY<span class="p">|</span>O_CLOEXEC<span class="o">)</span> <span class="o">=</span> <span class="m">3</span>
fstat<span class="o">(</span>3, <span class="o">{</span><span class="nv">st_mode</span><span class="o">=</span>S_IFREG<span class="p">|</span>0644, <span class="nv">st_size</span><span class="o">=</span>2997, ...<span class="o">})</span> <span class="o">=</span> <span class="m">0</span>
read<span class="o">(</span>3, <span class="s2">&#34;# Locale name alias data base.\n#&#34;</span>..., 4096<span class="o">)</span> <span class="o">=</span> <span class="m">2997</span>
read<span class="o">(</span>3, <span class="s2">&#34;&#34;</span>, 4096<span class="o">)</span>                       <span class="o">=</span> <span class="m">0</span>
close<span class="o">(</span>3<span class="o">)</span>                                <span class="o">=</span> <span class="m">0</span>
......
......
......
openat<span class="o">(</span>AT_FDCWD, <span class="s2">&#34;/usr/lib/locale/en_US.UTF-8/LC_CTYPE&#34;</span>, O_RDONLY<span class="p">|</span>O_CLOEXEC<span class="o">)</span> <span class="o">=</span> -1 ENOENT <span class="o">(</span>No such file or directory<span class="o">)</span>
openat<span class="o">(</span>AT_FDCWD, <span class="s2">&#34;/usr/lib/locale/en_US.utf8/LC_CTYPE&#34;</span>, O_RDONLY<span class="p">|</span>O_CLOEXEC<span class="o">)</span> <span class="o">=</span> <span class="m">3</span>
fstat<span class="o">(</span>3, <span class="o">{</span><span class="nv">st_mode</span><span class="o">=</span>S_IFREG<span class="p">|</span>0644, <span class="nv">st_size</span><span class="o">=</span>337024, ...<span class="o">})</span> <span class="o">=</span> <span class="m">0</span>
mmap<span class="o">(</span>NULL, 337024, PROT_READ, MAP_PRIVATE, 3, 0<span class="o">)</span> <span class="o">=</span> 0x7f7274075000
close<span class="o">(</span>3<span class="o">)</span>                                <span class="o">=</span> <span class="m">0</span>
ioctl<span class="o">(</span>1, TCGETS, <span class="o">{</span>B38400 opost isig icanon <span class="nb">echo</span> ...<span class="o">})</span> <span class="o">=</span> <span class="m">0</span>
ioctl<span class="o">(</span>1, TIOCGWINSZ, <span class="o">{</span><span class="nv">ws_row</span><span class="o">=</span>48, <span class="nv">ws_col</span><span class="o">=</span>204, <span class="nv">ws_xpixel</span><span class="o">=</span>2856, <span class="nv">ws_ypixel</span><span class="o">=</span>1632<span class="o">})</span> <span class="o">=</span> <span class="m">0</span>
openat<span class="o">(</span>AT_FDCWD, <span class="s2">&#34;.&#34;</span>, O_RDONLY<span class="p">|</span>O_NONBLOCK<span class="p">|</span>O_CLOEXEC<span class="p">|</span>O_DIRECTORY<span class="o">)</span> <span class="o">=</span> <span class="m">3</span>
fstat<span class="o">(</span>3, <span class="o">{</span><span class="nv">st_mode</span><span class="o">=</span>S_IFDIR<span class="p">|</span>0550, <span class="nv">st_size</span><span class="o">=</span>4096, ...<span class="o">})</span> <span class="o">=</span> <span class="m">0</span>
getdents64<span class="o">(</span>3, /* <span class="m">26</span> entries */, 32768<span class="o">)</span>  <span class="o">=</span> <span class="m">800</span>
getdents64<span class="o">(</span>3, /* <span class="m">0</span> entries */, 32768<span class="o">)</span>   <span class="o">=</span> <span class="m">0</span>
close<span class="o">(</span>3<span class="o">)</span>                                <span class="o">=</span> <span class="m">0</span>
fstat<span class="o">(</span>1, <span class="o">{</span><span class="nv">st_mode</span><span class="o">=</span>S_IFCHR<span class="p">|</span>0620, <span class="nv">st_rdev</span><span class="o">=</span>makedev<span class="o">(</span>0x88, 0x1<span class="o">)</span>, ...<span class="o">})</span> <span class="o">=</span> <span class="m">0</span>
write<span class="o">(</span>1, <span class="s2">&#34;bin  check.sh  go  install.sh  l&#34;</span>..., 76bin  check.sh  go  install.sh  linuxc  valgrind  valgrind-3.17.0  workspace
<span class="o">)</span> <span class="o">=</span> <span class="m">76</span>
close<span class="o">(</span>1<span class="o">)</span>                                <span class="o">=</span> <span class="m">0</span>
close<span class="o">(</span>2<span class="o">)</span>                                <span class="o">=</span> <span class="m">0</span>
exit_group<span class="o">(</span>0<span class="o">)</span>                           <span class="o">=</span> ?
+++ exited with <span class="m">0</span> +++
</code></pre></td></tr></table>
</div>
</div><p>是不是很惊讶，一个 ls 命令竟然产生了这么多的系统调用（当然其中也包含了一部分 strace 进程 fork 和 execve 目标程序的系统调用）。其中，有不少内容我做了适当省略，的确是输出太多。</p>
<h3 id="2跟踪已运行进程实时发起的系统调用">2、跟踪已运行进程实时发起的系统调用</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="c1"># strace -p $(pidof rsyslogd)</span>
strace: Process <span class="m">994</span> attached
<span class="k">select</span><span class="o">(</span>1, NULL, NULL, NULL, <span class="o">{</span><span class="nv">tv_sec</span><span class="o">=</span>212, <span class="nv">tv_usec</span><span class="o">=</span>794547<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>此处以守护进程 rsyslogd 为例，尝试去跟踪该进程的系统调用。一般线上问题排查场景也是附加到一个正在运行的进程上，观察该进程的系统调用，看是否有错误发生，看是否某个系统调用执行时间过长等。</p>
<h3 id="3统计每个系统调动的耗时调用次数失败数">3、统计每个系统调动的耗时、调用次数、失败数</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="c1"># strace -c ping -c 1 github.com</span>
PING github.com <span class="o">(</span>10.23.253.91<span class="o">)</span> 56<span class="o">(</span>84<span class="o">)</span> bytes of data.
<span class="m">64</span> bytes from 10.23.253.91 <span class="o">(</span>10.23.253.91<span class="o">)</span>: <span class="nv">icmp_seq</span><span class="o">=</span><span class="m">1</span> <span class="nv">ttl</span><span class="o">=</span><span class="m">63</span> <span class="nv">time</span><span class="o">=</span>0.845 ms

--- github.com ping statistics ---
<span class="m">1</span> packets transmitted, <span class="m">1</span> received, 0% packet loss, <span class="nb">time</span> 0ms
rtt min/avg/max/mdev <span class="o">=</span> 0.845/0.845/0.845/0.000 ms
% <span class="nb">time</span>     seconds  usecs/call     calls    errors syscall
------ ----------- ----------- --------- --------- ----------------
 16.82    0.000144           <span class="m">2</span>        <span class="m">71</span>           mmap
 15.54    0.000133           <span class="m">2</span>        <span class="m">60</span>        <span class="m">14</span> openat
 13.43    0.000115           <span class="m">2</span>        <span class="m">42</span>           mprotect
  8.64    0.000074           <span class="m">1</span>        <span class="m">60</span>           <span class="nb">read</span>
  7.01    0.000060          <span class="m">60</span>         <span class="m">1</span>           sendmmsg
  6.43    0.000055           <span class="m">1</span>        <span class="m">53</span>           close
  5.72    0.000049           <span class="m">1</span>        <span class="m">47</span>           fstat
  5.49    0.000047           <span class="m">4</span>        <span class="m">11</span>         <span class="m">2</span> socket
  3.62    0.000031           <span class="m">6</span>         <span class="m">5</span>         <span class="m">2</span> connect
  2.92    0.000025           <span class="m">6</span>         <span class="m">4</span>           sendto
  2.69    0.000023           <span class="m">5</span>         <span class="m">4</span>           munmap
  2.10    0.000018           <span class="m">0</span>        <span class="m">29</span>           lseek
  1.75    0.000015           <span class="m">1</span>        <span class="m">11</span>           setsockopt
  0.93    0.000008           <span class="m">1</span>         <span class="m">5</span>           poll
  0.82    0.000007           <span class="m">2</span>         <span class="m">3</span>           recvfrom
  0.70    0.000006           <span class="m">1</span>         <span class="m">6</span>           write
  0.70    0.000006           <span class="m">1</span>         <span class="m">5</span>           ioctl
  0.70    0.000006           <span class="m">0</span>         <span class="m">7</span>           capget
  0.47    0.000004           <span class="m">2</span>         <span class="m">2</span>           stat
  0.47    0.000004           <span class="m">0</span>         <span class="m">5</span>           rt_sigaction
  0.47    0.000004           <span class="m">1</span>         <span class="m">3</span>           capset
  0.23    0.000002           <span class="m">0</span>         <span class="m">6</span>           brk
  0.23    0.000002           <span class="m">0</span>         <span class="m">4</span>           rt_sigprocmask
  0.23    0.000002           <span class="m">0</span>         <span class="m">3</span>         <span class="m">2</span> access
  0.23    0.000002           <span class="m">2</span>         <span class="m">1</span>           setitimer
  0.23    0.000002           <span class="m">0</span>         <span class="m">3</span>           getsockname
  0.23    0.000002           <span class="m">0</span>         <span class="m">5</span>           getsockopt
  0.23    0.000002           <span class="m">1</span>         <span class="m">2</span>           futex
  0.12    0.000001           <span class="m">0</span>         <span class="m">2</span>           getpid
  0.12    0.000001           <span class="m">0</span>        <span class="m">15</span>           recvmsg
  0.12    0.000001           <span class="m">1</span>         <span class="m">1</span>           uname
  0.12    0.000001           <span class="m">1</span>         <span class="m">1</span>           setuid
  0.12    0.000001           <span class="m">1</span>         <span class="m">1</span>           geteuid
  0.12    0.000001           <span class="m">0</span>         <span class="m">2</span>           prctl
  0.12    0.000001           <span class="m">0</span>         <span class="m">2</span>         <span class="m">1</span> arch_prctl
  0.12    0.000001           <span class="m">1</span>         <span class="m">1</span>           prlimit64
  0.00    0.000000           <span class="m">0</span>         <span class="m">2</span>           <span class="nb">bind</span>
  0.00    0.000000           <span class="m">0</span>         <span class="m">1</span>           execve
  0.00    0.000000           <span class="m">0</span>         <span class="m">2</span>           getuid
  0.00    0.000000           <span class="m">0</span>         <span class="m">2</span>         <span class="m">2</span> statfs
  0.00    0.000000           <span class="m">0</span>         <span class="m">1</span>           set_tid_address
  0.00    0.000000           <span class="m">0</span>         <span class="m">5</span>           ppoll
  0.00    0.000000           <span class="m">0</span>         <span class="m">1</span>           set_robust_list
------ ----------- ----------- --------- --------- ----------------
100.00    0.000856                   <span class="m">497</span>        <span class="m">23</span> total
</code></pre></td></tr></table>
</div>
</div><h3 id="4跟踪指定名称的系统调用">4、跟踪指定名称的系统调用</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="c1"># strace -e trace=read,write ls /</span>
read<span class="o">(</span>3, <span class="s2">&#34;\177ELF\2\1\1\0\0\0\0\0\0\0\0\0\3\0&gt;\0\1\0\0\0\200z\0\0\0\0\0\0&#34;</span>..., 832<span class="o">)</span> <span class="o">=</span> <span class="m">832</span>
read<span class="o">(</span>3, <span class="s2">&#34;\4\0\0\0 \0\0\0\5\0\0\0GNU\0\1\0\0\300\4\0\0\0\30\0\0\0\0\0\0\0&#34;</span>..., 48<span class="o">)</span> <span class="o">=</span> <span class="m">48</span>
read<span class="o">(</span>3, <span class="s2">&#34;\4\0\0\0 \0\0\0\5\0\0\0GNU\0\1\0\0\300\4\0\0\0\30\0\0\0\0\0\0\0&#34;</span>..., 48<span class="o">)</span> <span class="o">=</span> <span class="m">48</span>
read<span class="o">(</span>3, <span class="s2">&#34;\177ELF\2\1\1\0\0\0\0\0\0\0\0\0\3\0&gt;\0\1\0\0\0\300\30\0\0\0\0\0\0&#34;</span>..., 832<span class="o">)</span> <span class="o">=</span> <span class="m">832</span>
read<span class="o">(</span>3, <span class="s2">&#34;\4\0\0\0\20\0\0\0\5\0\0\0GNU\0\2\0\0\300\4\0\0\0\3\0\0\0\0\0\0\0&#34;</span>, 32<span class="o">)</span> <span class="o">=</span> <span class="m">32</span>
read<span class="o">(</span>3, <span class="s2">&#34;\4\0\0\0\20\0\0\0\5\0\0\0GNU\0\2\0\0\300\4\0\0\0\3\0\0\0\0\0\0\0&#34;</span>, 32<span class="o">)</span> <span class="o">=</span> <span class="m">32</span>
read<span class="o">(</span>3, <span class="s2">&#34;\177ELF\2\1\1\3\0\0\0\0\0\0\0\0\3\0&gt;\0\1\0\0\0\3008\2\0\0\0\0\0&#34;</span>..., 832<span class="o">)</span> <span class="o">=</span> <span class="m">832</span>
read<span class="o">(</span>3, <span class="s2">&#34;\4\0\0\0\20\0\0\0\5\0\0\0GNU\0\2\0\0\300\4\0\0\0\3\0\0\0\0\0\0\0&#34;</span>, 32<span class="o">)</span> <span class="o">=</span> <span class="m">32</span>
read<span class="o">(</span>3, <span class="s2">&#34;\177ELF\2\1\1\0\0\0\0\0\0\0\0\0\3\0&gt;\0\1\0\0\0\200#\0\0\0\0\0\0&#34;</span>..., 832<span class="o">)</span> <span class="o">=</span> <span class="m">832</span>
read<span class="o">(</span>3, <span class="s2">&#34;\4\0\0\0\20\0\0\0\5\0\0\0GNU\0\2\0\0\300\4\0\0\0\3\0\0\0\0\0\0\0&#34;</span>, 32<span class="o">)</span> <span class="o">=</span> <span class="m">32</span>
read<span class="o">(</span>3, <span class="s2">&#34;\4\0\0\0\20\0\0\0\5\0\0\0GNU\0\2\0\0\300\4\0\0\0\3\0\0\0\0\0\0\0&#34;</span>, 32<span class="o">)</span> <span class="o">=</span> <span class="m">32</span>
read<span class="o">(</span>3, <span class="s2">&#34;\177ELF\2\1\1\0\0\0\0\0\0\0\0\0\3\0&gt;\0\1\0\0\0\300\20\0\0\0\0\0\0&#34;</span>..., 832<span class="o">)</span> <span class="o">=</span> <span class="m">832</span>
read<span class="o">(</span>3, <span class="s2">&#34;\177ELF\2\1\1\0\0\0\0\0\0\0\0\0\3\0&gt;\0\1\0\0\0pn\0\0\0\0\0\0&#34;</span>..., 832<span class="o">)</span> <span class="o">=</span> <span class="m">832</span>
read<span class="o">(</span>3, <span class="s2">&#34;nodev\tsysfs\nnodev\trootfs\nnodev\tr&#34;</span>..., 1024<span class="o">)</span> <span class="o">=</span> <span class="m">327</span>
read<span class="o">(</span>3, <span class="s2">&#34;&#34;</span>, 1024<span class="o">)</span>                       <span class="o">=</span> <span class="m">0</span>
read<span class="o">(</span>3, <span class="s2">&#34;# Locale name alias data base.\n#&#34;</span>..., 4096<span class="o">)</span> <span class="o">=</span> <span class="m">2997</span>
read<span class="o">(</span>3, <span class="s2">&#34;&#34;</span>, 4096<span class="o">)</span>                       <span class="o">=</span> <span class="m">0</span>
write<span class="o">(</span>1, <span class="s2">&#34;bin  boot  dev\tetc  home  lib\tli&#34;</span>..., 100bin  boot  dev	etc  home  lib	lib64  media  mnt  opt	proc  root  run  sbin  srv  sys  tmp  usr  var
<span class="o">)</span> <span class="o">=</span> <span class="m">100</span>
+++ exited with <span class="m">0</span> +++
</code></pre></td></tr></table>
</div>
</div><p>如今这个社会不同于古代社会，信息过载让人眼花缭乱，因此信息的过滤提炼变得尤为重要。而<code>-e</code>选项就是 strace 工具提供的最重要的过滤选项。对于想要跟踪特定的某几个系统调用的需求，只需要指定<code>-e trace=syscall1,syscall2,syscall3</code>的选项，那么输出的内容将只会保留你所指定的那三个系统调用，其它无关系统调用均不会被展示。</p>
<h3 id="5跟踪匹配正则表达式的系统调用">5、跟踪匹配正则表达式的系统调用</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="c1"># strace -e trace=/get ping -c 1 github.com</span>
capget<span class="o">({</span><span class="nv">version</span><span class="o">=</span>_LINUX_CAPABILITY_VERSION_3, <span class="nv">pid</span><span class="o">=</span>0<span class="o">}</span>, NULL<span class="o">)</span> <span class="o">=</span> <span class="m">0</span>
capget<span class="o">({</span><span class="nv">version</span><span class="o">=</span>_LINUX_CAPABILITY_VERSION_3, <span class="nv">pid</span><span class="o">=</span>0<span class="o">}</span>, <span class="o">{</span><span class="nv">effective</span><span class="o">=</span>1<span class="s">&lt;&lt;CAP_CHOWN|1&lt;&lt;CAP_DAC_OVERRIDE|1&lt;&lt;CAP_DAC_READ_SEARCH|1&lt;&lt;CAP_FOWNER|1&lt;&lt;CAP_FSETID|1&lt;&lt;CAP_KILL|1&lt;&lt;CAP_SETGID|1&lt;&lt;CAP_SETUID|1&lt;&lt;CAP_SETPCAP|1&lt;&lt;CAP_LINUX_IMMUTABLE|1&lt;&lt;CAP_NET_BIND_SERVICE|1&lt;&lt;CAP_NET_BROADCAST|1&lt;&lt;CAP_NET_ADMIN|1&lt;&lt;CAP_NET_RAW|1&lt;&lt;CAP_IPC_LOCK|1&lt;&lt;CAP_IPC_OWNER|1&lt;&lt;CAP_SYS_MODULE|1&lt;&lt;CAP_SYS_RAWIO|1&lt;&lt;CAP_SYS_CHROOT|1&lt;&lt;CAP_SYS_PTRACE|1&lt;&lt;CAP_SYS_PACCT|1&lt;&lt;CAP_SYS_ADMIN|1&lt;&lt;CAP_SYS_BOOT|1&lt;&lt;CAP_SYS_NICE|1&lt;&lt;CAP_SYS_RESOURCE|1&lt;&lt;CAP_SYS_TIME|1&lt;&lt;CAP_SYS_TTY_CONFIG|1&lt;&lt;CAP_MKNOD|1&lt;&lt;CAP_LEASE|1&lt;&lt;CAP_AUDIT_WRITE|1&lt;&lt;CAP_AUDIT_CONTROL|1&lt;&lt;CAP_SETFCAP|1&lt;&lt;CAP_MAC_OVERRIDE|1&lt;&lt;CAP_MAC_ADMIN|1&lt;&lt;CAP_SYSLOG|1&lt;&lt;CAP_WAKE_ALARM|1&lt;&lt;CAP_BLOCK_SUSPEND|1&lt;&lt;CAP_AUDIT_READ, permitted=1&lt;&lt;CAP_CHOWN</span><span class="p">|</span>1<span class="s">&lt;&lt;CAP_DAC_OVERRIDE|1&lt;&lt;CAP_DAC_</span>READ_SEARCH<span class="p">|</span>1<span class="s">&lt;&lt;CAP_FOWNER|1&lt;&lt;CAP_F</span>SETID<span class="p">|</span>1<span class="s">&lt;&lt;CAP_KILL|1&lt;&lt;CAP_</span>SETGID<span class="p">|</span>1<span class="s">&lt;&lt;CAP_SETUID|1&lt;&lt;CAP_SET</span>PCAP<span class="p">|</span>1<span class="s">&lt;&lt;CAP_LINUX_IMMUTABLE|1&lt;&lt;CAP_NET_BIND_SERVICE|1&lt;&lt;CAP_NET_BROADCAST|1&lt;&lt;CAP_NET_ADMIN|1&lt;&lt;CAP_NET_RAW|1&lt;&lt;CAP_IPC_LOCK|1&lt;&lt;CAP_IPC_OWNER|1&lt;&lt;CAP_SYS_MODULE|1&lt;&lt;CAP_SYS_RAWIO|1&lt;&lt;CAP_SYS_CHROOT|1&lt;&lt;CAP_SYS_PTRACE|1&lt;&lt;CAP_SYS_PACCT|1&lt;&lt;CAP_SYS_ADMIN|1&lt;&lt;CAP_SYS_BOOT|1&lt;&lt;CAP_SYS_NICE|1&lt;&lt;CAP_SYS_RESOURCE|1&lt;&lt;CAP_SYS_TIME|1&lt;&lt;CAP_SYS_TTY_CONFIG|1&lt;&lt;CAP_MKNOD|1&lt;&lt;CAP_L</span>EASE<span class="p">|</span>1<span class="s">&lt;&lt;CAP_AUDIT_WRITE|1&lt;&lt;CAP_AUDIT_</span>CONTROL<span class="p">|</span>1<span class="s">&lt;&lt;CAP_SETFCAP|1&lt;&lt;CAP_MAC_OVERRIDE|1&lt;&lt;CAP_MAC_ADMIN|1&lt;&lt;CAP_S</span>YSLOG<span class="p">|</span>1<span class="s">&lt;&lt;CAP_WAKE_ALARM|1&lt;&lt;CAP_</span>BLOCK_SUSPEND<span class="p">|</span>1<span class="s">&lt;&lt;CAP_AUDIT_READ, inheritable=0}) = 0
</span><span class="s">capget({version=_LINUX_CAPABILITY_VERSION_3, pid=0}, NULL) = 0
</span><span class="s">getuid()                                = 0
</span><span class="s">getuid()                                = 0
</span><span class="s">geteuid()                               = 0
</span><span class="s">capget({version=_LINUX_CAPABILITY_VERSION_3, pid=0}, NULL) = 0
</span><span class="s">capget({version=_LINUX_CAPABILITY_VERSION_3, pid=0}, {effective=0, permitted=1&lt;&lt;CAP_</span>NET_ADMIN<span class="p">|</span>1<span class="s">&lt;&lt;CAP_NET_RAW, inheritable=0}) = 0
</span><span class="s">capget({version=_LINUX_CAPABILITY_VERSION_3, pid=0}, NULL) = 0
</span><span class="s">capget({version=_LINUX_CAPABILITY_VERSION_3, pid=0}, {effective=1&lt;&lt;CAP_NET_RAW</span>, <span class="nv">permitted</span><span class="o">=</span>1<span class="s">&lt;&lt;CAP_NET_ADMIN|1&lt;&lt;CAP_NET_</span>RAW, <span class="nv">inheritable</span><span class="o">=</span>0<span class="o">})</span> <span class="o">=</span> <span class="m">0</span>
getsockname<span class="o">(</span>5, <span class="o">{</span><span class="nv">sa_family</span><span class="o">=</span>AF_INET, <span class="nv">sin_port</span><span class="o">=</span>htons<span class="o">(</span>35064<span class="o">)</span>, <span class="nv">sin_addr</span><span class="o">=</span>inet_addr<span class="o">(</span><span class="s2">&#34;10.23.182.41&#34;</span><span class="o">)}</span>, <span class="o">[</span>16<span class="o">])</span> <span class="o">=</span> <span class="m">0</span>
getsockopt<span class="o">(</span>3, SOL_SOCKET, SO_RCVBUF, <span class="o">[</span>131072<span class="o">]</span>, <span class="o">[</span>4<span class="o">])</span> <span class="o">=</span> <span class="m">0</span>
PING github.com <span class="o">(</span>10.23.253.91<span class="o">)</span> 56<span class="o">(</span>84<span class="o">)</span> bytes of data.
getpid<span class="o">()</span>                                <span class="o">=</span> <span class="m">2480162</span>
getpid<span class="o">()</span>                                <span class="o">=</span> <span class="m">2480162</span>
getsockopt<span class="o">(</span>5, SOL_SOCKET, SO_PROTOCOL, <span class="o">[</span>0<span class="o">]</span>, <span class="o">[</span>4<span class="o">])</span> <span class="o">=</span> <span class="m">0</span>
getsockname<span class="o">(</span>5, <span class="o">{</span><span class="nv">sa_family</span><span class="o">=</span>AF_NETLINK, <span class="nv">nl_pid</span><span class="o">=</span>2480162, <span class="nv">nl_groups</span><span class="o">=</span>00000000<span class="o">}</span>, <span class="o">[</span>16-&gt;12<span class="o">])</span> <span class="o">=</span> <span class="m">0</span>
getsockopt<span class="o">(</span>5, SOL_NETLINK, NETLINK_LIST_MEMBERSHIPS, NULL, <span class="o">[</span>0<span class="o">])</span> <span class="o">=</span> <span class="m">0</span>
getsockopt<span class="o">(</span>5, SOL_SOCKET, SO_PROTOCOL, <span class="o">[</span>0<span class="o">]</span>, <span class="o">[</span>4<span class="o">])</span> <span class="o">=</span> <span class="m">0</span>
getsockname<span class="o">(</span>5, <span class="o">{</span><span class="nv">sa_family</span><span class="o">=</span>AF_NETLINK, <span class="nv">nl_pid</span><span class="o">=</span>2480162, <span class="nv">nl_groups</span><span class="o">=</span>00000000<span class="o">}</span>, <span class="o">[</span>16-&gt;12<span class="o">])</span> <span class="o">=</span> <span class="m">0</span>
getsockopt<span class="o">(</span>5, SOL_NETLINK, NETLINK_LIST_MEMBERSHIPS, NULL, <span class="o">[</span>0<span class="o">])</span> <span class="o">=</span> <span class="m">0</span>
<span class="m">64</span> bytes from 10.23.253.91 <span class="o">(</span>10.23.253.91<span class="o">)</span>: <span class="nv">icmp_seq</span><span class="o">=</span><span class="m">1</span> <span class="nv">ttl</span><span class="o">=</span><span class="m">63</span> <span class="nv">time</span><span class="o">=</span>0.694 ms

--- github.com ping statistics ---
<span class="m">1</span> packets transmitted, <span class="m">1</span> received, 0% packet loss, <span class="nb">time</span> 0ms
rtt min/avg/max/mdev <span class="o">=</span> 0.694/0.694/0.694/0.000 ms
+++ exited with <span class="m">0</span> +++
</code></pre></td></tr></table>
</div>
</div><p>正则表达式是一个强大的工具，它也可以被用于 strace 工具的信息过滤中，<code>-e trace=/regex</code>选项正是为此功能所设计。</p>
<h3 id="6跟踪含有文件名参数的系统调用">6、跟踪含有文件名参数的系统调用</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="c1"># strace -e trace=%file ls /</span>
execve<span class="o">(</span><span class="s2">&#34;/usr/bin/ls&#34;</span>, <span class="o">[</span><span class="s2">&#34;ls&#34;</span>, <span class="s2">&#34;/&#34;</span><span class="o">]</span>, 0x7ffe731b8868 /* <span class="m">28</span> vars */<span class="o">)</span> <span class="o">=</span> <span class="m">0</span>
access<span class="o">(</span><span class="s2">&#34;/etc/ld.so.preload&#34;</span>, R_OK<span class="o">)</span>      <span class="o">=</span> -1 ENOENT <span class="o">(</span>No such file or directory<span class="o">)</span>
openat<span class="o">(</span>AT_FDCWD, <span class="s2">&#34;/etc/ld.so.cache&#34;</span>, O_RDONLY<span class="p">|</span>O_CLOEXEC<span class="o">)</span> <span class="o">=</span> <span class="m">3</span>
openat<span class="o">(</span>AT_FDCWD, <span class="s2">&#34;/lib64/libselinux.so.1&#34;</span>, O_RDONLY<span class="p">|</span>O_CLOEXEC<span class="o">)</span> <span class="o">=</span> <span class="m">3</span>
openat<span class="o">(</span>AT_FDCWD, <span class="s2">&#34;/lib64/libcap.so.2&#34;</span>, O_RDONLY<span class="p">|</span>O_CLOEXEC<span class="o">)</span> <span class="o">=</span> <span class="m">3</span>
openat<span class="o">(</span>AT_FDCWD, <span class="s2">&#34;/lib64/libc.so.6&#34;</span>, O_RDONLY<span class="p">|</span>O_CLOEXEC<span class="o">)</span> <span class="o">=</span> <span class="m">3</span>
openat<span class="o">(</span>AT_FDCWD, <span class="s2">&#34;/lib64/libpcre2-8.so.0&#34;</span>, O_RDONLY<span class="p">|</span>O_CLOEXEC<span class="o">)</span> <span class="o">=</span> <span class="m">3</span>
openat<span class="o">(</span>AT_FDCWD, <span class="s2">&#34;/lib64/libdl.so.2&#34;</span>, O_RDONLY<span class="p">|</span>O_CLOEXEC<span class="o">)</span> <span class="o">=</span> <span class="m">3</span>
openat<span class="o">(</span>AT_FDCWD, <span class="s2">&#34;/lib64/libpthread.so.0&#34;</span>, O_RDONLY<span class="p">|</span>O_CLOEXEC<span class="o">)</span> <span class="o">=</span> <span class="m">3</span>
statfs<span class="o">(</span><span class="s2">&#34;/sys/fs/selinux&#34;</span>, 0x7ffe4f0c32a0<span class="o">)</span> <span class="o">=</span> -1 ENOENT <span class="o">(</span>No such file or directory<span class="o">)</span>
statfs<span class="o">(</span><span class="s2">&#34;/selinux&#34;</span>, 0x7ffe4f0c32a0<span class="o">)</span>      <span class="o">=</span> -1 ENOENT <span class="o">(</span>No such file or directory<span class="o">)</span>
openat<span class="o">(</span>AT_FDCWD, <span class="s2">&#34;/proc/filesystems&#34;</span>, O_RDONLY<span class="p">|</span>O_CLOEXEC<span class="o">)</span> <span class="o">=</span> <span class="m">3</span>
access<span class="o">(</span><span class="s2">&#34;/etc/selinux/config&#34;</span>, F_OK<span class="o">)</span>     <span class="o">=</span> <span class="m">0</span>
openat<span class="o">(</span>AT_FDCWD, <span class="s2">&#34;/usr/lib/locale/locale-archive&#34;</span>, O_RDONLY<span class="p">|</span>O_CLOEXEC<span class="o">)</span> <span class="o">=</span> -1 ENOENT <span class="o">(</span>No such file or directory<span class="o">)</span>
......
......
openat<span class="o">(</span>AT_FDCWD, <span class="s2">&#34;/usr/lib/locale/en_US.utf8/LC_CTYPE&#34;</span>, O_RDONLY<span class="p">|</span>O_CLOEXEC<span class="o">)</span> <span class="o">=</span> <span class="m">3</span>
stat<span class="o">(</span><span class="s2">&#34;/&#34;</span>, <span class="o">{</span><span class="nv">st_mode</span><span class="o">=</span>S_IFDIR<span class="p">|</span>0555, <span class="nv">st_size</span><span class="o">=</span>244, ...<span class="o">})</span> <span class="o">=</span> <span class="m">0</span>
openat<span class="o">(</span>AT_FDCWD, <span class="s2">&#34;/&#34;</span>, O_RDONLY<span class="p">|</span>O_NONBLOCK<span class="p">|</span>O_CLOEXEC<span class="p">|</span>O_DIRECTORY<span class="o">)</span> <span class="o">=</span> <span class="m">3</span>
bin  boot  dev	etc  home  lib	lib64  media  mnt  opt	proc  root  run  sbin  srv  sys  tmp  usr  var
+++ exited with <span class="m">0</span> +++
</code></pre></td></tr></table>
</div>
</div><p>仔细观察上面的示例可以发现，指定<code>-e trace=%file</code>选项后，输出的内容拥有一个共同的特点，即均是包含文件名参数的系统调用。</p>
<h3 id="7跟踪进程管理相关的系统调用">7、跟踪进程管理相关的系统调用</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="c1"># strace -e trace=%process bash</span>
execve<span class="o">(</span><span class="s2">&#34;/usr/bin/bash&#34;</span>, <span class="o">[</span><span class="s2">&#34;bash&#34;</span><span class="o">]</span>, 0x7fffbd1b18f0 /* <span class="m">28</span> vars */<span class="o">)</span> <span class="o">=</span> <span class="m">0</span>
arch_prctl<span class="o">(</span>0x3001 /* ARCH_??? */, 0x7fff45b89800<span class="o">)</span> <span class="o">=</span> -1 EINVAL <span class="o">(</span>Invalid argument<span class="o">)</span>
arch_prctl<span class="o">(</span>ARCH_SET_FS, 0x7f213ad03740<span class="o">)</span> <span class="o">=</span> <span class="m">0</span>
clone<span class="o">(</span><span class="nv">child_stack</span><span class="o">=</span>NULL, <span class="nv">flags</span><span class="o">=</span>CLONE_CHILD_CLEARTID<span class="p">|</span>CLONE_CHILD_SETTID<span class="p">|</span>SIGCHLD, <span class="nv">child_tidptr</span><span class="o">=</span>0x7f213ad03a10<span class="o">)</span> <span class="o">=</span> <span class="m">2481772</span>
wait4<span class="o">(</span>-1, <span class="o">[{</span>WIFEXITED<span class="o">(</span>s<span class="o">)</span> <span class="o">&amp;&amp;</span> WEXITSTATUS<span class="o">(</span>s<span class="o">)</span> <span class="o">==</span> 0<span class="o">}]</span>, 0, NULL<span class="o">)</span> <span class="o">=</span> <span class="m">2481772</span>
--- SIGCHLD <span class="o">{</span><span class="nv">si_signo</span><span class="o">=</span>SIGCHLD, <span class="nv">si_code</span><span class="o">=</span>CLD_EXITED, <span class="nv">si_pid</span><span class="o">=</span>2481772, <span class="nv">si_uid</span><span class="o">=</span>0, <span class="nv">si_status</span><span class="o">=</span>0, <span class="nv">si_utime</span><span class="o">=</span>0, <span class="nv">si_stime</span><span class="o">=</span>0<span class="o">}</span> ---
wait4<span class="o">(</span>-1, 0x7fff45b86e50, WNOHANG, NULL<span class="o">)</span> <span class="o">=</span> -1 ECHILD <span class="o">(</span>No child processes<span class="o">)</span>
clone<span class="o">(</span><span class="nv">child_stack</span><span class="o">=</span>NULL, <span class="nv">flags</span><span class="o">=</span>CLONE_CHILD_CLEARTID<span class="p">|</span>CLONE_CHILD_SETTID<span class="p">|</span>SIGCHLD, <span class="nv">child_tidptr</span><span class="o">=</span>0x7f213ad03a10<span class="o">)</span> <span class="o">=</span> <span class="m">2481774</span>
--- SIGCHLD <span class="o">{</span><span class="nv">si_signo</span><span class="o">=</span>SIGCHLD, <span class="nv">si_code</span><span class="o">=</span>CLD_EXITED, <span class="nv">si_pid</span><span class="o">=</span>2481774, <span class="nv">si_uid</span><span class="o">=</span>0, <span class="nv">si_status</span><span class="o">=</span>0, <span class="nv">si_utime</span><span class="o">=</span>0, <span class="nv">si_stime</span><span class="o">=</span>0<span class="o">}</span> ---
wait4<span class="o">(</span>-1, <span class="o">[{</span>WIFEXITED<span class="o">(</span>s<span class="o">)</span> <span class="o">&amp;&amp;</span> WEXITSTATUS<span class="o">(</span>s<span class="o">)</span> <span class="o">==</span> 0<span class="o">}]</span>, WNOHANG, NULL<span class="o">)</span> <span class="o">=</span> <span class="m">2481774</span>
wait4<span class="o">(</span>-1, 0x7fff45b862d0, WNOHANG, NULL<span class="o">)</span> <span class="o">=</span> -1 ECHILD <span class="o">(</span>No child processes<span class="o">)</span>
clone<span class="o">(</span><span class="nv">child_stack</span><span class="o">=</span>NULL, <span class="nv">flags</span><span class="o">=</span>CLONE_CHILD_CLEARTID<span class="p">|</span>CLONE_CHILD_SETTID<span class="p">|</span>SIGCHLD, <span class="nv">child_tidptr</span><span class="o">=</span>0x7f213ad03a10<span class="o">)</span> <span class="o">=</span> <span class="m">2481777</span>
--- SIGCHLD <span class="o">{</span><span class="nv">si_signo</span><span class="o">=</span>SIGCHLD, <span class="nv">si_code</span><span class="o">=</span>CLD_EXITED, <span class="nv">si_pid</span><span class="o">=</span>2481777, <span class="nv">si_uid</span><span class="o">=</span>0, <span class="nv">si_status</span><span class="o">=</span>0, <span class="nv">si_utime</span><span class="o">=</span>0, <span class="nv">si_stime</span><span class="o">=</span>0<span class="o">}</span> ---
wait4<span class="o">(</span>-1, <span class="o">[{</span>WIFEXITED<span class="o">(</span>s<span class="o">)</span> <span class="o">&amp;&amp;</span> WEXITSTATUS<span class="o">(</span>s<span class="o">)</span> <span class="o">==</span> 0<span class="o">}]</span>, WNOHANG, NULL<span class="o">)</span> <span class="o">=</span> <span class="m">2481777</span>
wait4<span class="o">(</span>-1, 0x7fff45b866d0, WNOHANG, NULL<span class="o">)</span> <span class="o">=</span> -1 ECHILD <span class="o">(</span>No child processes<span class="o">)</span>
clone<span class="o">(</span><span class="nv">child_stack</span><span class="o">=</span>NULL, <span class="nv">flags</span><span class="o">=</span>CLONE_CHILD_CLEARTID<span class="p">|</span>CLONE_CHILD_SETTID<span class="p">|</span>SIGCHLD, <span class="nv">child_tidptr</span><span class="o">=</span>0x7f213ad03a10<span class="o">)</span> <span class="o">=</span> <span class="m">2481779</span>
wait4<span class="o">(</span>-1, <span class="o">[{</span>WIFEXITED<span class="o">(</span>s<span class="o">)</span> <span class="o">&amp;&amp;</span> WEXITSTATUS<span class="o">(</span>s<span class="o">)</span> <span class="o">==</span> 1<span class="o">}]</span>, 0, NULL<span class="o">)</span> <span class="o">=</span> <span class="m">2481779</span>
--- SIGCHLD <span class="o">{</span><span class="nv">si_signo</span><span class="o">=</span>SIGCHLD, <span class="nv">si_code</span><span class="o">=</span>CLD_EXITED, <span class="nv">si_pid</span><span class="o">=</span>2481779, <span class="nv">si_uid</span><span class="o">=</span>0, <span class="nv">si_status</span><span class="o">=</span>1, <span class="nv">si_utime</span><span class="o">=</span>0, <span class="nv">si_stime</span><span class="o">=</span>0<span class="o">}</span> ---
wait4<span class="o">(</span>-1, 0x7fff45b86c50, WNOHANG, NULL<span class="o">)</span> <span class="o">=</span> -1 ECHILD <span class="o">(</span>No child processes<span class="o">)</span>
clone<span class="o">(</span><span class="nv">child_stack</span><span class="o">=</span>NULL, <span class="nv">flags</span><span class="o">=</span>CLONE_CHILD_CLEARTID<span class="p">|</span>CLONE_CHILD_SETTID<span class="p">|</span>SIGCHLD, <span class="nv">child_tidptr</span><span class="o">=</span>0x7f213ad03a10<span class="o">)</span> <span class="o">=</span> <span class="m">2481780</span>
wait4<span class="o">(</span>-1, <span class="o">[{</span>WIFEXITED<span class="o">(</span>s<span class="o">)</span> <span class="o">&amp;&amp;</span> WEXITSTATUS<span class="o">(</span>s<span class="o">)</span> <span class="o">==</span> 0<span class="o">}]</span>, 0, NULL<span class="o">)</span> <span class="o">=</span> <span class="m">2481780</span>
--- SIGCHLD <span class="o">{</span><span class="nv">si_signo</span><span class="o">=</span>SIGCHLD, <span class="nv">si_code</span><span class="o">=</span>CLD_EXITED, <span class="nv">si_pid</span><span class="o">=</span>2481780, <span class="nv">si_uid</span><span class="o">=</span>0, <span class="nv">si_status</span><span class="o">=</span>0, <span class="nv">si_utime</span><span class="o">=</span>0, <span class="nv">si_stime</span><span class="o">=</span>0<span class="o">}</span> ---
wait4<span class="o">(</span>-1, 0x7fff45b86e50, WNOHANG, NULL<span class="o">)</span> <span class="o">=</span> -1 ECHILD <span class="o">(</span>No child processes<span class="o">)</span>
clone<span class="o">(</span><span class="nv">child_stack</span><span class="o">=</span>NULL, <span class="nv">flags</span><span class="o">=</span>CLONE_CHILD_CLEARTID<span class="p">|</span>CLONE_CHILD_SETTID<span class="p">|</span>SIGCHLD, <span class="nv">child_tidptr</span><span class="o">=</span>0x7f213ad03a10<span class="o">)</span> <span class="o">=</span> <span class="m">2481782</span>
wait4<span class="o">(</span>-1, <span class="o">[{</span>WIFEXITED<span class="o">(</span>s<span class="o">)</span> <span class="o">&amp;&amp;</span> WEXITSTATUS<span class="o">(</span>s<span class="o">)</span> <span class="o">==</span> 0<span class="o">}]</span>, 0, NULL<span class="o">)</span> <span class="o">=</span> <span class="m">2481782</span>
--- SIGCHLD <span class="o">{</span><span class="nv">si_signo</span><span class="o">=</span>SIGCHLD, <span class="nv">si_code</span><span class="o">=</span>CLD_EXITED, <span class="nv">si_pid</span><span class="o">=</span>2481782, <span class="nv">si_uid</span><span class="o">=</span>0, <span class="nv">si_status</span><span class="o">=</span>0, <span class="nv">si_utime</span><span class="o">=</span>0, <span class="nv">si_stime</span><span class="o">=</span>0<span class="o">}</span> ---
wait4<span class="o">(</span>-1, 0x7fff45b86e50, WNOHANG, NULL<span class="o">)</span> <span class="o">=</span> -1 ECHILD <span class="o">(</span>No child processes<span class="o">)</span>
clone<span class="o">(</span><span class="nv">child_stack</span><span class="o">=</span>NULL, <span class="nv">flags</span><span class="o">=</span>CLONE_CHILD_CLEARTID<span class="p">|</span>CLONE_CHILD_SETTID<span class="p">|</span>SIGCHLD, <span class="nv">child_tidptr</span><span class="o">=</span>0x7f213ad03a10<span class="o">)</span> <span class="o">=</span> <span class="m">2481784</span>
--- SIGCHLD <span class="o">{</span><span class="nv">si_signo</span><span class="o">=</span>SIGCHLD, <span class="nv">si_code</span><span class="o">=</span>CLD_EXITED, <span class="nv">si_pid</span><span class="o">=</span>2481784, <span class="nv">si_uid</span><span class="o">=</span>0, <span class="nv">si_status</span><span class="o">=</span>0, <span class="nv">si_utime</span><span class="o">=</span>0, <span class="nv">si_stime</span><span class="o">=</span>0<span class="o">}</span> ---
wait4<span class="o">(</span>-1, <span class="o">[{</span>WIFEXITED<span class="o">(</span>s<span class="o">)</span> <span class="o">&amp;&amp;</span> WEXITSTATUS<span class="o">(</span>s<span class="o">)</span> <span class="o">==</span> 0<span class="o">}]</span>, WNOHANG, NULL<span class="o">)</span> <span class="o">=</span> <span class="m">2481784</span>
wait4<span class="o">(</span>-1, 0x7fff45b869d0, WNOHANG, NULL<span class="o">)</span> <span class="o">=</span> -1 ECHILD <span class="o">(</span>No child processes<span class="o">)</span>
clone<span class="o">(</span><span class="nv">child_stack</span><span class="o">=</span>NULL, <span class="nv">flags</span><span class="o">=</span>CLONE_CHILD_CLEARTID<span class="p">|</span>CLONE_CHILD_SETTID<span class="p">|</span>SIGCHLD, <span class="nv">child_tidptr</span><span class="o">=</span>0x7f213ad03a10<span class="o">)</span> <span class="o">=</span> <span class="m">2481786</span>
--- SIGCHLD <span class="o">{</span><span class="nv">si_signo</span><span class="o">=</span>SIGCHLD, <span class="nv">si_code</span><span class="o">=</span>CLD_EXITED, <span class="nv">si_pid</span><span class="o">=</span>2481786, <span class="nv">si_uid</span><span class="o">=</span>0, <span class="nv">si_status</span><span class="o">=</span>0, <span class="nv">si_utime</span><span class="o">=</span>0, <span class="nv">si_stime</span><span class="o">=</span>0<span class="o">}</span> ---
wait4<span class="o">(</span>-1, <span class="o">[{</span>WIFEXITED<span class="o">(</span>s<span class="o">)</span> <span class="o">&amp;&amp;</span> WEXITSTATUS<span class="o">(</span>s<span class="o">)</span> <span class="o">==</span> 0<span class="o">}]</span>, WNOHANG, NULL<span class="o">)</span> <span class="o">=</span> <span class="m">2481786</span>
wait4<span class="o">(</span>-1, 0x7fff45b868d0, WNOHANG, NULL<span class="o">)</span> <span class="o">=</span> -1 ECHILD <span class="o">(</span>No child processes<span class="o">)</span>
</code></pre></td></tr></table>
</div>
</div><p>若是想要跟踪进程管理相关的系统调用，那么<code>-e trace=%process</code>选项能满足这个需求。具体指代的系统调用主要是创建进程（fork 系列）、执行新程序（exec 系列）、回收子进程（wait 系列）相关的一些列系统调用。</p>
<h3 id="8跟踪所有网络相关的系统调用">8、跟踪所有网络相关的系统调用</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="c1"># strace -e trace=%network ping -c 1 github.com</span>
socket<span class="o">(</span>AF_INET, SOCK_DGRAM, IPPROTO_ICMP<span class="o">)</span> <span class="o">=</span> -1 EACCES <span class="o">(</span>Permission denied<span class="o">)</span>
socket<span class="o">(</span>AF_INET, SOCK_RAW, IPPROTO_ICMP<span class="o">)</span> <span class="o">=</span> <span class="m">3</span>
socket<span class="o">(</span>AF_INET6, SOCK_DGRAM, IPPROTO_ICMPV6<span class="o">)</span> <span class="o">=</span> -1 EACCES <span class="o">(</span>Permission denied<span class="o">)</span>
socket<span class="o">(</span>AF_INET6, SOCK_RAW, IPPROTO_ICMPV6<span class="o">)</span> <span class="o">=</span> <span class="m">4</span>
socket<span class="o">(</span>AF_UNIX, SOCK_STREAM<span class="p">|</span>SOCK_CLOEXEC<span class="p">|</span>SOCK_NONBLOCK, 0<span class="o">)</span> <span class="o">=</span> <span class="m">5</span>
connect<span class="o">(</span>5, <span class="o">{</span><span class="nv">sa_family</span><span class="o">=</span>AF_UNIX, <span class="nv">sun_path</span><span class="o">=</span><span class="s2">&#34;/var/run/nscd/socket&#34;</span><span class="o">}</span>, 110<span class="o">)</span> <span class="o">=</span> -1 ENOENT <span class="o">(</span>No such file or directory<span class="o">)</span>
socket<span class="o">(</span>AF_UNIX, SOCK_STREAM<span class="p">|</span>SOCK_CLOEXEC<span class="p">|</span>SOCK_NONBLOCK, 0<span class="o">)</span> <span class="o">=</span> <span class="m">5</span>
connect<span class="o">(</span>5, <span class="o">{</span><span class="nv">sa_family</span><span class="o">=</span>AF_UNIX, <span class="nv">sun_path</span><span class="o">=</span><span class="s2">&#34;/var/run/nscd/socket&#34;</span><span class="o">}</span>, 110<span class="o">)</span> <span class="o">=</span> -1 ENOENT <span class="o">(</span>No such file or directory<span class="o">)</span>
socket<span class="o">(</span>AF_INET, SOCK_DGRAM<span class="p">|</span>SOCK_CLOEXEC<span class="p">|</span>SOCK_NONBLOCK, IPPROTO_IP<span class="o">)</span> <span class="o">=</span> <span class="m">5</span>
setsockopt<span class="o">(</span>5, SOL_IP, IP_RECVERR, <span class="o">[</span>1<span class="o">]</span>, 4<span class="o">)</span> <span class="o">=</span> <span class="m">0</span>
connect<span class="o">(</span>5, <span class="o">{</span><span class="nv">sa_family</span><span class="o">=</span>AF_INET, <span class="nv">sin_port</span><span class="o">=</span>htons<span class="o">(</span>53<span class="o">)</span>, <span class="nv">sin_addr</span><span class="o">=</span>inet_addr<span class="o">(</span><span class="s2">&#34;10.23.255.1&#34;</span><span class="o">)}</span>, 16<span class="o">)</span> <span class="o">=</span> <span class="m">0</span>
sendmmsg<span class="o">(</span>5, <span class="o">[{</span><span class="nv">msg_hdr</span><span class="o">={</span><span class="nv">msg_name</span><span class="o">=</span>NULL, <span class="nv">msg_namelen</span><span class="o">=</span>0, <span class="nv">msg_iov</span><span class="o">=[{</span><span class="nv">iov_base</span><span class="o">=</span><span class="s2">&#34;nl\1\0\0\1\0\0\0\0\0\0\6github\3com\0\0\1\0\1&#34;</span>, <span class="nv">iov_len</span><span class="o">=</span>28<span class="o">}]</span>, <span class="nv">msg_iovlen</span><span class="o">=</span>1, <span class="nv">msg_controllen</span><span class="o">=</span>0, <span class="nv">msg_flags</span><span class="o">=</span>0<span class="o">}</span>, <span class="nv">msg_len</span><span class="o">=</span>28<span class="o">}</span>, <span class="o">{</span><span class="nv">msg_hdr</span><span class="o">={</span><span class="nv">msg_name</span><span class="o">=</span>NULL, <span class="nv">msg_namelen</span><span class="o">=</span>0, <span class="nv">msg_iov</span><span class="o">=[{</span><span class="nv">iov_base</span><span class="o">=</span><span class="s2">&#34;\364q\1\0\0\1\0\0\0\0\0\0\6github\3com\0\0\34\0\1&#34;</span>, <span class="nv">iov_len</span><span class="o">=</span>28<span class="o">}]</span>, <span class="nv">msg_iovlen</span><span class="o">=</span>1, <span class="nv">msg_controllen</span><span class="o">=</span>0, <span class="nv">msg_flags</span><span class="o">=</span>0<span class="o">}</span>, <span class="nv">msg_len</span><span class="o">=</span>28<span class="o">}]</span>, 2, MSG_NOSIGNAL<span class="o">)</span> <span class="o">=</span> <span class="m">2</span>
recvfrom<span class="o">(</span>5, <span class="s2">&#34;nl\201\0\0\1\0\1\0\0\0\0\6github\3com\0\0\1\0\1\300\f\0\1&#34;</span>..., 2048, 0, <span class="o">{</span><span class="nv">sa_family</span><span class="o">=</span>AF_INET, <span class="nv">sin_port</span><span class="o">=</span>htons<span class="o">(</span>53<span class="o">)</span>, <span class="nv">sin_addr</span><span class="o">=</span>inet_addr<span class="o">(</span><span class="s2">&#34;10.23.255.1&#34;</span><span class="o">)}</span>, <span class="o">[</span>28-&gt;16<span class="o">])</span> <span class="o">=</span> <span class="m">44</span>
recvfrom<span class="o">(</span>5, <span class="s2">&#34;\364q\201\200\0\1\0\0\0\1\0\0\6github\3com\0\0\34\0\1\300\f\0\6&#34;</span>..., 65536, 0, <span class="o">{</span><span class="nv">sa_family</span><span class="o">=</span>AF_INET, <span class="nv">sin_port</span><span class="o">=</span>htons<span class="o">(</span>53<span class="o">)</span>, <span class="nv">sin_addr</span><span class="o">=</span>inet_addr<span class="o">(</span><span class="s2">&#34;10.23.255.1&#34;</span><span class="o">)}</span>, <span class="o">[</span>28-&gt;16<span class="o">])</span> <span class="o">=</span> <span class="m">93</span>
socket<span class="o">(</span>AF_INET, SOCK_DGRAM, IPPROTO_IP<span class="o">)</span> <span class="o">=</span> <span class="m">5</span>
connect<span class="o">(</span>5, <span class="o">{</span><span class="nv">sa_family</span><span class="o">=</span>AF_INET, <span class="nv">sin_port</span><span class="o">=</span>htons<span class="o">(</span>1025<span class="o">)</span>, <span class="nv">sin_addr</span><span class="o">=</span>inet_addr<span class="o">(</span><span class="s2">&#34;10.23.253.91&#34;</span><span class="o">)}</span>, 16<span class="o">)</span> <span class="o">=</span> <span class="m">0</span>
getsockname<span class="o">(</span>5, <span class="o">{</span><span class="nv">sa_family</span><span class="o">=</span>AF_INET, <span class="nv">sin_port</span><span class="o">=</span>htons<span class="o">(</span>57426<span class="o">)</span>, <span class="nv">sin_addr</span><span class="o">=</span>inet_addr<span class="o">(</span><span class="s2">&#34;10.23.182.41&#34;</span><span class="o">)}</span>, <span class="o">[</span>16<span class="o">])</span> <span class="o">=</span> <span class="m">0</span>
setsockopt<span class="o">(</span>3, SOL_RAW, ICMP_FILTER, ~<span class="o">(</span>1<span class="s">&lt;&lt;ICMP_ECHOREPLY|1&lt;&lt;ICMP_</span>DEST_UNREACH<span class="p">|</span>1<span class="s">&lt;&lt;ICMP_SOURCE_QUENCH|1&lt;&lt;ICMP_</span>REDIRECT<span class="p">|</span>1<span class="s">&lt;&lt;ICMP_TIME_EXCEEDED|1&lt;&lt;ICMP_</span>PARAMETERPROB<span class="o">)</span>, 4<span class="o">)</span> <span class="o">=</span> <span class="m">0</span>
setsockopt<span class="o">(</span>3, SOL_IP, IP_RECVERR, <span class="o">[</span>1<span class="o">]</span>, 4<span class="o">)</span> <span class="o">=</span> <span class="m">0</span>
setsockopt<span class="o">(</span>3, SOL_SOCKET, SO_SNDBUF, <span class="o">[</span>324<span class="o">]</span>, 4<span class="o">)</span> <span class="o">=</span> <span class="m">0</span>
setsockopt<span class="o">(</span>3, SOL_SOCKET, SO_RCVBUF, <span class="o">[</span>65536<span class="o">]</span>, 4<span class="o">)</span> <span class="o">=</span> <span class="m">0</span>
getsockopt<span class="o">(</span>3, SOL_SOCKET, SO_RCVBUF, <span class="o">[</span>131072<span class="o">]</span>, <span class="o">[</span>4<span class="o">])</span> <span class="o">=</span> <span class="m">0</span>
PING github.com <span class="o">(</span>10.23.253.91<span class="o">)</span> 56<span class="o">(</span>84<span class="o">)</span> bytes of data.
setsockopt<span class="o">(</span>3, SOL_SOCKET, SO_TIMESTAMP_OLD, <span class="o">[</span>1<span class="o">]</span>, 4<span class="o">)</span> <span class="o">=</span> <span class="m">0</span>
setsockopt<span class="o">(</span>3, SOL_SOCKET, SO_SNDTIMEO_OLD, <span class="s2">&#34;\1\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0&#34;</span>, 16<span class="o">)</span> <span class="o">=</span> <span class="m">0</span>
setsockopt<span class="o">(</span>3, SOL_SOCKET, SO_RCVTIMEO_OLD, <span class="s2">&#34;\1\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0&#34;</span>, 16<span class="o">)</span> <span class="o">=</span> <span class="m">0</span>
sendto<span class="o">(</span>3, <span class="s2">&#34;\10\0\2sy\6\0\1)\225ka\0\0\0\0&amp;\274\2\0\0\0\0\0\20\21\22\23\24\25\26\27&#34;</span>..., 64, 0, <span class="o">{</span><span class="nv">sa_family</span><span class="o">=</span>AF_INET, <span class="nv">sin_port</span><span class="o">=</span>htons<span class="o">(</span>0<span class="o">)</span>, <span class="nv">sin_addr</span><span class="o">=</span>inet_addr<span class="o">(</span><span class="s2">&#34;10.23.253.91&#34;</span><span class="o">)}</span>, 16<span class="o">)</span> <span class="o">=</span> <span class="m">64</span>
socket<span class="o">(</span>AF_INET, SOCK_DGRAM<span class="p">|</span>SOCK_CLOEXEC<span class="p">|</span>SOCK_NONBLOCK, IPPROTO_IP<span class="o">)</span> <span class="o">=</span> <span class="m">5</span>
setsockopt<span class="o">(</span>5, SOL_IP, IP_RECVERR, <span class="o">[</span>1<span class="o">]</span>, 4<span class="o">)</span> <span class="o">=</span> <span class="m">0</span>
connect<span class="o">(</span>5, <span class="o">{</span><span class="nv">sa_family</span><span class="o">=</span>AF_INET, <span class="nv">sin_port</span><span class="o">=</span>htons<span class="o">(</span>53<span class="o">)</span>, <span class="nv">sin_addr</span><span class="o">=</span>inet_addr<span class="o">(</span><span class="s2">&#34;10.23.255.1&#34;</span><span class="o">)}</span>, 16<span class="o">)</span> <span class="o">=</span> <span class="m">0</span>
sendto<span class="o">(</span>5, <span class="s2">&#34;\376j\1\0\0\1\0\0\0\0\0\0\291\003253\00223\00210\7in-add&#34;</span>..., 43, MSG_NOSIGNAL, NULL, 0<span class="o">)</span> <span class="o">=</span> <span class="m">43</span>
recvfrom<span class="o">(</span>5, <span class="s2">&#34;\376j\201\203\0\1\0\0\0\1\0\0\291\003253\00223\00210\7in-add&#34;</span>..., 1024, 0, <span class="o">{</span><span class="nv">sa_family</span><span class="o">=</span>AF_INET, <span class="nv">sin_port</span><span class="o">=</span>htons<span class="o">(</span>53<span class="o">)</span>, <span class="nv">sin_addr</span><span class="o">=</span>inet_addr<span class="o">(</span><span class="s2">&#34;10.23.255.1&#34;</span><span class="o">)}</span>, <span class="o">[</span>28-&gt;16<span class="o">])</span> <span class="o">=</span> <span class="m">120</span>
socket<span class="o">(</span>AF_NETLINK, SOCK_RAW<span class="p">|</span>SOCK_CLOEXEC<span class="p">|</span>SOCK_NONBLOCK, NETLINK_ROUTE<span class="o">)</span> <span class="o">=</span> <span class="m">5</span>
getsockopt<span class="o">(</span>5, SOL_SOCKET, SO_PROTOCOL, <span class="o">[</span>0<span class="o">]</span>, <span class="o">[</span>4<span class="o">])</span> <span class="o">=</span> <span class="m">0</span>
setsockopt<span class="o">(</span>5, SOL_NETLINK, NETLINK_PKTINFO, <span class="o">[</span>1<span class="o">]</span>, 4<span class="o">)</span> <span class="o">=</span> <span class="m">0</span>
bind<span class="o">(</span>5, <span class="o">{</span><span class="nv">sa_family</span><span class="o">=</span>AF_NETLINK, <span class="nv">nl_pid</span><span class="o">=</span>0, <span class="nv">nl_groups</span><span class="o">=</span>00000000<span class="o">}</span>, 16<span class="o">)</span> <span class="o">=</span> <span class="m">0</span>
getsockname<span class="o">(</span>5, <span class="o">{</span><span class="nv">sa_family</span><span class="o">=</span>AF_NETLINK, <span class="nv">nl_pid</span><span class="o">=</span>2586886, <span class="nv">nl_groups</span><span class="o">=</span>00000000<span class="o">}</span>, <span class="o">[</span>16-&gt;12<span class="o">])</span> <span class="o">=</span> <span class="m">0</span>
getsockopt<span class="o">(</span>5, SOL_NETLINK, NETLINK_LIST_MEMBERSHIPS, NULL, <span class="o">[</span>0<span class="o">])</span> <span class="o">=</span> <span class="m">0</span>
socket<span class="o">(</span>AF_NETLINK, SOCK_RAW<span class="p">|</span>SOCK_CLOEXEC<span class="p">|</span>SOCK_NONBLOCK, NETLINK_ROUTE<span class="o">)</span> <span class="o">=</span> <span class="m">5</span>
getsockopt<span class="o">(</span>5, SOL_SOCKET, SO_PROTOCOL, <span class="o">[</span>0<span class="o">]</span>, <span class="o">[</span>4<span class="o">])</span> <span class="o">=</span> <span class="m">0</span>
setsockopt<span class="o">(</span>5, SOL_NETLINK, NETLINK_PKTINFO, <span class="o">[</span>1<span class="o">]</span>, 4<span class="o">)</span> <span class="o">=</span> <span class="m">0</span>
bind<span class="o">(</span>5, <span class="o">{</span><span class="nv">sa_family</span><span class="o">=</span>AF_NETLINK, <span class="nv">nl_pid</span><span class="o">=</span>0, <span class="nv">nl_groups</span><span class="o">=</span>00000000<span class="o">}</span>, 16<span class="o">)</span> <span class="o">=</span> <span class="m">0</span>
getsockname<span class="o">(</span>5, <span class="o">{</span><span class="nv">sa_family</span><span class="o">=</span>AF_NETLINK, <span class="nv">nl_pid</span><span class="o">=</span>2586886, <span class="nv">nl_groups</span><span class="o">=</span>00000000<span class="o">}</span>, <span class="o">[</span>16-&gt;12<span class="o">])</span> <span class="o">=</span> <span class="m">0</span>
getsockopt<span class="o">(</span>5, SOL_NETLINK, NETLINK_LIST_MEMBERSHIPS, NULL, <span class="o">[</span>0<span class="o">])</span> <span class="o">=</span> <span class="m">0</span>
<span class="m">64</span> bytes from 10.23.253.91 <span class="o">(</span>10.23.253.91<span class="o">)</span>: <span class="nv">icmp_seq</span><span class="o">=</span><span class="m">1</span> <span class="nv">ttl</span><span class="o">=</span><span class="m">63</span> <span class="nv">time</span><span class="o">=</span>0.757 ms

--- github.com ping statistics ---
<span class="m">1</span> packets transmitted, <span class="m">1</span> received, 0% packet loss, <span class="nb">time</span> 0ms
rtt min/avg/max/mdev <span class="o">=</span> 0.757/0.757/0.757/0.000 ms
+++ exited with <span class="m">0</span> +++
</code></pre></td></tr></table>
</div>
</div><p><code>-e trace=%network</code>或者<code>-e trace=%net</code>是跟踪网络相关系统调用的选项。实际输出的内容远比这个多，这是做了适当省略后的输出。</p>
<h3 id="9跟踪所有信号相关的系统调用">9、跟踪所有信号相关的系统调用</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="c1"># strace -e trace=%signal sh -c echo voidint</span>
rt_sigprocmask<span class="o">(</span>SIG_BLOCK, NULL, <span class="o">[]</span>, 8<span class="o">)</span>  <span class="o">=</span> <span class="m">0</span>
rt_sigaction<span class="o">(</span>SIGCHLD, <span class="o">{</span><span class="nv">sa_handler</span><span class="o">=</span>SIG_DFL, <span class="nv">sa_mask</span><span class="o">=[]</span>, <span class="nv">sa_flags</span><span class="o">=</span>SA_RESTORER<span class="p">|</span>SA_RESTART, <span class="nv">sa_restorer</span><span class="o">=</span>0x7f3ca8e8e880<span class="o">}</span>, <span class="o">{</span><span class="nv">sa_handler</span><span class="o">=</span>SIG_DFL, <span class="nv">sa_mask</span><span class="o">=[]</span>, <span class="nv">sa_flags</span><span class="o">=</span>0<span class="o">}</span>, 8<span class="o">)</span> <span class="o">=</span> <span class="m">0</span>
rt_sigaction<span class="o">(</span>SIGCHLD, <span class="o">{</span><span class="nv">sa_handler</span><span class="o">=</span>SIG_DFL, <span class="nv">sa_mask</span><span class="o">=[]</span>, <span class="nv">sa_flags</span><span class="o">=</span>SA_RESTORER<span class="p">|</span>SA_RESTART, <span class="nv">sa_restorer</span><span class="o">=</span>0x7f3ca8e8e880<span class="o">}</span>, <span class="o">{</span><span class="nv">sa_handler</span><span class="o">=</span>SIG_DFL, <span class="nv">sa_mask</span><span class="o">=[]</span>, <span class="nv">sa_flags</span><span class="o">=</span>SA_RESTORER<span class="p">|</span>SA_RESTART, <span class="nv">sa_restorer</span><span class="o">=</span>0x7f3ca8e8e880<span class="o">}</span>, 8<span class="o">)</span> <span class="o">=</span> <span class="m">0</span>
rt_sigaction<span class="o">(</span>SIGINT, <span class="o">{</span><span class="nv">sa_handler</span><span class="o">=</span>SIG_DFL, <span class="nv">sa_mask</span><span class="o">=[]</span>, <span class="nv">sa_flags</span><span class="o">=</span>SA_RESTORER, <span class="nv">sa_restorer</span><span class="o">=</span>0x7f3ca8e8e880<span class="o">}</span>, <span class="o">{</span><span class="nv">sa_handler</span><span class="o">=</span>SIG_DFL, <span class="nv">sa_mask</span><span class="o">=[]</span>, <span class="nv">sa_flags</span><span class="o">=</span>0<span class="o">}</span>, 8<span class="o">)</span> <span class="o">=</span> <span class="m">0</span>
rt_sigaction<span class="o">(</span>SIGINT, <span class="o">{</span><span class="nv">sa_handler</span><span class="o">=</span>SIG_DFL, <span class="nv">sa_mask</span><span class="o">=[]</span>, <span class="nv">sa_flags</span><span class="o">=</span>SA_RESTORER, <span class="nv">sa_restorer</span><span class="o">=</span>0x7f3ca8e8e880<span class="o">}</span>, <span class="o">{</span><span class="nv">sa_handler</span><span class="o">=</span>SIG_DFL, <span class="nv">sa_mask</span><span class="o">=[]</span>, <span class="nv">sa_flags</span><span class="o">=</span>SA_RESTORER, <span class="nv">sa_restorer</span><span class="o">=</span>0x7f3ca8e8e880<span class="o">}</span>, 8<span class="o">)</span> <span class="o">=</span> <span class="m">0</span>
rt_sigaction<span class="o">(</span>SIGQUIT, <span class="o">{</span><span class="nv">sa_handler</span><span class="o">=</span>SIG_DFL, <span class="nv">sa_mask</span><span class="o">=[]</span>, <span class="nv">sa_flags</span><span class="o">=</span>SA_RESTORER, <span class="nv">sa_restorer</span><span class="o">=</span>0x7f3ca8e8e880<span class="o">}</span>, <span class="o">{</span><span class="nv">sa_handler</span><span class="o">=</span>SIG_DFL, <span class="nv">sa_mask</span><span class="o">=[]</span>, <span class="nv">sa_flags</span><span class="o">=</span>0<span class="o">}</span>, 8<span class="o">)</span> <span class="o">=</span> <span class="m">0</span>
rt_sigaction<span class="o">(</span>SIGQUIT, <span class="o">{</span><span class="nv">sa_handler</span><span class="o">=</span>SIG_DFL, <span class="nv">sa_mask</span><span class="o">=[]</span>, <span class="nv">sa_flags</span><span class="o">=</span>SA_RESTORER, <span class="nv">sa_restorer</span><span class="o">=</span>0x7f3ca8e8e880<span class="o">}</span>, <span class="o">{</span><span class="nv">sa_handler</span><span class="o">=</span>SIG_DFL, <span class="nv">sa_mask</span><span class="o">=[]</span>, <span class="nv">sa_flags</span><span class="o">=</span>SA_RESTORER, <span class="nv">sa_restorer</span><span class="o">=</span>0x7f3ca8e8e880<span class="o">}</span>, 8<span class="o">)</span> <span class="o">=</span> <span class="m">0</span>
rt_sigaction<span class="o">(</span>SIGTSTP, <span class="o">{</span><span class="nv">sa_handler</span><span class="o">=</span>SIG_DFL, <span class="nv">sa_mask</span><span class="o">=[]</span>, <span class="nv">sa_flags</span><span class="o">=</span>SA_RESTORER, <span class="nv">sa_restorer</span><span class="o">=</span>0x7f3ca8e8e880<span class="o">}</span>, <span class="o">{</span><span class="nv">sa_handler</span><span class="o">=</span>SIG_DFL, <span class="nv">sa_mask</span><span class="o">=[]</span>, <span class="nv">sa_flags</span><span class="o">=</span>0<span class="o">}</span>, 8<span class="o">)</span> <span class="o">=</span> <span class="m">0</span>
rt_sigaction<span class="o">(</span>SIGTSTP, <span class="o">{</span><span class="nv">sa_handler</span><span class="o">=</span>SIG_DFL, <span class="nv">sa_mask</span><span class="o">=[]</span>, <span class="nv">sa_flags</span><span class="o">=</span>SA_RESTORER, <span class="nv">sa_restorer</span><span class="o">=</span>0x7f3ca8e8e880<span class="o">}</span>, <span class="o">{</span><span class="nv">sa_handler</span><span class="o">=</span>SIG_DFL, <span class="nv">sa_mask</span><span class="o">=[]</span>, <span class="nv">sa_flags</span><span class="o">=</span>SA_RESTORER, <span class="nv">sa_restorer</span><span class="o">=</span>0x7f3ca8e8e880<span class="o">}</span>, 8<span class="o">)</span> <span class="o">=</span> <span class="m">0</span>
rt_sigaction<span class="o">(</span>SIGTTIN, <span class="o">{</span><span class="nv">sa_handler</span><span class="o">=</span>SIG_DFL, <span class="nv">sa_mask</span><span class="o">=[]</span>, <span class="nv">sa_flags</span><span class="o">=</span>SA_RESTORER, <span class="nv">sa_restorer</span><span class="o">=</span>0x7f3ca8e8e880<span class="o">}</span>, <span class="o">{</span><span class="nv">sa_handler</span><span class="o">=</span>SIG_DFL, <span class="nv">sa_mask</span><span class="o">=[]</span>, <span class="nv">sa_flags</span><span class="o">=</span>0<span class="o">}</span>, 8<span class="o">)</span> <span class="o">=</span> <span class="m">0</span>
rt_sigaction<span class="o">(</span>SIGTTIN, <span class="o">{</span><span class="nv">sa_handler</span><span class="o">=</span>SIG_DFL, <span class="nv">sa_mask</span><span class="o">=[]</span>, <span class="nv">sa_flags</span><span class="o">=</span>SA_RESTORER, <span class="nv">sa_restorer</span><span class="o">=</span>0x7f3ca8e8e880<span class="o">}</span>, <span class="o">{</span><span class="nv">sa_handler</span><span class="o">=</span>SIG_DFL, <span class="nv">sa_mask</span><span class="o">=[]</span>, <span class="nv">sa_flags</span><span class="o">=</span>SA_RESTORER, <span class="nv">sa_restorer</span><span class="o">=</span>0x7f3ca8e8e880<span class="o">}</span>, 8<span class="o">)</span> <span class="o">=</span> <span class="m">0</span>
rt_sigaction<span class="o">(</span>SIGTTOU, <span class="o">{</span><span class="nv">sa_handler</span><span class="o">=</span>SIG_DFL, <span class="nv">sa_mask</span><span class="o">=[]</span>, <span class="nv">sa_flags</span><span class="o">=</span>SA_RESTORER, <span class="nv">sa_restorer</span><span class="o">=</span>0x7f3ca8e8e880<span class="o">}</span>, <span class="o">{</span><span class="nv">sa_handler</span><span class="o">=</span>SIG_DFL, <span class="nv">sa_mask</span><span class="o">=[]</span>, <span class="nv">sa_flags</span><span class="o">=</span>0<span class="o">}</span>, 8<span class="o">)</span> <span class="o">=</span> <span class="m">0</span>
rt_sigaction<span class="o">(</span>SIGTTOU, <span class="o">{</span><span class="nv">sa_handler</span><span class="o">=</span>SIG_DFL, <span class="nv">sa_mask</span><span class="o">=[]</span>, <span class="nv">sa_flags</span><span class="o">=</span>SA_RESTORER, <span class="nv">sa_restorer</span><span class="o">=</span>0x7f3ca8e8e880<span class="o">}</span>, <span class="o">{</span><span class="nv">sa_handler</span><span class="o">=</span>SIG_DFL, <span class="nv">sa_mask</span><span class="o">=[]</span>, <span class="nv">sa_flags</span><span class="o">=</span>SA_RESTORER, <span class="nv">sa_restorer</span><span class="o">=</span>0x7f3ca8e8e880<span class="o">}</span>, 8<span class="o">)</span> <span class="o">=</span> <span class="m">0</span>
rt_sigprocmask<span class="o">(</span>SIG_BLOCK, NULL, <span class="o">[]</span>, 8<span class="o">)</span>  <span class="o">=</span> <span class="m">0</span>
rt_sigaction<span class="o">(</span>SIGQUIT, <span class="o">{</span><span class="nv">sa_handler</span><span class="o">=</span>SIG_IGN, <span class="nv">sa_mask</span><span class="o">=[]</span>, <span class="nv">sa_flags</span><span class="o">=</span>SA_RESTORER, <span class="nv">sa_restorer</span><span class="o">=</span>0x7f3ca8e8e880<span class="o">}</span>, <span class="o">{</span><span class="nv">sa_handler</span><span class="o">=</span>SIG_DFL, <span class="nv">sa_mask</span><span class="o">=[]</span>, <span class="nv">sa_flags</span><span class="o">=</span>SA_RESTORER, <span class="nv">sa_restorer</span><span class="o">=</span>0x7f3ca8e8e880<span class="o">}</span>, 8<span class="o">)</span> <span class="o">=</span> <span class="m">0</span>
rt_sigaction<span class="o">(</span>SIGCHLD, <span class="o">{</span><span class="nv">sa_handler</span><span class="o">=</span>0x555e8a87b1b0, <span class="nv">sa_mask</span><span class="o">=[]</span>, <span class="nv">sa_flags</span><span class="o">=</span>SA_RESTORER<span class="p">|</span>SA_RESTART, <span class="nv">sa_restorer</span><span class="o">=</span>0x7f3ca8e8e880<span class="o">}</span>, <span class="o">{</span><span class="nv">sa_handler</span><span class="o">=</span>SIG_DFL, <span class="nv">sa_mask</span><span class="o">=[]</span>, <span class="nv">sa_flags</span><span class="o">=</span>SA_RESTORER<span class="p">|</span>SA_RESTART, <span class="nv">sa_restorer</span><span class="o">=</span>0x7f3ca8e8e880<span class="o">}</span>, 8<span class="o">)</span> <span class="o">=</span> <span class="m">0</span>
rt_sigprocmask<span class="o">(</span>SIG_BLOCK, NULL, <span class="o">[]</span>, 8<span class="o">)</span>  <span class="o">=</span> <span class="m">0</span>
rt_sigprocmask<span class="o">(</span>SIG_BLOCK, NULL, <span class="o">[]</span>, 8<span class="o">)</span>  <span class="o">=</span> <span class="m">0</span>

rt_sigprocmask<span class="o">(</span>SIG_BLOCK, <span class="o">[</span>CHLD<span class="o">]</span>, <span class="o">[]</span>, 8<span class="o">)</span> <span class="o">=</span> <span class="m">0</span>
rt_sigprocmask<span class="o">(</span>SIG_SETMASK, <span class="o">[]</span>, NULL, 8<span class="o">)</span> <span class="o">=</span> <span class="m">0</span>
+++ exited with <span class="m">0</span> +++
</code></pre></td></tr></table>
</div>
</div><h3 id="10跟踪所有文件描述符相关的系统调用">10、跟踪所有文件描述符相关的系统调用</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="c1"># strace -e trace=%desc ls /</span>
openat<span class="o">(</span>AT_FDCWD, <span class="s2">&#34;/etc/ld.so.cache&#34;</span>, O_RDONLY<span class="p">|</span>O_CLOEXEC<span class="o">)</span> <span class="o">=</span> <span class="m">3</span>
fstat<span class="o">(</span>3, <span class="o">{</span><span class="nv">st_mode</span><span class="o">=</span>S_IFREG<span class="p">|</span>0644, <span class="nv">st_size</span><span class="o">=</span>39762, ...<span class="o">})</span> <span class="o">=</span> <span class="m">0</span>
mmap<span class="o">(</span>NULL, 39762, PROT_READ, MAP_PRIVATE, 3, 0<span class="o">)</span> <span class="o">=</span> 0x7fec70e79000
close<span class="o">(</span>3<span class="o">)</span>                                <span class="o">=</span> <span class="m">0</span>
openat<span class="o">(</span>AT_FDCWD, <span class="s2">&#34;/lib64/libselinux.so.1&#34;</span>, O_RDONLY<span class="p">|</span>O_CLOEXEC<span class="o">)</span> <span class="o">=</span> <span class="m">3</span>
read<span class="o">(</span>3, <span class="s2">&#34;\177ELF\2\1\1\0\0\0\0\0\0\0\0\0\3\0&gt;\0\1\0\0\0\200z\0\0\0\0\0\0&#34;</span>..., 832<span class="o">)</span> <span class="o">=</span> <span class="m">832</span>
lseek<span class="o">(</span>3, 157040, SEEK_SET<span class="o">)</span>              <span class="o">=</span> <span class="m">157040</span>
read<span class="o">(</span>3, <span class="s2">&#34;\4\0\0\0 \0\0\0\5\0\0\0GNU\0\1\0\0\300\4\0\0\0\30\0\0\0\0\0\0\0&#34;</span>..., 48<span class="o">)</span> <span class="o">=</span> <span class="m">48</span>
fstat<span class="o">(</span>3, <span class="o">{</span><span class="nv">st_mode</span><span class="o">=</span>S_IFREG<span class="p">|</span>0755, <span class="nv">st_size</span><span class="o">=</span>168568, ...<span class="o">})</span> <span class="o">=</span> <span class="m">0</span>
mmap<span class="o">(</span>NULL, 8192, PROT_READ<span class="p">|</span>PROT_WRITE, MAP_PRIVATE<span class="p">|</span>MAP_ANONYMOUS, -1, 0<span class="o">)</span> <span class="o">=</span> 0x7fec70e77000
lseek<span class="o">(</span>3, 157040, SEEK_SET<span class="o">)</span>              <span class="o">=</span> <span class="m">157040</span>
read<span class="o">(</span>3, <span class="s2">&#34;\4\0\0\0 \0\0\0\5\0\0\0GNU\0\1\0\0\300\4\0\0\0\30\0\0\0\0\0\0\0&#34;</span>..., 48<span class="o">)</span> <span class="o">=</span> <span class="m">48</span>
mmap<span class="o">(</span>NULL, 2266608, PROT_READ<span class="p">|</span>PROT_EXEC, MAP_PRIVATE<span class="p">|</span>MAP_DENYWRITE, 3, 0<span class="o">)</span> <span class="o">=</span> 0x7fec70a31000
mmap<span class="o">(</span>0x7fec70c57000, 8192, PROT_READ<span class="p">|</span>PROT_WRITE, MAP_PRIVATE<span class="p">|</span>MAP_FIXED<span class="p">|</span>MAP_DENYWRITE, 3, 0x26000<span class="o">)</span> <span class="o">=</span> 0x7fec70c57000
mmap<span class="o">(</span>0x7fec70c59000, 5616, PROT_READ<span class="p">|</span>PROT_WRITE, MAP_PRIVATE<span class="p">|</span>MAP_FIXED<span class="p">|</span>MAP_ANONYMOUS, -1, 0<span class="o">)</span> <span class="o">=</span> 0x7fec70c59000
......
......
mmap<span class="o">(</span>NULL, 8192, PROT_READ<span class="p">|</span>PROT_WRITE, MAP_PRIVATE<span class="p">|</span>MAP_ANONYMOUS, -1, 0<span class="o">)</span> <span class="o">=</span> 0x7fec70e75000
mmap<span class="o">(</span>NULL, 8192, PROT_READ<span class="p">|</span>PROT_WRITE, MAP_PRIVATE<span class="p">|</span>MAP_ANONYMOUS, -1, 0<span class="o">)</span> <span class="o">=</span> 0x7fec70e73000
openat<span class="o">(</span>AT_FDCWD, <span class="s2">&#34;/proc/filesystems&#34;</span>, O_RDONLY<span class="p">|</span>O_CLOEXEC<span class="o">)</span> <span class="o">=</span> <span class="m">3</span>
fstat<span class="o">(</span>3, <span class="o">{</span><span class="nv">st_mode</span><span class="o">=</span>S_IFREG<span class="p">|</span>0444, <span class="nv">st_size</span><span class="o">=</span>0, ...<span class="o">})</span> <span class="o">=</span> <span class="m">0</span>
read<span class="o">(</span>3, <span class="s2">&#34;nodev\tsysfs\nnodev\trootfs\nnodev\tr&#34;</span>..., 1024<span class="o">)</span> <span class="o">=</span> <span class="m">327</span>
read<span class="o">(</span>3, <span class="s2">&#34;&#34;</span>, 1024<span class="o">)</span>                       <span class="o">=</span> <span class="m">0</span>
close<span class="o">(</span>3<span class="o">)</span>                                <span class="o">=</span> <span class="m">0</span>
......
......
openat<span class="o">(</span>AT_FDCWD, <span class="s2">&#34;/usr/lib/locale/en_US.UTF-8/LC_CTYPE&#34;</span>, O_RDONLY<span class="p">|</span>O_CLOEXEC<span class="o">)</span> <span class="o">=</span> -1 ENOENT <span class="o">(</span>No such file or directory<span class="o">)</span>
openat<span class="o">(</span>AT_FDCWD, <span class="s2">&#34;/usr/lib/locale/en_US.utf8/LC_CTYPE&#34;</span>, O_RDONLY<span class="p">|</span>O_CLOEXEC<span class="o">)</span> <span class="o">=</span> <span class="m">3</span>
fstat<span class="o">(</span>3, <span class="o">{</span><span class="nv">st_mode</span><span class="o">=</span>S_IFREG<span class="p">|</span>0644, <span class="nv">st_size</span><span class="o">=</span>337024, ...<span class="o">})</span> <span class="o">=</span> <span class="m">0</span>
mmap<span class="o">(</span>NULL, 337024, PROT_READ, MAP_PRIVATE, 3, 0<span class="o">)</span> <span class="o">=</span> 0x7fec70e19000
close<span class="o">(</span>3<span class="o">)</span>                                <span class="o">=</span> <span class="m">0</span>
ioctl<span class="o">(</span>1, TCGETS, <span class="o">{</span>B38400 opost isig icanon <span class="nb">echo</span> ...<span class="o">})</span> <span class="o">=</span> <span class="m">0</span>
ioctl<span class="o">(</span>1, TIOCGWINSZ, <span class="o">{</span><span class="nv">ws_row</span><span class="o">=</span>48, <span class="nv">ws_col</span><span class="o">=</span>204, <span class="nv">ws_xpixel</span><span class="o">=</span>2856, <span class="nv">ws_ypixel</span><span class="o">=</span>1632<span class="o">})</span> <span class="o">=</span> <span class="m">0</span>
openat<span class="o">(</span>AT_FDCWD, <span class="s2">&#34;/&#34;</span>, O_RDONLY<span class="p">|</span>O_NONBLOCK<span class="p">|</span>O_CLOEXEC<span class="p">|</span>O_DIRECTORY<span class="o">)</span> <span class="o">=</span> <span class="m">3</span>
fstat<span class="o">(</span>3, <span class="o">{</span><span class="nv">st_mode</span><span class="o">=</span>S_IFDIR<span class="p">|</span>0555, <span class="nv">st_size</span><span class="o">=</span>244, ...<span class="o">})</span> <span class="o">=</span> <span class="m">0</span>
getdents64<span class="o">(</span>3, /* <span class="m">22</span> entries */, 32768<span class="o">)</span>  <span class="o">=</span> <span class="m">552</span>
getdents64<span class="o">(</span>3, /* <span class="m">0</span> entries */, 32768<span class="o">)</span>   <span class="o">=</span> <span class="m">0</span>
close<span class="o">(</span>3<span class="o">)</span>                                <span class="o">=</span> <span class="m">0</span>
fstat<span class="o">(</span>1, <span class="o">{</span><span class="nv">st_mode</span><span class="o">=</span>S_IFCHR<span class="p">|</span>0620, <span class="nv">st_rdev</span><span class="o">=</span>makedev<span class="o">(</span>0x88, 0<span class="o">)</span>, ...<span class="o">})</span> <span class="o">=</span> <span class="m">0</span>
write<span class="o">(</span>1, <span class="s2">&#34;bin  boot  dev\tetc  home  lib\tli&#34;</span>..., 100bin  boot  dev	etc  home  lib	lib64  media  mnt  opt	proc  root  run  sbin  srv  sys  tmp  usr  var
<span class="o">)</span> <span class="o">=</span> <span class="m">100</span>
close<span class="o">(</span>1<span class="o">)</span>                                <span class="o">=</span> <span class="m">0</span>
close<span class="o">(</span>2<span class="o">)</span>                                <span class="o">=</span> <span class="m">0</span>
+++ exited with <span class="m">0</span> +++
</code></pre></td></tr></table>
</div>
</div><p>许多系统调用的参数中都包含了文件描述符，要想过滤出这类系统调用，只要加上<code>-e trace=%desc</code>选项。</p>
<h3 id="11跟踪所有内存相关的系统调用">11、跟踪所有内存相关的系统调用</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="c1"># strace -e trace=%memory ls /</span>
brk<span class="o">(</span>NULL<span class="o">)</span>                               <span class="o">=</span> 0x565257b60000
mmap<span class="o">(</span>NULL, 39762, PROT_READ, MAP_PRIVATE, 3, 0<span class="o">)</span> <span class="o">=</span> 0x7f475eb2a000
mmap<span class="o">(</span>NULL, 8192, PROT_READ<span class="p">|</span>PROT_WRITE, MAP_PRIVATE<span class="p">|</span>MAP_ANONYMOUS, -1, 0<span class="o">)</span> <span class="o">=</span> 0x7f475eb28000
mmap<span class="o">(</span>NULL, 2266608, PROT_READ<span class="p">|</span>PROT_EXEC, MAP_PRIVATE<span class="p">|</span>MAP_DENYWRITE, 3, 0<span class="o">)</span> <span class="o">=</span> 0x7f475e6e2000
mprotect<span class="o">(</span>0x7f475e709000, 2093056, PROT_NONE<span class="o">)</span> <span class="o">=</span> <span class="m">0</span>
mmap<span class="o">(</span>0x7f475e908000, 8192, PROT_READ<span class="p">|</span>PROT_WRITE, MAP_PRIVATE<span class="p">|</span>MAP_FIXED<span class="p">|</span>MAP_DENYWRITE, 3, 0x26000<span class="o">)</span> <span class="o">=</span> 0x7f475e908000
mmap<span class="o">(</span>0x7f475e90a000, 5616, PROT_READ<span class="p">|</span>PROT_WRITE, MAP_PRIVATE<span class="p">|</span>MAP_FIXED<span class="p">|</span>MAP_ANONYMOUS, -1, 0<span class="o">)</span> <span class="o">=</span> 0x7f475e90a000
mmap<span class="o">(</span>NULL, 2117944, PROT_READ<span class="p">|</span>PROT_EXEC, MAP_PRIVATE<span class="p">|</span>MAP_DENYWRITE, 3, 0<span class="o">)</span> <span class="o">=</span> 0x7f475e4dc000
mprotect<span class="o">(</span>0x7f475e4e0000, 2097152, PROT_NONE<span class="o">)</span> <span class="o">=</span> <span class="m">0</span>
mmap<span class="o">(</span>0x7f475e6e0000, 8192, PROT_READ<span class="p">|</span>PROT_WRITE, MAP_PRIVATE<span class="p">|</span>MAP_FIXED<span class="p">|</span>MAP_DENYWRITE, 3, 0x4000<span class="o">)</span> <span class="o">=</span> 0x7f475e6e0000
mmap<span class="o">(</span>NULL, 3942144, PROT_READ<span class="p">|</span>PROT_EXEC, MAP_PRIVATE<span class="p">|</span>MAP_DENYWRITE, 3, 0<span class="o">)</span> <span class="o">=</span> 0x7f475e119000
mprotect<span class="o">(</span>0x7f475e2d2000, 2097152, PROT_NONE<span class="o">)</span> <span class="o">=</span> <span class="m">0</span>
mmap<span class="o">(</span>0x7f475e4d2000, 24576, PROT_READ<span class="p">|</span>PROT_WRITE, MAP_PRIVATE<span class="p">|</span>MAP_FIXED<span class="p">|</span>MAP_DENYWRITE, 3, 0x1b9000<span class="o">)</span> <span class="o">=</span> 0x7f475e4d2000
mmap<span class="o">(</span>0x7f475e4d8000, 14080, PROT_READ<span class="p">|</span>PROT_WRITE, MAP_PRIVATE<span class="p">|</span>MAP_FIXED<span class="p">|</span>MAP_ANONYMOUS, -1, 0<span class="o">)</span> <span class="o">=</span> 0x7f475e4d8000
mmap<span class="o">(</span>NULL, 2634280, PROT_READ<span class="p">|</span>PROT_EXEC, MAP_PRIVATE<span class="p">|</span>MAP_DENYWRITE, 3, 0<span class="o">)</span> <span class="o">=</span> 0x7f475de95000
mprotect<span class="o">(</span>0x7f475df18000, 2093056, PROT_NONE<span class="o">)</span> <span class="o">=</span> <span class="m">0</span>
mmap<span class="o">(</span>0x7f475e117000, 8192, PROT_READ<span class="p">|</span>PROT_WRITE, MAP_PRIVATE<span class="p">|</span>MAP_FIXED<span class="p">|</span>MAP_DENYWRITE, 3, 0x82000<span class="o">)</span> <span class="o">=</span> 0x7f475e117000
mmap<span class="o">(</span>NULL, 2109744, PROT_READ<span class="p">|</span>PROT_EXEC, MAP_PRIVATE<span class="p">|</span>MAP_DENYWRITE, 3, 0<span class="o">)</span> <span class="o">=</span> 0x7f475dc91000
mprotect<span class="o">(</span>0x7f475dc94000, 2093056, PROT_NONE<span class="o">)</span> <span class="o">=</span> <span class="m">0</span>
mmap<span class="o">(</span>0x7f475de93000, 8192, PROT_READ<span class="p">|</span>PROT_WRITE, MAP_PRIVATE<span class="p">|</span>MAP_FIXED<span class="p">|</span>MAP_DENYWRITE, 3, 0x2000<span class="o">)</span> <span class="o">=</span> 0x7f475de93000
mmap<span class="o">(</span>NULL, 2225344, PROT_READ<span class="p">|</span>PROT_EXEC, MAP_PRIVATE<span class="p">|</span>MAP_DENYWRITE, 3, 0<span class="o">)</span> <span class="o">=</span> 0x7f475da71000
mprotect<span class="o">(</span>0x7f475da8c000, 2093056, PROT_NONE<span class="o">)</span> <span class="o">=</span> <span class="m">0</span>
mmap<span class="o">(</span>0x7f475dc8b000, 8192, PROT_READ<span class="p">|</span>PROT_WRITE, MAP_PRIVATE<span class="p">|</span>MAP_FIXED<span class="p">|</span>MAP_DENYWRITE, 3, 0x1a000<span class="o">)</span> <span class="o">=</span> 0x7f475dc8b000
mmap<span class="o">(</span>0x7f475dc8d000, 13504, PROT_READ<span class="p">|</span>PROT_WRITE, MAP_PRIVATE<span class="p">|</span>MAP_FIXED<span class="p">|</span>MAP_ANONYMOUS, -1, 0<span class="o">)</span> <span class="o">=</span> 0x7f475dc8d000
mmap<span class="o">(</span>NULL, 8192, PROT_READ<span class="p">|</span>PROT_WRITE, MAP_PRIVATE<span class="p">|</span>MAP_ANONYMOUS, -1, 0<span class="o">)</span> <span class="o">=</span> 0x7f475eb26000
mmap<span class="o">(</span>NULL, 8192, PROT_READ<span class="p">|</span>PROT_WRITE, MAP_PRIVATE<span class="p">|</span>MAP_ANONYMOUS, -1, 0<span class="o">)</span> <span class="o">=</span> 0x7f475eb24000
mprotect<span class="o">(</span>0x7f475e4d2000, 16384, PROT_READ<span class="o">)</span> <span class="o">=</span> <span class="m">0</span>
mprotect<span class="o">(</span>0x7f475dc8b000, 4096, PROT_READ<span class="o">)</span> <span class="o">=</span> <span class="m">0</span>
mprotect<span class="o">(</span>0x7f475de93000, 4096, PROT_READ<span class="o">)</span> <span class="o">=</span> <span class="m">0</span>
mprotect<span class="o">(</span>0x7f475e117000, 4096, PROT_READ<span class="o">)</span> <span class="o">=</span> <span class="m">0</span>
mprotect<span class="o">(</span>0x7f475e6e0000, 4096, PROT_READ<span class="o">)</span> <span class="o">=</span> <span class="m">0</span>
mprotect<span class="o">(</span>0x7f475e908000, 4096, PROT_READ<span class="o">)</span> <span class="o">=</span> <span class="m">0</span>
mprotect<span class="o">(</span>0x56525713d000, 8192, PROT_READ<span class="o">)</span> <span class="o">=</span> <span class="m">0</span>
mprotect<span class="o">(</span>0x7f475eb34000, 4096, PROT_READ<span class="o">)</span> <span class="o">=</span> <span class="m">0</span>
munmap<span class="o">(</span>0x7f475eb2a000, 39762<span class="o">)</span>           <span class="o">=</span> <span class="m">0</span>
brk<span class="o">(</span>NULL<span class="o">)</span>                               <span class="o">=</span> 0x565257b60000
brk<span class="o">(</span>0x565257b81000<span class="o">)</span>                     <span class="o">=</span> 0x565257b81000
mmap<span class="o">(</span>NULL, 368, PROT_READ, MAP_PRIVATE, 3, 0<span class="o">)</span> <span class="o">=</span> 0x7f475eb33000
mmap<span class="o">(</span>NULL, 26998, PROT_READ, MAP_SHARED, 3, 0<span class="o">)</span> <span class="o">=</span> 0x7f475eb2c000
mmap<span class="o">(</span>NULL, 23, PROT_READ, MAP_PRIVATE, 3, 0<span class="o">)</span> <span class="o">=</span> 0x7f475eb2b000
mmap<span class="o">(</span>NULL, 59, PROT_READ, MAP_PRIVATE, 3, 0<span class="o">)</span> <span class="o">=</span> 0x7f475eb2a000
mmap<span class="o">(</span>NULL, 167, PROT_READ, MAP_PRIVATE, 3, 0<span class="o">)</span> <span class="o">=</span> 0x7f475eb23000
mmap<span class="o">(</span>NULL, 77, PROT_READ, MAP_PRIVATE, 3, 0<span class="o">)</span> <span class="o">=</span> 0x7f475eb22000
mmap<span class="o">(</span>NULL, 34, PROT_READ, MAP_PRIVATE, 3, 0<span class="o">)</span> <span class="o">=</span> 0x7f475eb21000
mmap<span class="o">(</span>NULL, 57, PROT_READ, MAP_PRIVATE, 3, 0<span class="o">)</span> <span class="o">=</span> 0x7f475eb20000
mmap<span class="o">(</span>NULL, 286, PROT_READ, MAP_PRIVATE, 3, 0<span class="o">)</span> <span class="o">=</span> 0x7f475eb1f000
mmap<span class="o">(</span>NULL, 2586930, PROT_READ, MAP_PRIVATE, 3, 0<span class="o">)</span> <span class="o">=</span> 0x7f475d7f9000
mmap<span class="o">(</span>NULL, 3316, PROT_READ, MAP_PRIVATE, 3, 0<span class="o">)</span> <span class="o">=</span> 0x7f475eb1e000
mmap<span class="o">(</span>NULL, 54, PROT_READ, MAP_PRIVATE, 3, 0<span class="o">)</span> <span class="o">=</span> 0x7f475eb1d000
mmap<span class="o">(</span>NULL, 337024, PROT_READ, MAP_PRIVATE, 3, 0<span class="o">)</span> <span class="o">=</span> 0x7f475eaca000
bin  boot  dev	etc  home  lib	lib64  media  mnt  opt	proc  root  run  sbin  srv  sys  tmp  usr  var
+++ exited with <span class="m">0</span> +++
</code></pre></td></tr></table>
</div>
</div><p><code>-e trace=%memory</code>选项用于过滤出内存相关的系统调用。</p>
<h3 id="12跟踪访问指定路径的系统调用">12、跟踪访问指定路径的系统调用</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="c1"># strace -P /dev/stdout -P /dev/fd/1  ls /</span>
strace: Requested path <span class="s1">&#39;/dev/stdout&#39;</span> resolved into <span class="s1">&#39;/dev/pts/1&#39;</span>
strace: Requested path <span class="s1">&#39;/dev/fd/1&#39;</span> resolved into <span class="s1">&#39;/dev/pts/1&#39;</span>
ioctl<span class="o">(</span>1, TCGETS, <span class="o">{</span>B38400 opost isig icanon <span class="nb">echo</span> ...<span class="o">})</span> <span class="o">=</span> <span class="m">0</span>
ioctl<span class="o">(</span>1, TIOCGWINSZ, <span class="o">{</span><span class="nv">ws_row</span><span class="o">=</span>48, <span class="nv">ws_col</span><span class="o">=</span>204, <span class="nv">ws_xpixel</span><span class="o">=</span>2856, <span class="nv">ws_ypixel</span><span class="o">=</span>1632<span class="o">})</span> <span class="o">=</span> <span class="m">0</span>
fstat<span class="o">(</span>1, <span class="o">{</span><span class="nv">st_mode</span><span class="o">=</span>S_IFCHR<span class="p">|</span>0620, <span class="nv">st_rdev</span><span class="o">=</span>makedev<span class="o">(</span>0x88, 0x1<span class="o">)</span>, ...<span class="o">})</span> <span class="o">=</span> <span class="m">0</span>
write<span class="o">(</span>1, <span class="s2">&#34;bin  boot  dev\tetc  home  lib\tli&#34;</span>..., 100bin  boot  dev	etc  home  lib	lib64  media  mnt  opt	proc  root  run  sbin  srv  sys  tmp  usr  var
<span class="o">)</span> <span class="o">=</span> <span class="m">100</span>
close<span class="o">(</span>1<span class="o">)</span>                                <span class="o">=</span> <span class="m">0</span>
close<span class="o">(</span>2<span class="o">)</span>                                <span class="o">=</span> <span class="m">0</span>
+++ exited with <span class="m">0</span> +++
</code></pre></td></tr></table>
</div>
</div><p>想要确定有哪些系统调用访问了某个或者某些文件路径，用<code>-P</code>选项就能达到过滤效果。示例中用<code>-P</code>选项指定了标准输出的两个文件路径，最终输出的内容中也的确如此。</p>
<h3 id="13跟踪子进程的系统调用">13、跟踪子进程的系统调用</h3>
<p>为演示创建子进程的系统调用，准备了以下C语言程序：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C" data-lang="C"><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;stdlib.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;sys/types.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;unistd.h&gt;</span><span class="cp">
</span><span class="cp"></span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&#34;[%d]before fork</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">getpid</span><span class="p">());</span>
    <span class="n">pid_t</span> <span class="n">pid</span> <span class="o">=</span> <span class="n">fork</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">pid</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">perror</span><span class="p">(</span><span class="s">&#34;fork error&#34;</span><span class="p">);</span>
        <span class="n">exit</span><span class="p">(</span><span class="n">EXIT_FAILURE</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">pid</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&#34;Parent process: pid=%d ppid=%d</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">getpid</span><span class="p">(),</span> <span class="n">getppid</span><span class="p">());</span>
        <span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span> <span class="c1">// 为了保证父进程后退出
</span><span class="c1"></span>    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">pid</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&#34;Child process: pid=%d ppid=%d</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">getpid</span><span class="p">(),</span> <span class="n">getppid</span><span class="p">());</span>
    <span class="p">}</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&#34;[%d]after fork</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">getpid</span><span class="p">());</span>
    <span class="k">return</span> <span class="n">EXIT_SUCCESS</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>加上<code>-f</code>选项后，会跟踪子进程中的系统调用，形如<code>[pid 2600409] xxxxx</code>。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="c1"># strace -f -e trace=clone,write,getpid ./a.out</span>
getpid<span class="o">()</span>                                <span class="o">=</span> <span class="m">2600408</span>
write<span class="o">(</span>1, <span class="s2">&#34;[2600408]before fork\n&#34;</span>, 21<span class="o">[</span>2600408<span class="o">]</span>before fork
<span class="o">)</span>  <span class="o">=</span> <span class="m">21</span>
clone<span class="o">(</span><span class="nv">child_stack</span><span class="o">=</span>NULL, <span class="nv">flags</span><span class="o">=</span>CLONE_CHILD_CLEARTID<span class="p">|</span>CLONE_CHILD_SETTID<span class="p">|</span>SIGCHLD, <span class="nv">child_tidptr</span><span class="o">=</span>0x7f2cd60217d0<span class="o">)</span> <span class="o">=</span> <span class="m">2600409</span>
getpid<span class="o">()</span>                                <span class="o">=</span> <span class="m">2600408</span>
write<span class="o">(</span>1, <span class="s2">&#34;Parent process: pid=2600408 ppid&#34;</span>..., 41Parent process: <span class="nv">pid</span><span class="o">=</span><span class="m">2600408</span> <span class="nv">ppid</span><span class="o">=</span><span class="m">2600405</span>
<span class="o">)</span> <span class="o">=</span> <span class="m">41</span>
strace: Process <span class="m">2600409</span> attached
<span class="o">[</span>pid 2600409<span class="o">]</span> getpid<span class="o">()</span>                  <span class="o">=</span> <span class="m">2600409</span>
<span class="o">[</span>pid 2600409<span class="o">]</span> write<span class="o">(</span>1, <span class="s2">&#34;Child process: pid=2600409 ppid=&#34;</span>..., 40Child process: <span class="nv">pid</span><span class="o">=</span><span class="m">2600409</span> <span class="nv">ppid</span><span class="o">=</span><span class="m">2600408</span>
<span class="o">)</span> <span class="o">=</span> <span class="m">40</span>
<span class="o">[</span>pid 2600409<span class="o">]</span> getpid<span class="o">()</span>                  <span class="o">=</span> <span class="m">2600409</span>
<span class="o">[</span>pid 2600409<span class="o">]</span> write<span class="o">(</span>1, <span class="s2">&#34;[2600409]after fork\n&#34;</span>, 20<span class="o">[</span>2600409<span class="o">]</span>after fork
<span class="o">)</span> <span class="o">=</span> <span class="m">20</span>
<span class="o">[</span>pid 2600409<span class="o">]</span> +++ exited with <span class="m">0</span> +++
--- SIGCHLD <span class="o">{</span><span class="nv">si_signo</span><span class="o">=</span>SIGCHLD, <span class="nv">si_code</span><span class="o">=</span>CLD_EXITED, <span class="nv">si_pid</span><span class="o">=</span>2600409, <span class="nv">si_uid</span><span class="o">=</span>0, <span class="nv">si_status</span><span class="o">=</span>0, <span class="nv">si_utime</span><span class="o">=</span>0, <span class="nv">si_stime</span><span class="o">=</span>0<span class="o">}</span> ---
getpid<span class="o">()</span>                                <span class="o">=</span> <span class="m">2600408</span>
write<span class="o">(</span>1, <span class="s2">&#34;[2600408]after fork\n&#34;</span>, 20<span class="o">[</span>2600408<span class="o">]</span>after fork
<span class="o">)</span>   <span class="o">=</span> <span class="m">20</span>
+++ exited with <span class="m">0</span> +++
</code></pre></td></tr></table>
</div>
</div><h3 id="14查看进程发起系统调用的时间戳">14、查看进程发起系统调用的时间戳</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="c1"># strace -tt -e trace=socket,bind,connect ping -c 1 github.com</span>
12:46:14.276448 socket<span class="o">(</span>AF_INET, SOCK_DGRAM, IPPROTO_ICMP<span class="o">)</span> <span class="o">=</span> -1 EACCES <span class="o">(</span>Permission denied<span class="o">)</span>
12:46:14.276622 socket<span class="o">(</span>AF_INET, SOCK_RAW, IPPROTO_ICMP<span class="o">)</span> <span class="o">=</span> <span class="m">3</span>
12:46:14.276678 socket<span class="o">(</span>AF_INET6, SOCK_DGRAM, IPPROTO_ICMPV6<span class="o">)</span> <span class="o">=</span> -1 EACCES <span class="o">(</span>Permission denied<span class="o">)</span>
12:46:14.276724 socket<span class="o">(</span>AF_INET6, SOCK_RAW, IPPROTO_ICMPV6<span class="o">)</span> <span class="o">=</span> <span class="m">4</span>
12:46:14.276788 socket<span class="o">(</span>AF_UNIX, SOCK_STREAM<span class="p">|</span>SOCK_CLOEXEC<span class="p">|</span>SOCK_NONBLOCK, 0<span class="o">)</span> <span class="o">=</span> <span class="m">5</span>
12:46:14.276824 connect<span class="o">(</span>5, <span class="o">{</span><span class="nv">sa_family</span><span class="o">=</span>AF_UNIX, <span class="nv">sun_path</span><span class="o">=</span><span class="s2">&#34;/var/run/nscd/socket&#34;</span><span class="o">}</span>, 110<span class="o">)</span> <span class="o">=</span> -1 ENOENT <span class="o">(</span>No such file or directory<span class="o">)</span>
12:46:14.276878 socket<span class="o">(</span>AF_UNIX, SOCK_STREAM<span class="p">|</span>SOCK_CLOEXEC<span class="p">|</span>SOCK_NONBLOCK, 0<span class="o">)</span> <span class="o">=</span> <span class="m">5</span>
12:46:14.276910 connect<span class="o">(</span>5, <span class="o">{</span><span class="nv">sa_family</span><span class="o">=</span>AF_UNIX, <span class="nv">sun_path</span><span class="o">=</span><span class="s2">&#34;/var/run/nscd/socket&#34;</span><span class="o">}</span>, 110<span class="o">)</span> <span class="o">=</span> -1 ENOENT <span class="o">(</span>No such file or directory<span class="o">)</span>
12:46:14.277477 socket<span class="o">(</span>AF_INET, SOCK_DGRAM<span class="p">|</span>SOCK_CLOEXEC<span class="p">|</span>SOCK_NONBLOCK, IPPROTO_IP<span class="o">)</span> <span class="o">=</span> <span class="m">5</span>
12:46:14.277567 connect<span class="o">(</span>5, <span class="o">{</span><span class="nv">sa_family</span><span class="o">=</span>AF_INET, <span class="nv">sin_port</span><span class="o">=</span>htons<span class="o">(</span>53<span class="o">)</span>, <span class="nv">sin_addr</span><span class="o">=</span>inet_addr<span class="o">(</span><span class="s2">&#34;10.23.255.1&#34;</span><span class="o">)}</span>, 16<span class="o">)</span> <span class="o">=</span> <span class="m">0</span>
12:46:14.279023 socket<span class="o">(</span>AF_INET, SOCK_DGRAM, IPPROTO_IP<span class="o">)</span> <span class="o">=</span> <span class="m">5</span>
12:46:14.279089 connect<span class="o">(</span>5, <span class="o">{</span><span class="nv">sa_family</span><span class="o">=</span>AF_INET, <span class="nv">sin_port</span><span class="o">=</span>htons<span class="o">(</span>1025<span class="o">)</span>, <span class="nv">sin_addr</span><span class="o">=</span>inet_addr<span class="o">(</span><span class="s2">&#34;10.23.253.91&#34;</span><span class="o">)}</span>, 16<span class="o">)</span> <span class="o">=</span> <span class="m">0</span>
PING github.com <span class="o">(</span>10.23.253.91<span class="o">)</span> 56<span class="o">(</span>84<span class="o">)</span> bytes of data.
12:46:14.280138 socket<span class="o">(</span>AF_INET, SOCK_DGRAM<span class="p">|</span>SOCK_CLOEXEC<span class="p">|</span>SOCK_NONBLOCK, IPPROTO_IP<span class="o">)</span> <span class="o">=</span> <span class="m">5</span>
12:46:14.280192 connect<span class="o">(</span>5, <span class="o">{</span><span class="nv">sa_family</span><span class="o">=</span>AF_INET, <span class="nv">sin_port</span><span class="o">=</span>htons<span class="o">(</span>53<span class="o">)</span>, <span class="nv">sin_addr</span><span class="o">=</span>inet_addr<span class="o">(</span><span class="s2">&#34;10.23.255.1&#34;</span><span class="o">)}</span>, 16<span class="o">)</span> <span class="o">=</span> <span class="m">0</span>
12:46:14.287007 socket<span class="o">(</span>AF_NETLINK, SOCK_RAW<span class="p">|</span>SOCK_CLOEXEC<span class="p">|</span>SOCK_NONBLOCK, NETLINK_ROUTE<span class="o">)</span> <span class="o">=</span> <span class="m">5</span>
12:46:14.287131 bind<span class="o">(</span>5, <span class="o">{</span><span class="nv">sa_family</span><span class="o">=</span>AF_NETLINK, <span class="nv">nl_pid</span><span class="o">=</span>0, <span class="nv">nl_groups</span><span class="o">=</span>00000000<span class="o">}</span>, 16<span class="o">)</span> <span class="o">=</span> <span class="m">0</span>
12:46:14.287324 socket<span class="o">(</span>AF_NETLINK, SOCK_RAW<span class="p">|</span>SOCK_CLOEXEC<span class="p">|</span>SOCK_NONBLOCK, NETLINK_ROUTE<span class="o">)</span> <span class="o">=</span> <span class="m">5</span>
12:46:14.287374 bind<span class="o">(</span>5, <span class="o">{</span><span class="nv">sa_family</span><span class="o">=</span>AF_NETLINK, <span class="nv">nl_pid</span><span class="o">=</span>0, <span class="nv">nl_groups</span><span class="o">=</span>00000000<span class="o">}</span>, 16<span class="o">)</span> <span class="o">=</span> <span class="m">0</span>
<span class="m">64</span> bytes from 10.23.253.91 <span class="o">(</span>10.23.253.91<span class="o">)</span>: <span class="nv">icmp_seq</span><span class="o">=</span><span class="m">1</span> <span class="nv">ttl</span><span class="o">=</span><span class="m">63</span> <span class="nv">time</span><span class="o">=</span>0.725 ms

--- github.com ping statistics ---
<span class="m">1</span> packets transmitted, <span class="m">1</span> received, 0% packet loss, <span class="nb">time</span> 0ms
rtt min/avg/max/mdev <span class="o">=</span> 0.725/0.725/0.725/0.000 ms
12:46:14.288061 +++ exited with <span class="m">0</span> +++
</code></pre></td></tr></table>
</div>
</div><p><code>-tt</code>选项可以显示每个系统调用的时间信息</p>
<h3 id="15查看进程系统调用的耗时">15、查看进程系统调用的耗时</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="c1"># strace -tt -T -e trace=socket,bind,connect ping -c 1 github.com</span>
12:48:18.669272 socket<span class="o">(</span>AF_INET, SOCK_DGRAM, IPPROTO_ICMP<span class="o">)</span> <span class="o">=</span> -1 EACCES <span class="o">(</span>Permission denied<span class="o">)</span> &lt;0.000076&gt;
12:48:18.669449 socket<span class="o">(</span>AF_INET, SOCK_RAW, IPPROTO_ICMP<span class="o">)</span> <span class="o">=</span> <span class="m">3</span> &lt;0.000024&gt;
12:48:18.669506 socket<span class="o">(</span>AF_INET6, SOCK_DGRAM, IPPROTO_ICMPV6<span class="o">)</span> <span class="o">=</span> -1 EACCES <span class="o">(</span>Permission denied<span class="o">)</span> &lt;0.000023&gt;
12:48:18.669564 socket<span class="o">(</span>AF_INET6, SOCK_RAW, IPPROTO_ICMPV6<span class="o">)</span> <span class="o">=</span> <span class="m">4</span> &lt;0.000014&gt;
12:48:18.669630 socket<span class="o">(</span>AF_UNIX, SOCK_STREAM<span class="p">|</span>SOCK_CLOEXEC<span class="p">|</span>SOCK_NONBLOCK, 0<span class="o">)</span> <span class="o">=</span> <span class="m">5</span> &lt;0.000013&gt;
12:48:18.669663 connect<span class="o">(</span>5, <span class="o">{</span><span class="nv">sa_family</span><span class="o">=</span>AF_UNIX, <span class="nv">sun_path</span><span class="o">=</span><span class="s2">&#34;/var/run/nscd/socket&#34;</span><span class="o">}</span>, 110<span class="o">)</span> <span class="o">=</span> -1 ENOENT <span class="o">(</span>No such file or directory<span class="o">)</span> &lt;0.000018&gt;
12:48:18.669716 socket<span class="o">(</span>AF_UNIX, SOCK_STREAM<span class="p">|</span>SOCK_CLOEXEC<span class="p">|</span>SOCK_NONBLOCK, 0<span class="o">)</span> <span class="o">=</span> <span class="m">5</span> &lt;0.000011&gt;
12:48:18.669745 connect<span class="o">(</span>5, <span class="o">{</span><span class="nv">sa_family</span><span class="o">=</span>AF_UNIX, <span class="nv">sun_path</span><span class="o">=</span><span class="s2">&#34;/var/run/nscd/socket&#34;</span><span class="o">}</span>, 110<span class="o">)</span> <span class="o">=</span> -1 ENOENT <span class="o">(</span>No such file or directory<span class="o">)</span> &lt;0.000012&gt;
12:48:18.670314 socket<span class="o">(</span>AF_INET, SOCK_DGRAM<span class="p">|</span>SOCK_CLOEXEC<span class="p">|</span>SOCK_NONBLOCK, IPPROTO_IP<span class="o">)</span> <span class="o">=</span> <span class="m">5</span> &lt;0.000029&gt;
12:48:18.670377 connect<span class="o">(</span>5, <span class="o">{</span><span class="nv">sa_family</span><span class="o">=</span>AF_INET, <span class="nv">sin_port</span><span class="o">=</span>htons<span class="o">(</span>53<span class="o">)</span>, <span class="nv">sin_addr</span><span class="o">=</span>inet_addr<span class="o">(</span><span class="s2">&#34;10.23.255.1&#34;</span><span class="o">)}</span>, 16<span class="o">)</span> <span class="o">=</span> <span class="m">0</span> &lt;0.000019&gt;
12:48:18.671929 socket<span class="o">(</span>AF_INET, SOCK_DGRAM, IPPROTO_IP<span class="o">)</span> <span class="o">=</span> <span class="m">5</span> &lt;0.000035&gt;
12:48:18.672017 connect<span class="o">(</span>5, <span class="o">{</span><span class="nv">sa_family</span><span class="o">=</span>AF_INET, <span class="nv">sin_port</span><span class="o">=</span>htons<span class="o">(</span>1025<span class="o">)</span>, <span class="nv">sin_addr</span><span class="o">=</span>inet_addr<span class="o">(</span><span class="s2">&#34;10.23.253.91&#34;</span><span class="o">)}</span>, 16<span class="o">)</span> <span class="o">=</span> <span class="m">0</span> &lt;0.000015&gt;
PING github.com <span class="o">(</span>10.23.253.91<span class="o">)</span> 56<span class="o">(</span>84<span class="o">)</span> bytes of data.
12:48:18.673281 socket<span class="o">(</span>AF_INET, SOCK_DGRAM<span class="p">|</span>SOCK_CLOEXEC<span class="p">|</span>SOCK_NONBLOCK, IPPROTO_IP<span class="o">)</span> <span class="o">=</span> <span class="m">5</span> &lt;0.000034&gt;
12:48:18.673357 connect<span class="o">(</span>5, <span class="o">{</span><span class="nv">sa_family</span><span class="o">=</span>AF_INET, <span class="nv">sin_port</span><span class="o">=</span>htons<span class="o">(</span>53<span class="o">)</span>, <span class="nv">sin_addr</span><span class="o">=</span>inet_addr<span class="o">(</span><span class="s2">&#34;10.23.255.1&#34;</span><span class="o">)}</span>, 16<span class="o">)</span> <span class="o">=</span> <span class="m">0</span> &lt;0.000015&gt;
12:48:18.677557 socket<span class="o">(</span>AF_NETLINK, SOCK_RAW<span class="p">|</span>SOCK_CLOEXEC<span class="p">|</span>SOCK_NONBLOCK, NETLINK_ROUTE<span class="o">)</span> <span class="o">=</span> <span class="m">5</span> &lt;0.000031&gt;
12:48:18.677648 bind<span class="o">(</span>5, <span class="o">{</span><span class="nv">sa_family</span><span class="o">=</span>AF_NETLINK, <span class="nv">nl_pid</span><span class="o">=</span>0, <span class="nv">nl_groups</span><span class="o">=</span>00000000<span class="o">}</span>, 16<span class="o">)</span> <span class="o">=</span> <span class="m">0</span> &lt;0.000012&gt;
12:48:18.677810 socket<span class="o">(</span>AF_NETLINK, SOCK_RAW<span class="p">|</span>SOCK_CLOEXEC<span class="p">|</span>SOCK_NONBLOCK, NETLINK_ROUTE<span class="o">)</span> <span class="o">=</span> <span class="m">5</span> &lt;0.000013&gt;
12:48:18.677855 bind<span class="o">(</span>5, <span class="o">{</span><span class="nv">sa_family</span><span class="o">=</span>AF_NETLINK, <span class="nv">nl_pid</span><span class="o">=</span>0, <span class="nv">nl_groups</span><span class="o">=</span>00000000<span class="o">}</span>, 16<span class="o">)</span> <span class="o">=</span> <span class="m">0</span> &lt;0.000011&gt;
<span class="m">64</span> bytes from 10.23.253.91 <span class="o">(</span>10.23.253.91<span class="o">)</span>: <span class="nv">icmp_seq</span><span class="o">=</span><span class="m">1</span> <span class="nv">ttl</span><span class="o">=</span><span class="m">63</span> <span class="nv">time</span><span class="o">=</span>0.898 ms

--- github.com ping statistics ---
<span class="m">1</span> packets transmitted, <span class="m">1</span> received, 0% packet loss, <span class="nb">time</span> 0ms
rtt min/avg/max/mdev <span class="o">=</span> 0.898/0.898/0.898/0.000 ms
12:48:18.678538 +++ exited with <span class="m">0</span> +++
</code></pre></td></tr></table>
</div>
</div><p>加上<code>-T</code>选项后，每行系统调用信息的最右侧会标识出该系统调用的耗时，如<code>&lt;0.000076&gt;</code>。</p>
<h3 id="16查看进程系统调用中文件描述符所关联的文件名">16、查看进程系统调用中文件描述符所关联的文件名</h3>
<p>细心的你是否发现示例<code>跟踪访问指定路径的系统调用</code>中倒数第二行输出的<code>close(2)</code>颇为奇怪，效果上应该仅显示有关标准输出的系统调用，为什么会显示<code>fd=2</code>的系统调用？下面我们增加一个选项<code>-y</code>或者<code>-yy</code>试试。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="c1"># strace -P /dev/stdout -P /dev/fd/1 -y ls /</span>
strace: Requested path <span class="s1">&#39;/dev/stdout&#39;</span> resolved into <span class="s1">&#39;/dev/pts/1&#39;</span>
strace: Requested path <span class="s1">&#39;/dev/fd/1&#39;</span> resolved into <span class="s1">&#39;/dev/pts/1&#39;</span>
ioctl<span class="o">(</span>1&lt;/dev/pts/1&gt;, TCGETS, <span class="o">{</span>B38400 opost isig icanon <span class="nb">echo</span> ...<span class="o">})</span> <span class="o">=</span> <span class="m">0</span>
ioctl<span class="o">(</span>1&lt;/dev/pts/1&gt;, TIOCGWINSZ, <span class="o">{</span><span class="nv">ws_row</span><span class="o">=</span>48, <span class="nv">ws_col</span><span class="o">=</span>204, <span class="nv">ws_xpixel</span><span class="o">=</span>2856, <span class="nv">ws_ypixel</span><span class="o">=</span>1632<span class="o">})</span> <span class="o">=</span> <span class="m">0</span>
fstat<span class="o">(</span>1&lt;/dev/pts/1&gt;, <span class="o">{</span><span class="nv">st_mode</span><span class="o">=</span>S_IFCHR<span class="p">|</span>0620, <span class="nv">st_rdev</span><span class="o">=</span>makedev<span class="o">(</span>0x88, 0x1<span class="o">)</span>, ...<span class="o">})</span> <span class="o">=</span> <span class="m">0</span>
write<span class="o">(</span>1&lt;/dev/pts/1&gt;, <span class="s2">&#34;bin  boot  dev\tetc  home  lib\tli&#34;</span>..., 100bin  boot  dev	etc  home  lib	lib64  media  mnt  opt	proc  root  run  sbin  srv  sys  tmp  usr  var
<span class="o">)</span> <span class="o">=</span> <span class="m">100</span>
close<span class="o">(</span>1&lt;/dev/pts/1&gt;<span class="o">)</span>                    <span class="o">=</span> <span class="m">0</span>
close<span class="o">(</span>2&lt;/dev/pts/1&gt;<span class="o">)</span>                    <span class="o">=</span> <span class="m">0</span>
+++ exited with <span class="m">0</span> +++
</code></pre></td></tr></table>
</div>
</div><p>看到这个输出，是否就能明白为什么了呢？看来文件描述符<code>1</code>和<code>2</code>都指向了标准输出。</p>
<h1 id="参考">参考</h1>
<ul>
<li>strace(1) — Linux manual page</li>
<li><a href="https://linuxtools-rst.readthedocs.io/zh_CN/latest/tool/strace.html">strace 跟踪进程中的系统调用</a></li>
</ul>

    </div>

    
    
<div class="post-copyright">
  <p class="copyright-item">
    <span class="item-title">文章作者</span>
    <span class="item-content">voidint</span>
  </p>
  <p class="copyright-item">
    <span class="item-title">上次更新</span>
    <span class="item-content">
      2021/10/17
      
    </span>
  </p>
  
  <p class="copyright-item">
    <span class="item-title">许可协议</span>
    <span class="item-content"><a rel="license noopener" href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank">CC BY-NC-ND 4.0</a></span>
  </p>
</div>


    
    

    <footer class="post-footer">
      <div class="post-tags">
          <a href="http://voidint.github.io/tags/strace/">strace</a>
          
        </div>

      
      <nav class="post-nav">
        
          <a class="prev" href="/post/golang/conditional-expressions/">
            
            <i class="iconfont">
              <svg  class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="18" height="18">
  <path d="M691.908486 949.511495l75.369571-89.491197c10.963703-12.998035 10.285251-32.864502-1.499144-44.378743L479.499795 515.267417 757.434875 204.940602c11.338233-12.190647 11.035334-32.285311-0.638543-44.850487l-80.46666-86.564541c-11.680017-12.583596-30.356378-12.893658-41.662889-0.716314L257.233596 494.235404c-11.332093 12.183484-11.041474 32.266891 0.657986 44.844348l80.46666 86.564541c1.772366 1.910513 3.706415 3.533476 5.750981 4.877077l306.620399 321.703933C662.505829 963.726242 680.945807 962.528973 691.908486 949.511495z"></path>
</svg>

            </i>
            <span class="prev-text nav-default">Go 三目运算符杂谈</span>
            <span class="prev-text nav-mobile">上一篇</span>
          </a>
        
          <a class="next" href="/post/socket/one_process_per_connection/">
            <span class="next-text nav-default">socket编程（二）：每个进程服务一个连接</span>
            <span class="prev-text nav-mobile">下一篇</span>
            
            <i class="iconfont">
              <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="18" height="18">
  <path d="M332.091514 74.487481l-75.369571 89.491197c-10.963703 12.998035-10.285251 32.864502 1.499144 44.378743l286.278095 300.375162L266.565125 819.058374c-11.338233 12.190647-11.035334 32.285311 0.638543 44.850487l80.46666 86.564541c11.680017 12.583596 30.356378 12.893658 41.662889 0.716314l377.434212-421.426145c11.332093-12.183484 11.041474-32.266891-0.657986-44.844348l-80.46666-86.564541c-1.772366-1.910513-3.706415-3.533476-5.750981-4.877077L373.270379 71.774697C361.493148 60.273758 343.054193 61.470003 332.091514 74.487481z"></path>
</svg>

            </i>
          </a>
      </nav>
    </footer>
  </article>

  
  
  
  

  
  

  

  
  
    <div class="post bg-white">
      <script src="https://utteranc.es/client.js"
            repo= "voidint/comments-for-blog"
            issue-term="pathname"
            theme="github-light"
            crossorigin="anonymous"
            async>
      </script>
    </div>
  

  

  

  <div class="disqus-comment">
  <div class="disqus-button" id="load_disqus" onclick="load_disqus()">
    显示 Disqus 评论
  </div>
  <div id="disqus_thread"></div>
  <script type="text/javascript">
    var disqus_config = function () {
      this.page.url = "http://voidint.github.io/post/tool/strace/";
    };
    function load_disqus() {
      
      
      if (window.location.hostname === 'localhost') return;

      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      var disqus_shortname = 'voidint';
      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);

      $('#load_disqus').remove();
    };
  </script>
  <noscript>Please enable JavaScript to view the
    <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a>
  </noscript>
  
  </div>

    

  

        </div>
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="icon-links">
  
  
    <a href="mailto:voidint@126.com" rel="me noopener" class="iconfont"
      title="email" >
      <svg class="icon" viewBox="0 0 1451 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="36" height="36">
  <path d="M664.781909 681.472759 0 97.881301C0 3.997201 71.046997 0 71.046997 0L474.477909 0 961.649408 0 1361.641813 0C1361.641813 0 1432.688811 3.997201 1432.688811 97.881301L771.345323 681.472759C771.345323 681.472759 764.482731 685.154773 753.594283 688.65053L753.594283 688.664858C741.602731 693.493018 729.424896 695.068979 718.077952 694.839748 706.731093 695.068979 694.553173 693.493018 682.561621 688.664858L682.561621 688.65053C671.644501 685.140446 664.781909 681.472759 664.781909 681.472759L664.781909 681.472759ZM718.063616 811.603883C693.779541 811.016482 658.879232 802.205449 619.10784 767.734955 542.989056 701.759633 0 212.052267 0 212.052267L0 942.809523C0 942.809523 0 1024 83.726336 1024L682.532949 1024 753.579947 1024 1348.948139 1024C1432.688811 1024 1432.688811 942.809523 1432.688811 942.809523L1432.688811 212.052267C1432.688811 212.052267 893.138176 701.759633 817.019477 767.734955 777.248 802.205449 742.347691 811.03081 718.063616 811.603883L718.063616 811.603883Z"></path>
</svg>

    </a>
  
    <a href="https://githut.com/voidint" rel="me noopener" class="iconfont"
      title="github"  target="_blank"
      >
      <svg class="icon" style="" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="36" height="36">
  <path d="M512 12.672c-282.88 0-512 229.248-512 512 0 226.261333 146.688 418.133333 350.08 485.76 25.6 4.821333 34.986667-11.008 34.986667-24.618667 0-12.16-0.426667-44.373333-0.64-87.04-142.421333 30.890667-172.458667-68.693333-172.458667-68.693333C188.672 770.986667 155.008 755.2 155.008 755.2c-46.378667-31.744 3.584-31.104 3.584-31.104 51.413333 3.584 78.421333 52.736 78.421333 52.736 45.653333 78.293333 119.850667 55.68 149.12 42.581333 4.608-33.109333 17.792-55.68 32.426667-68.48-113.706667-12.8-233.216-56.832-233.216-253.013333 0-55.893333 19.84-101.546667 52.693333-137.386667-5.76-12.928-23.04-64.981333 4.48-135.509333 0 0 42.88-13.738667 140.8 52.48 40.96-11.392 84.48-17.024 128-17.28 43.52 0.256 87.04 5.888 128 17.28 97.28-66.218667 140.16-52.48 140.16-52.48 27.52 70.528 10.24 122.581333 5.12 135.509333 32.64 35.84 52.48 81.493333 52.48 137.386667 0 196.693333-119.68 240-233.6 252.586667 17.92 15.36 34.56 46.762667 34.56 94.72 0 68.522667-0.64 123.562667-0.64 140.202666 0 13.44 8.96 29.44 35.2 24.32C877.44 942.592 1024 750.592 1024 524.672c0-282.752-229.248-512-512-512"></path>
</svg>

    </a>
  
    <a href="https://weibo.com/voidinteger/home" rel="me noopener" class="iconfont"
      title="weibo"  target="_blank"
      >
      <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="36" height="36">
  <path d="M385.714286 733.714286q12-19.428571 6.285714-39.428571t-25.714286-28.571429q-19.428571-8-41.714286-0.571429t-34.285714 26.285714q-12.571429 19.428571-7.428571 39.142857t24.571429 28.857143 42.571429 1.428571 35.714286-27.142857zm53.714286-69.142857q4.571429-7.428571 2-15.142857t-10-10.571429q-8-2.857143-16.285714 2.857143t-12.285714 10.571429q-9.714286 17.714286 7.428571 25.714286 8 2.857143 16.571429 2.857143t12.571429-10.571429zm99.428571 61.142857q-25.714286 58.285714-90.285714 85.714286t-128 6.857143q-61.142857-19.428571-84.285714-72.285714t3.714286-107.142857q26.857143-53.142857 86.571429-79.428571t120.285714-10.857143q63.428571 16.571429 90.571429 68.285714t1.428571 108.857143zm178.285714-91.428571q-5.142857-54.857143-50.857143-97.142857t-119.142857-62.285714-156.857143-12q-127.428571 13.142857-211.142857 80.857143t-75.714286 151.142857q5.142857 54.857143 50.857143 97.142857t119.142857 62.285714 156.857143 12q127.428571-13.142857 211.142857-80.857143t75.714286-151.142857zm176 2.285714q0 38.857143-21.142857 79.714286t-62.285714 78.285714-96.285714 67.142857-129.142857 47.428571-154.571429 17.714286-157.142857-19.142857-137.428571-53.142857-98-86.285714-37.142857-114q0-65.714286 39.714286-140t112.857143-147.428571q96.571429-96.571429 195.142857-134.857143t140.857143 4q37.142857 36.571429 11.428571 119.428571-2.285714 8-0.571429 11.428571t5.714286 4 8.285714 2.857143 7.714286-2l3.428571-1.142857q79.428571-33.714286 140.571429-33.714286t87.428571 34.857143q25.714286 36 0 101.714286-1.142857 7.428571-2.571429 11.428571t2.571429 7.142857 6.857143 4.285714 9.714286 3.428571q32.571429 10.285714 58.857143 26.857143t45.714286 46.571429 19.428571 66.571429zm-42.285714-356.571429q24 26.857143 31.142857 62t-3.714286 67.142857q-4.571429 13.142857-16.857143 19.428571t-25.428571 2.285714q-13.142857-4.571429-19.428571-16.857143t-2.285714-25.428571q11.428571-36-13.714286-63.428571t-61.142857-20q-13.714286 2.857143-25.714286-4.571429t-14.285714-21.142857q-2.857143-13.714286 4.571429-25.428571t21.142857-14.571429q34.285714-7.428571 68 3.142857t57.714286 37.428571zm103.428571-93.142857q49.714286 54.857143 64.285714 127.142857t-7.714286 138q-5.142857 15.428571-19.428571 22.857143t-29.714286 2.285714-22.857143-19.428571-2.857143-29.714286q16-46.857143 5.714286-98.285714t-45.714286-90.285714q-35.428571-39.428571-84.571429-54.571429t-98.857143-4.857143q-16 3.428571-29.714286-5.428571t-17.142857-24.857143 5.428571-29.428571 24.857143-16.857143q70.285714-14.857143 139.428571 6.571429t118.857143 76.857143z"></path>
</svg>

    </a>
  
    <a href="https://www.zhihu.com/people/voidint/posts" rel="me noopener" class="iconfont"
      title="zhihu"  target="_blank"
      >
      <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="36" height="36">
  <path d="M351.791182 562.469462l192.945407 0c0-45.367257-21.3871-71.939449-21.3871-71.939449L355.897709 490.530013c3.977591-82.182744 7.541767-187.659007 8.816806-226.835262l159.282726 0c0 0-0.86367-67.402109-18.578124-67.402109s-279.979646 0-279.979646 0 16.850783-88.141456 39.318494-127.053698c0 0-83.60514-4.510734-112.121614 106.962104S81.344656 355.077018 76.80834 367.390461c-4.536316 12.313443 24.62791 5.832845 36.941354 0 12.313443-5.832845 68.050885-25.924439 84.252893-103.69571l86.570681 0c1.165546 49.28652 4.596691 200.335724 3.515057 226.835262L109.86113 490.530013c-25.275663 18.147312-33.701566 71.939449-33.701566 71.939449L279.868105 562.469462c-8.497535 56.255235-23.417339 128.763642-44.275389 167.210279-33.05279 60.921511-50.55235 116.65793-169.802314 212.576513 0 0-19.442818 14.257725 40.829917 9.073656 60.273758-5.185093 117.305683-20.739347 156.840094-99.807147 20.553105-41.107233 41.805128-93.250824 58.386782-146.138358l-0.055259 0.185218 167.855986 193.263655c0 0 22.035876-51.847855 5.832845-108.880803L371.045711 650.610918l-42.1244 31.157627-0.045025 0.151449c11.69946-41.020252 20.11206-81.5749 22.726607-116.858498C351.665315 564.212152 351.72876 563.345412 351.791182 562.469462z"></path>
  <path d="M584.918753 182.033893l0 668.840094 70.318532 0 28.807093 80.512708 121.875768-80.512708 153.600307 0L959.520453 182.033893 584.918753 182.033893zM887.150192 778.934538l-79.837326 0-99.578949 65.782216-23.537066-65.782216-24.855084 0L659.341766 256.673847l227.807403 0L887.149169 778.934538z"></path>
</svg>

    </a>


<a href="http://voidint.github.io/index.xml" rel="noopener alternate" type="application/rss&#43;xml"
    class="iconfont" title="rss" target="_blank">
    <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="30" height="30">
  <path d="M819.157333 1024C819.157333 574.592 449.408 204.8 0 204.8V0c561.706667 0 1024 462.293333 1024 1024h-204.842667zM140.416 743.04a140.8 140.8 0 0 1 140.501333 140.586667A140.928 140.928 0 0 1 140.074667 1024C62.72 1024 0 961.109333 0 883.626667s62.933333-140.544 140.416-140.586667zM678.784 1024h-199.04c0-263.210667-216.533333-479.786667-479.744-479.786667V345.173333c372.352 0 678.784 306.517333 678.784 678.826667z"></path>
</svg>

  </a>
   
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - <a class="theme-link" href="https://github.com/xianmin/hugo-theme-jane">Jane</a>
  </span>

  <span class="copyright-year">
    &copy;
    
      2020 -
    2022
    <span class="heart">
      
      <i class="iconfont">
        <svg class="icon" viewBox="0 0 1025 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="14" height="14">
  <path d="M1000.1 247.9c-15.5-37.3-37.6-70.6-65.7-98.9-54.4-54.8-125.8-85-201-85-85.7 0-166 39-221.4 107.4C456.6 103 376.3 64 290.6 64c-75.1 0-146.5 30.4-201.1 85.6-28.2 28.5-50.4 61.9-65.8 99.3-16 38.8-24 79.9-23.6 122.2 0.7 91.7 40.1 177.2 108.1 234.8 3.1 2.6 6 5.1 8.9 7.8 14.9 13.4 58 52.8 112.6 102.7 93.5 85.5 209.9 191.9 257.5 234.2 7 6.1 15.8 9.5 24.9 9.5 9.2 0 18.1-3.4 24.9-9.5 34.5-30.7 105.8-95.9 181.4-165 74.2-67.8 150.9-138 195.8-178.2 69.5-57.9 109.6-144.4 109.9-237.3 0.1-42.5-8-83.6-24-122.2z"
   fill="#8a8a8a"></path>
</svg>

      </i>
    </span><span class="author">
        voidint
        
      </span></span>

  
  

  
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont">
        
        <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="35" height="35">
  <path d="M510.866688 227.694839 95.449397 629.218702l235.761562 0-2.057869 328.796468 362.40389 0L691.55698 628.188232l241.942331-3.089361L510.866688 227.694839zM63.840492 63.962777l894.052392 0 0 131.813095L63.840492 195.775872 63.840492 63.962777 63.840492 63.962777zM63.840492 63.962777"></path>
</svg>

      </i>
    </div>
  </div>
  
<script type="text/javascript" src="/lib/jquery/jquery-3.2.1.min.js"></script>
  <script type="text/javascript" src="/lib/slideout/slideout-1.0.1.min.js"></script>




<script type="text/javascript" src="/js/main.638251f4230630f0335d8c6748e53a96f94b72670920b60c09a56fdc8bece214.js" integrity="sha256-Y4JR9CMGMPAzXYxnSOU6lvlLcmcJILYMCaVv3Ivs4hQ=" crossorigin="anonymous"></script>












  
    <script type="text/javascript" src="/js/load-photoswipe.js"></script>
    <script type="text/javascript" src="/lib/photoswipe/photoswipe.min.js"></script>
    <script type="text/javascript" src="/lib/photoswipe/photoswipe-ui-default.min.js"></script>
  















</body>
</html>
